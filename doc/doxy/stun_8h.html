<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: stun.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_668dee661430860db5868c2621a9c372.html">src</a>      </li>
      <li><a class="el" href="dir_12590045ec6dcd64f3c4ad499444ef83.html">underlay</a>      </li>
      <li><a class="el" href="dir_e7abd501ef2699b72177966ee598d65b.html">singlehostunderlay</a>      </li>
      <li><a class="el" href="dir_e172c4d23ca9cdab66e1c382ceb2ddaa.html">stun</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>stun.h File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &lt;iostream&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>

<p><a href="stun_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structUInt128.html">UInt128</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunMsgHdr.html">StunMsgHdr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAtrHdr.html">StunAtrHdr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAddress4.html">StunAddress4</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAtrAddress4.html">StunAtrAddress4</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAtrChangeRequest.html">StunAtrChangeRequest</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAtrError.html">StunAtrError</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAtrUnknown.html">StunAtrUnknown</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAtrString.html">StunAtrString</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunAtrIntegrity.html">StunAtrIntegrity</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunMessage.html">StunMessage</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunMediaRelay.html">StunMediaRelay</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structStunServerInfo.html">StunServerInfo</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a86988c6804b5f1822cba20215bc4c5b4">STUN_VERSION</a>&nbsp;&nbsp;&nbsp;&quot;0.96&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ac4d86797b42c1696b7acbd715481c0b1">STUN_MAX_STRING</a>&nbsp;&nbsp;&nbsp;256</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a4489609011ca5975a75b730c4efde8a4">STUN_MAX_UNKNOWN_ATTRIBUTES</a>&nbsp;&nbsp;&nbsp;8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a843bd5ac20b667ca26f5ac31162f2122">STUN_MAX_MESSAGE_SIZE</a>&nbsp;&nbsp;&nbsp;2048</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a81e4fdb2a08afd19ef501855bb9fbeec">STUN_PORT</a>&nbsp;&nbsp;&nbsp;3478</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ae3baa55fefdb49c61bf73f191fec0f59">MAX_MEDIA_RELAYS</a>&nbsp;&nbsp;&nbsp;500</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a17610f040b1f2d5fbe9af5ab07884586">MAX_RTP_MSG_SIZE</a>&nbsp;&nbsp;&nbsp;1500</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ac3b4f67bb4d04b4a158671e04b0a3352">MEDIA_RELAY_TIMEOUT</a>&nbsp;&nbsp;&nbsp;3*60</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a9b66271558bfa5abc5095791246b540d">UInt8</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef unsigned short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef unsigned long long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a></td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634">StunHmacStatus</a> { <br/>
&nbsp;&nbsp;<a class="el" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634a8884039082a87797e3274859c476933d">HmacUnkown</a> = 0, 
<a class="el" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634ae30d219a67299e2de2de0f92ea271500">HmacOK</a>, 
<a class="el" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634a78a33c91a6ba7b1b26a52b049d505d9a">HmacBadUserName</a>, 
<a class="el" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634a837bdc7282cb4582526324d37a307c0c">HmacUnkownUserName</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634aebbbf675be80e2fbaa87c800065572f9">HmacFailed</a>
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34ce">NatType</a> { <br/>
&nbsp;&nbsp;<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea22d9f771676123aeb3cabcbdea95c926">StunTypeUnknown</a> = 0, 
<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea3ef48e691e03655d2d1822c10f7ffd13">StunTypeFailure</a>, 
<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea5f2fd642b25cc39e78472ec266efbf4e">StunTypeOpen</a>, 
<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34ceae373da39e99f592df2c2d4f3c1ff1ecf">StunTypeBlocked</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea6dafa9c39c0d631d6f8f6cd267a3ff22">StunTypeIndependentFilter</a>, 
<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea95e89f62cc776f2748e6b7acab9ca21b">StunTypeDependentFilter</a>, 
<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34ceaa88866074d2d5647775372d25b3fce1c">StunTypePortDependedFilter</a>, 
<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea4c280e1f155fc93c334cc7ecbc604d53">StunTypeDependentMapping</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea9261e686e3bb05ccc44ca40b467f0114">StunTypeFirewall</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a44a8d7b644cb0faa4107db47b2e06471">stunParseMessage</a> (char *buf, unsigned int bufLen, <a class="el" href="structStunMessage.html">StunMessage</a> &amp;message, bool verbose)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a663e56a2d581f365fb4918a0f9a88a2d">stunBuildReqSimple</a> (<a class="el" href="structStunMessage.html">StunMessage</a> *msg, const <a class="el" href="structStunAtrString.html">StunAtrString</a> &amp;username, bool changePort, bool changeIp, unsigned int id=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a66298d81441f17d6fdd2aa4a4ced894d">stunEncodeMessage</a> (const <a class="el" href="structStunMessage.html">StunMessage</a> &amp;message, char *buf, unsigned int bufLen, const <a class="el" href="structStunAtrString.html">StunAtrString</a> &amp;password, bool verbose)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ad8f7e4041f7591f4b621625c9190e80f">stunCreateUserName</a> (const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;addr, <a class="el" href="structStunAtrString.html">StunAtrString</a> *username)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ae9317a5a127d1281953d961bcfbd2496">stunGetUserNameAndPassword</a> (const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;dest, <a class="el" href="structStunAtrString.html">StunAtrString</a> *username, <a class="el" href="structStunAtrString.html">StunAtrString</a> *password)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#aa8926aedab40d08f5cff31d759415962">stunCreatePassword</a> (const <a class="el" href="structStunAtrString.html">StunAtrString</a> &amp;username, <a class="el" href="structStunAtrString.html">StunAtrString</a> *password)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a67e399c9420f09178de194bee0bde87a">stunRand</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a43c07bd7f476e16ea3e48a1033e90ba0">stunGetSystemTimeSecs</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ac4cabe7b17eb753dedad02cbb755563c">stunParseServerName</a> (char *serverName, <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;stunServerAddr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">find the IP address of a the specified stun server - return false is fails parse  <a href="#ac4cabe7b17eb753dedad02cbb755563c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#af497f133b72e1dc4595d9d293d706351">stunParseHostName</a> (char *peerName, <a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> &amp;ip, <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> &amp;portVal, <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> defaultPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a99639b68ee528c79e96973a2642184a4">stunInitServer</a> (<a class="el" href="structStunServerInfo.html">StunServerInfo</a> &amp;info, const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;myAddr, const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;altAddr, int startMediaPort, bool verbose)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return true if all is OK Create a media relay and do the STERN thing if startMediaPort is non-zero  <a href="#a99639b68ee528c79e96973a2642184a4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a9ed82a9b4b17f3f4d9bf1fd4d5b8bfd2">stunStopServer</a> (<a class="el" href="structStunServerInfo.html">StunServerInfo</a> &amp;info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a9c0e750bd19cdfcf4b2b36f9ddefc497">stunServerProcess</a> (<a class="el" href="structStunServerInfo.html">StunServerInfo</a> &amp;info, bool verbose)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return true if all is OK  <a href="#a9c0e750bd19cdfcf4b2b36f9ddefc497"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a3ff67b4ada35e49cece8ffdc87b92300">stunFindLocalInterfaces</a> (<a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> *addresses, int maxSize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns number of address found - take array or addres  <a href="#a3ff67b4ada35e49cece8ffdc87b92300"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#adb5b16792462be8778618f42d2a0d1b0">stunTest</a> (<a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;dest, int testNum, bool verbose, <a class="el" href="structStunAddress4.html">StunAddress4</a> *srcAddr=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34ce">NatType</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a69e8446b6e540c25e14538b1760d3e84">stunNatType</a> (<a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;dest, bool verbose, bool *preservePort=0, bool *hairpin=0, int port=0, <a class="el" href="structStunAddress4.html">StunAddress4</a> *sAddr=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a1c697cf71a93848c4084830478678f29">operator&lt;&lt;</a> (std::ostream &amp;strm, const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">prints a StunAddress  <a href="#a1c697cf71a93848c4084830478678f29"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a589c7eea05e3add4d78b28ebb0dc1be3">operator&lt;&lt;</a> (std::ostream &amp;strm, const <a class="el" href="structUInt128.html">UInt128</a> &amp;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#abca9120a82ff1cdb7e3a12b5c68b57f8">stunServerProcessMsg</a> (char *buf, unsigned int bufLen, <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;from, <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;myAddr, <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;altAddr, <a class="el" href="structStunMessage.html">StunMessage</a> *resp, <a class="el" href="structStunAddress4.html">StunAddress4</a> *destination, <a class="el" href="structStunAtrString.html">StunAtrString</a> *hmacPassword, bool *changePort, bool *changeIp, bool verbose)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a5956654577cee7e80cbd7abfb06d3c7e">stunOpenSocket</a> (<a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;dest, <a class="el" href="structStunAddress4.html">StunAddress4</a> *mappedAddr, int port=0, <a class="el" href="structStunAddress4.html">StunAddress4</a> *srcAddr=0, bool verbose=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#aa4e28e0945cd1bdbf6610c6eb87db956">stunOpenSocketPair</a> (<a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;dest, <a class="el" href="structStunAddress4.html">StunAddress4</a> *mappedAddr, int *fd1, int *fd2, int srcPort=0, <a class="el" href="structStunAddress4.html">StunAddress4</a> *srcAddr=0, bool verbose=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ad4a19c401bea76c471959a32a19b777e">stunRandomPort</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return a random number to use as a port  <a href="#ad4a19c401bea76c471959a32a19b777e"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#a9b66271558bfa5abc5095791246b540d">UInt8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ac2c7bc41e1b918c98583006fd7025bc5">IPv4Family</a> = 0x01</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">define a structure to hold a stun address  <a href="#ac2c7bc41e1b918c98583006fd7025bc5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#a9b66271558bfa5abc5095791246b540d">UInt8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a5da56f5efebd69e84bf5fdb74a02bf8a">IPv6Family</a> = 0x02</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ad0235d173b2af6e92be9843aaa585eef">ChangeIpFlag</a> = 0x04</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a2f247c137dd06ef8971319b9a6078ef4">ChangePortFlag</a> = 0x02</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a2479ede510923cc5e8a0c2da5558acc3">MappedAddress</a> = 0x0001</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a91ab7c5c3d71a86a77679d0d2786fae8">ResponseAddress</a> = 0x0002</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a6183c3f6e20ddc5bf9acd531d37c4b08">ChangeRequest</a> = 0x0003</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ab2b81c4c09625b39c5a1d57ee2b460a4">SourceAddress</a> = 0x0004</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a930a1eeda1f0620132bfdea315e711f7">ChangedAddress</a> = 0x0005</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a0845232ed07b469d1262348e1618b962">Username</a> = 0x0006</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a1741d36983135a1f2eefa1b1473956a2">Password</a> = 0x0007</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a0371caac677f72f19ea073dd152197f0">MessageIntegrity</a> = 0x0008</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a750ec1534b2aebc05c90b9e6fe9532c7">ErrorCode</a> = 0x0009</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ac5d0f4ecd6bc741747a3ff79b6e5a96c">UnknownAttribute</a> = 0x000A</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a11d1c4b717d340b20582ac7dead1cd49">ReflectedFrom</a> = 0x000B</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#afd742381f8d8131e21dac399b8a26c3a">XorMappedAddress</a> = 0x8020</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a615f23f67cf9c716c91fa445e272da3c">XorOnly</a> = 0x0021</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a53f47b517798fa3e1b64313d04168ea2">ServerName</a> = 0x8022</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a4d77a59e0dc2c3c06deb3730baa78f80">SecondaryAddress</a> = 0x8050</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a4dfa49ebae731be7b582f0fc7b57d429">BindRequestMsg</a> = 0x0001</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#af0396ed8e86ae295115e3c2d42a7f1ad">BindResponseMsg</a> = 0x0101</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#ae440f0f666689240a0aa0f450d1783ab">BindErrorResponseMsg</a> = 0x0111</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#a03609184bf06df206ab09c4102428a33">SharedSecretRequestMsg</a> = 0x0002</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#af179b3b160dd9d71db8bcff29500504c">SharedSecretResponseMsg</a> = 0x0102</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stun_8h.html#aaaa9b37f28fbe5021e650eaccd372d4d">SharedSecretErrorResponseMsg</a> = 0x0112</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ae3baa55fefdb49c61bf73f191fec0f59"></a><!-- doxytag: member="stun.h::MAX_MEDIA_RELAYS" ref="ae3baa55fefdb49c61bf73f191fec0f59" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_MEDIA_RELAYS&nbsp;&nbsp;&nbsp;500</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00204">204</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="a17610f040b1f2d5fbe9af5ab07884586"></a><!-- doxytag: member="stun.h::MAX_RTP_MSG_SIZE" ref="a17610f040b1f2d5fbe9af5ab07884586" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_RTP_MSG_SIZE&nbsp;&nbsp;&nbsp;1500</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00205">205</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac3b4f67bb4d04b4a158671e04b0a3352"></a><!-- doxytag: member="stun.h::MEDIA_RELAY_TIMEOUT" ref="ac3b4f67bb4d04b4a158671e04b0a3352" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MEDIA_RELAY_TIMEOUT&nbsp;&nbsp;&nbsp;3*60</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00206">206</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="a843bd5ac20b667ca26f5ac31162f2122"></a><!-- doxytag: member="stun.h::STUN_MAX_MESSAGE_SIZE" ref="a843bd5ac20b667ca26f5ac31162f2122" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STUN_MAX_MESSAGE_SIZE&nbsp;&nbsp;&nbsp;2048</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00012">12</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac4d86797b42c1696b7acbd715481c0b1"></a><!-- doxytag: member="stun.h::STUN_MAX_STRING" ref="ac4d86797b42c1696b7acbd715481c0b1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STUN_MAX_STRING&nbsp;&nbsp;&nbsp;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00010">10</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00764">stunCreateUserName()</a>, <a class="el" href="stun_8cc_source.html#l00143">stunParseAtrString()</a>, and <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>.</p>

</div>
</div>
<a class="anchor" id="a4489609011ca5975a75b730c4efde8a4"></a><!-- doxytag: member="stun.h::STUN_MAX_UNKNOWN_ATTRIBUTES" ref="a4489609011ca5975a75b730c4efde8a4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STUN_MAX_UNKNOWN_ATTRIBUTES&nbsp;&nbsp;&nbsp;8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00011">11</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="a81e4fdb2a08afd19ef501855bb9fbeec"></a><!-- doxytag: member="stun.h::STUN_PORT" ref="a81e4fdb2a08afd19ef501855bb9fbeec" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STUN_PORT&nbsp;&nbsp;&nbsp;3478</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00014">14</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="a86988c6804b5f1822cba20215bc4c5b4"></a><!-- doxytag: member="stun.h::STUN_VERSION" ref="a86988c6804b5f1822cba20215bc4c5b4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STUN_VERSION&nbsp;&nbsp;&nbsp;&quot;0.96&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00008">8</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="af9381320a2640ea84038579d8f143c01"></a><!-- doxytag: member="stun.h::Socket" ref="af9381320a2640ea84038579d8f143c01" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int <a class="el" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00201">201</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="accc14a7c843716dfed734f3a03e8d2b6"></a><!-- doxytag: member="stun.h::UInt16" ref="accc14a7c843716dfed734f3a03e8d2b6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned short <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00018">18</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4cd0dc7d33ac7a69204e8429ecea0f86"></a><!-- doxytag: member="stun.h::UInt32" ref="a4cd0dc7d33ac7a69204e8429ecea0f86" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned int <a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00019">19</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa1d7d331b6d522d6d9840fece27108d8"></a><!-- doxytag: member="stun.h::UInt64" ref="aa1d7d331b6d522d6d9840fece27108d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned long long <a class="el" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00023">23</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9b66271558bfa5abc5095791246b540d"></a><!-- doxytag: member="stun.h::UInt8" ref="a9b66271558bfa5abc5095791246b540d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned char <a class="el" href="stun_8h.html#a9b66271558bfa5abc5095791246b540d">UInt8</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00017">17</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34ce"></a><!-- doxytag: member="stun.h::NatType" ref="a73736c0f7526e31ef6a35dcc0ebd34ce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34ce">NatType</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34cea22d9f771676123aeb3cabcbdea95c926"></a><!-- doxytag: member="StunTypeUnknown" ref="a73736c0f7526e31ef6a35dcc0ebd34cea22d9f771676123aeb3cabcbdea95c926" args="" -->StunTypeUnknown</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34cea3ef48e691e03655d2d1822c10f7ffd13"></a><!-- doxytag: member="StunTypeFailure" ref="a73736c0f7526e31ef6a35dcc0ebd34cea3ef48e691e03655d2d1822c10f7ffd13" args="" -->StunTypeFailure</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34cea5f2fd642b25cc39e78472ec266efbf4e"></a><!-- doxytag: member="StunTypeOpen" ref="a73736c0f7526e31ef6a35dcc0ebd34cea5f2fd642b25cc39e78472ec266efbf4e" args="" -->StunTypeOpen</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34ceae373da39e99f592df2c2d4f3c1ff1ecf"></a><!-- doxytag: member="StunTypeBlocked" ref="a73736c0f7526e31ef6a35dcc0ebd34ceae373da39e99f592df2c2d4f3c1ff1ecf" args="" -->StunTypeBlocked</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34cea6dafa9c39c0d631d6f8f6cd267a3ff22"></a><!-- doxytag: member="StunTypeIndependentFilter" ref="a73736c0f7526e31ef6a35dcc0ebd34cea6dafa9c39c0d631d6f8f6cd267a3ff22" args="" -->StunTypeIndependentFilter</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34cea95e89f62cc776f2748e6b7acab9ca21b"></a><!-- doxytag: member="StunTypeDependentFilter" ref="a73736c0f7526e31ef6a35dcc0ebd34cea95e89f62cc776f2748e6b7acab9ca21b" args="" -->StunTypeDependentFilter</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34ceaa88866074d2d5647775372d25b3fce1c"></a><!-- doxytag: member="StunTypePortDependedFilter" ref="a73736c0f7526e31ef6a35dcc0ebd34ceaa88866074d2d5647775372d25b3fce1c" args="" -->StunTypePortDependedFilter</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34cea4c280e1f155fc93c334cc7ecbc604d53"></a><!-- doxytag: member="StunTypeDependentMapping" ref="a73736c0f7526e31ef6a35dcc0ebd34cea4c280e1f155fc93c334cc7ecbc604d53" args="" -->StunTypeDependentMapping</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73736c0f7526e31ef6a35dcc0ebd34cea9261e686e3bb05ccc44ca40b467f0114"></a><!-- doxytag: member="StunTypeFirewall" ref="a73736c0f7526e31ef6a35dcc0ebd34cea9261e686e3bb05ccc44ca40b467f0114" args="" -->StunTypeFirewall</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="stun_8h_source.html#l00178">178</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <a class="code" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34cea22d9f771676123aeb3cabcbdea95c926">StunTypeUnknown</a>=0,
   StunTypeFailure,
   StunTypeOpen,
   StunTypeBlocked,

   StunTypeIndependentFilter,
   StunTypeDependentFilter,
   StunTypePortDependedFilter,
   StunTypeDependentMapping,

   <span class="comment">//StunTypeConeNat,</span>
   <span class="comment">//StunTypeRestrictedNat,</span>
   <span class="comment">//StunTypePortRestrictedNat,</span>
   <span class="comment">//StunTypeSymNat,</span>
   
   StunTypeFirewall,
} NatType;
</pre></div></p>

</div>
</div>
<a class="anchor" id="a34b28b79962a644f2df54bfa8386c634"></a><!-- doxytag: member="stun.h::StunHmacStatus" ref="a34b28b79962a644f2df54bfa8386c634" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634">StunHmacStatus</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a34b28b79962a644f2df54bfa8386c634a8884039082a87797e3274859c476933d"></a><!-- doxytag: member="HmacUnkown" ref="a34b28b79962a644f2df54bfa8386c634a8884039082a87797e3274859c476933d" args="" -->HmacUnkown</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a34b28b79962a644f2df54bfa8386c634ae30d219a67299e2de2de0f92ea271500"></a><!-- doxytag: member="HmacOK" ref="a34b28b79962a644f2df54bfa8386c634ae30d219a67299e2de2de0f92ea271500" args="" -->HmacOK</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a34b28b79962a644f2df54bfa8386c634a78a33c91a6ba7b1b26a52b049d505d9a"></a><!-- doxytag: member="HmacBadUserName" ref="a34b28b79962a644f2df54bfa8386c634a78a33c91a6ba7b1b26a52b049d505d9a" args="" -->HmacBadUserName</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a34b28b79962a644f2df54bfa8386c634a837bdc7282cb4582526324d37a307c0c"></a><!-- doxytag: member="HmacUnkownUserName" ref="a34b28b79962a644f2df54bfa8386c634a837bdc7282cb4582526324d37a307c0c" args="" -->HmacUnkownUserName</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a34b28b79962a644f2df54bfa8386c634aebbbf675be80e2fbaa87c800065572f9"></a><!-- doxytag: member="HmacFailed" ref="a34b28b79962a644f2df54bfa8386c634aebbbf675be80e2fbaa87c800065572f9" args="" -->HmacFailed</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="stun_8h_source.html#l00118">118</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <a class="code" href="stun_8h.html#a34b28b79962a644f2df54bfa8386c634a8884039082a87797e3274859c476933d">HmacUnkown</a>=0,
   HmacOK,
   HmacBadUserName,
   HmacUnkownUserName,
   HmacFailed,
} StunHmacStatus;
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1c697cf71a93848c4084830478678f29"></a><!-- doxytag: member="stun.h::operator&lt;&lt;" ref="a1c697cf71a93848c4084830478678f29" args="(std::ostream &amp;strm, const StunAddress4 &amp;addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&nbsp;</td>
          <td class="paramname"> <em>strm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>addr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>prints a StunAddress </p>

</div>
</div>
<a class="anchor" id="a589c7eea05e3add4d78b28ebb0dc1be3"></a><!-- doxytag: member="stun.h::operator&lt;&lt;" ref="a589c7eea05e3add4d78b28ebb0dc1be3" args="(std::ostream &amp;strm, const UInt128 &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&nbsp;</td>
          <td class="paramname"> <em>strm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structUInt128.html">UInt128</a> &amp;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a663e56a2d581f365fb4918a0f9a88a2d"></a><!-- doxytag: member="stun.h::stunBuildReqSimple" ref="a663e56a2d581f365fb4918a0f9a88a2d" args="(StunMessage *msg, const StunAtrString &amp;username, bool changePort, bool changeIp, unsigned int id=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stunBuildReqSimple </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunMessage.html">StunMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structStunAtrString.html">StunAtrString</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>changePort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>changeIp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>id</em> = <code>0</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01697">1697</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01734">stunSendTest()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert( msg );
   memset( msg , 0 , <span class="keyword">sizeof</span>(*msg) );

   msg-&gt;<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a7cc96e6cbb87582e56f298eb891c43e2">msgType</a> = <a class="code" href="stun_8h.html#a4dfa49ebae731be7b582f0fc7b57d429">BindRequestMsg</a>;

   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;16; i=i+4 )
   {
      assert(i+3&lt;16);
      <span class="keywordtype">int</span> r = <a class="code" href="stun_8cc.html#a67e399c9420f09178de194bee0bde87a">stunRand</a>();
      msg-&gt;<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a>.<a class="code" href="structUInt128.html#ad6062a8c4f066ea23ad6f42608eee6ea">octet</a>[i+0]= r&gt;&gt;0;
      msg-&gt;<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a>.<a class="code" href="structUInt128.html#ad6062a8c4f066ea23ad6f42608eee6ea">octet</a>[i+1]= r&gt;&gt;8;
      msg-&gt;<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a>.<a class="code" href="structUInt128.html#ad6062a8c4f066ea23ad6f42608eee6ea">octet</a>[i+2]= r&gt;&gt;16;
      msg-&gt;<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a>.<a class="code" href="structUInt128.html#ad6062a8c4f066ea23ad6f42608eee6ea">octet</a>[i+3]= r&gt;&gt;24;
   }

   <span class="keywordflow">if</span> ( <span class="keywordtype">id</span> != 0 )
   {
      msg-&gt;<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a>.<a class="code" href="structUInt128.html#ad6062a8c4f066ea23ad6f42608eee6ea">octet</a>[0] = id;
   }

   msg-&gt;<a class="code" href="structStunMessage.html#a0fe2488f060fe65507c9a58bbb66899f">hasChangeRequest</a> = <span class="keyword">true</span>;
   msg-&gt;<a class="code" href="structStunMessage.html#a65e5de40376764ea12d96f5b5ebe2c29">changeRequest</a>.<a class="code" href="structStunAtrChangeRequest.html#adbb006a8e7cc0637d01959c8ba985c0c">value</a> =(changeIp?<a class="code" href="stun_8h.html#ad0235d173b2af6e92be9843aaa585eef">ChangeIpFlag</a>:0) |
      (changePort?<a class="code" href="stun_8h.html#a2f247c137dd06ef8971319b9a6078ef4">ChangePortFlag</a>:0);

   <span class="keywordflow">if</span> ( username.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> &gt; 0 )
   {
      msg-&gt;<a class="code" href="structStunMessage.html#a2a22a4f1560b25fcf5247647885bab3c">hasUsername</a> = <span class="keyword">true</span>;
      msg-&gt;<a class="code" href="structStunMessage.html#ab5c364c8f9339a6d4f314ce3819ed1fd">username</a> = username;
   }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8926aedab40d08f5cff31d759415962"></a><!-- doxytag: member="stun.h::stunCreatePassword" ref="aa8926aedab40d08f5cff31d759415962" args="(const StunAtrString &amp;username, StunAtrString *password)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stunCreatePassword </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structStunAtrString.html">StunAtrString</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAtrString.html">StunAtrString</a> *&nbsp;</td>
          <td class="paramname"> <em>password</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00802">802</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01002">stunCreateSharedSecretResponse()</a>, <a class="el" href="stun_8cc_source.html#l01801">stunGetUserNameAndPassword()</a>, and <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <span class="keywordtype">char</span> hmac[20];
   <span class="keywordtype">char</span> key[] = <span class="stringliteral">&quot;Fluffy&quot;</span>;
   <span class="comment">//char buffer[STUN_MAX_STRING];</span>
   <a class="code" href="stun_8cc.html#afdae90956a999518a90595e783525734">computeHmac</a>(hmac, username.<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a>, strlen(username.<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a>), key, strlen(key));
   <a class="code" href="stun_8cc.html#a2c6016ed098c5abccd8fd044c02fb6dc">toHex</a>(hmac, 20, password-&gt;<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a>);
   password-&gt;<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 40;
   password-&gt;<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a>[40]=0;

   <span class="comment">//clog &lt;&lt; &quot;password=&quot; &lt;&lt; password-&gt;value &lt;&lt; endl;</span>
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad8f7e4041f7591f4b621625c9190e80f"></a><!-- doxytag: member="stun.h::stunCreateUserName" ref="ad8f7e4041f7591f4b621625c9190e80f" args="(const StunAddress4 &amp;addr, StunAtrString *username)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stunCreateUserName </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAtrString.html">StunAtrString</a> *&nbsp;</td>
          <td class="paramname"> <em>username</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00764">764</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01002">stunCreateSharedSecretResponse()</a>, and <a class="el" href="stun_8cc_source.html#l01801">stunGetUserNameAndPassword()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <a class="code" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a> time = <a class="code" href="stun_8cc.html#a43c07bd7f476e16ea3e48a1033e90ba0">stunGetSystemTimeSecs</a>();
   time -= (time % 20*60);
   <span class="comment">//UInt64 hitime = time &gt;&gt; 32;</span>
   <a class="code" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a> lotime = time &amp; 0xFFFFFFFF;

   <span class="keywordtype">char</span> buffer[1024];
   sprintf(buffer,
           <span class="stringliteral">&quot;%08x:%08x:%08x:&quot;</span>,
           <a class="code" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a>(source.addr),
           <a class="code" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a>(<a class="code" href="stun_8cc.html#a67e399c9420f09178de194bee0bde87a">stunRand</a>()),
           <a class="code" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a>(lotime));
   assert( strlen(buffer) &lt; 1024 );

   assert(strlen(buffer) + 41 &lt; <a class="code" href="stun_8h.html#ac4d86797b42c1696b7acbd715481c0b1">STUN_MAX_STRING</a>);

   <span class="keywordtype">char</span> hmac[20];
   <span class="keywordtype">char</span> key[] = <span class="stringliteral">&quot;Jason&quot;</span>;
   <a class="code" href="stun_8cc.html#afdae90956a999518a90595e783525734">computeHmac</a>(hmac, buffer, strlen(buffer), key, strlen(key) );
   <span class="keywordtype">char</span> hmacHex[41];
   <a class="code" href="stun_8cc.html#a2c6016ed098c5abccd8fd044c02fb6dc">toHex</a>(hmac, 20, hmacHex );
   hmacHex[40] =0;

   strcat(buffer,hmacHex);

   <span class="keywordtype">int</span> l = strlen(buffer);
   assert( l+1 &lt; <a class="code" href="stun_8h.html#ac4d86797b42c1696b7acbd715481c0b1">STUN_MAX_STRING</a> );
   assert( l%4 == 0 );

   username-&gt;<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = l;
   memcpy(username-&gt;<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a>,buffer,l);
   username-&gt;<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a>[l]=0;

   <span class="comment">//if (verbose) clog &lt;&lt; &quot;computed username=&quot; &lt;&lt; username.value &lt;&lt; endl;</span>
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a66298d81441f17d6fdd2aa4a4ced894d"></a><!-- doxytag: member="stun.h::stunEncodeMessage" ref="a66298d81441f17d6fdd2aa4a4ced894d" args="(const StunMessage &amp;message, char *buf, unsigned int bufLen, const StunAtrString &amp;password, bool verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int stunEncodeMessage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structStunMessage.html">StunMessage</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>bufLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structStunAtrString.html">StunAtrString</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00544">544</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01734">stunSendTest()</a>, and <a class="el" href="stun_8cc_source.html#l01351">stunServerProcess()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert(bufLen &gt;= <span class="keyword">sizeof</span>(<a class="code" href="structStunMsgHdr.html">StunMsgHdr</a>));
   <span class="keywordtype">char</span>* ptr = buf;

   ptr = <a class="code" href="stun_8cc.html#a495405bc65a0788775febd87866ece36">encode16</a>(ptr, msg.msgHdr.msgType);
   <span class="keywordtype">char</span>* lengthp = ptr;
   ptr = <a class="code" href="stun_8cc.html#a495405bc65a0788775febd87866ece36">encode16</a>(ptr, 0);
   ptr = <a class="code" href="stun_8cc.html#a32bf1e0d5e4833c497c540b4681dd808">encode</a>(ptr, reinterpret_cast&lt;const char*&gt;(msg.msgHdr.id.octet), <span class="keyword">sizeof</span>(msg.msgHdr.id));

   <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding stun message: &quot;</span> &lt;&lt; endl;
   <span class="keywordflow">if</span> (msg.hasMappedAddress)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding MappedAddress: &quot;</span> &lt;&lt; msg.mappedAddress.ipv4 &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a85ef119873a4b4a76012d89f1d6c23fb">encodeAtrAddress4</a> (ptr, <a class="code" href="stun_8h.html#a2479ede510923cc5e8a0c2da5558acc3">MappedAddress</a>, msg.mappedAddress);
   }
   <span class="keywordflow">if</span> (msg.hasResponseAddress)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding ResponseAddress: &quot;</span> &lt;&lt; msg.responseAddress.ipv4 &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a85ef119873a4b4a76012d89f1d6c23fb">encodeAtrAddress4</a>(ptr, <a class="code" href="stun_8h.html#a91ab7c5c3d71a86a77679d0d2786fae8">ResponseAddress</a>, msg.responseAddress);
   }
   <span class="keywordflow">if</span> (msg.hasChangeRequest)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding ChangeRequest: &quot;</span> &lt;&lt; msg.changeRequest.value &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a076612a210669e11d7c284f08b3a34b2">encodeAtrChangeRequest</a>(ptr, msg.changeRequest);
   }
   <span class="keywordflow">if</span> (msg.hasSourceAddress)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding SourceAddress: &quot;</span> &lt;&lt; msg.sourceAddress.ipv4 &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a85ef119873a4b4a76012d89f1d6c23fb">encodeAtrAddress4</a>(ptr, <a class="code" href="stun_8h.html#ab2b81c4c09625b39c5a1d57ee2b460a4">SourceAddress</a>, msg.sourceAddress);
   }
   <span class="keywordflow">if</span> (msg.hasChangedAddress)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding ChangedAddress: &quot;</span> &lt;&lt; msg.changedAddress.ipv4 &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a85ef119873a4b4a76012d89f1d6c23fb">encodeAtrAddress4</a>(ptr, <a class="code" href="stun_8h.html#a930a1eeda1f0620132bfdea315e711f7">ChangedAddress</a>, msg.changedAddress);
   }
   <span class="keywordflow">if</span> (msg.hasUsername)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding Username: &quot;</span> &lt;&lt; msg.username.value &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a765920e3cdcc343b0ed69a8fab4a1736">encodeAtrString</a>(ptr, <a class="code" href="stun_8h.html#a0845232ed07b469d1262348e1618b962">Username</a>, msg.username);
   }
   <span class="keywordflow">if</span> (msg.hasPassword)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding Password: &quot;</span> &lt;&lt; msg.password.value &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a765920e3cdcc343b0ed69a8fab4a1736">encodeAtrString</a>(ptr, <a class="code" href="stun_8h.html#a1741d36983135a1f2eefa1b1473956a2">Password</a>, msg.password);
   }
   <span class="keywordflow">if</span> (msg.hasErrorCode)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding ErrorCode: class=&quot;</span>
                        &lt;&lt; int(msg.errorCode.errorClass)
                        &lt;&lt; <span class="stringliteral">&quot; number=&quot;</span> &lt;&lt; int(msg.errorCode.number)
                        &lt;&lt; <span class="stringliteral">&quot; reason=&quot;</span>
                        &lt;&lt; msg.errorCode.reason
                        &lt;&lt; endl;

      ptr = <a class="code" href="stun_8cc.html#a61a6cc411fa597374048437e28ddffdf">encodeAtrError</a>(ptr, msg.errorCode);
   }
   <span class="keywordflow">if</span> (msg.hasUnknownAttributes)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding UnknownAttribute: ???&quot;</span> &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a09523c814cf26f59012e800713447143">encodeAtrUnknown</a>(ptr, msg.unknownAttributes);
   }
   <span class="keywordflow">if</span> (msg.hasReflectedFrom)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding ReflectedFrom: &quot;</span> &lt;&lt; msg.reflectedFrom.ipv4 &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a85ef119873a4b4a76012d89f1d6c23fb">encodeAtrAddress4</a>(ptr, <a class="code" href="stun_8h.html#a11d1c4b717d340b20582ac7dead1cd49">ReflectedFrom</a>, msg.reflectedFrom);
   }
   <span class="keywordflow">if</span> (msg.hasXorMappedAddress)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding XorMappedAddress: &quot;</span> &lt;&lt; msg.xorMappedAddress.ipv4 &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a85ef119873a4b4a76012d89f1d6c23fb">encodeAtrAddress4</a> (ptr, <a class="code" href="stun_8h.html#afd742381f8d8131e21dac399b8a26c3a">XorMappedAddress</a>, msg.xorMappedAddress);
   }
   <span class="keywordflow">if</span> (msg.xorOnly)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding xorOnly: &quot;</span> &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a3d149acb0bcd480596ea26b73b47d05f">encodeXorOnly</a>( ptr );
   }
   <span class="keywordflow">if</span> (msg.hasServerName)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding ServerName: &quot;</span> &lt;&lt; msg.serverName.value &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a765920e3cdcc343b0ed69a8fab4a1736">encodeAtrString</a>(ptr, <a class="code" href="stun_8h.html#a53f47b517798fa3e1b64313d04168ea2">ServerName</a>, msg.serverName);
   }
   <span class="keywordflow">if</span> (msg.hasSecondaryAddress)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Encoding SecondaryAddress: &quot;</span> &lt;&lt; msg.secondaryAddress.ipv4 &lt;&lt; endl;
      ptr = <a class="code" href="stun_8cc.html#a85ef119873a4b4a76012d89f1d6c23fb">encodeAtrAddress4</a> (ptr, <a class="code" href="stun_8h.html#a4d77a59e0dc2c3c06deb3730baa78f80">SecondaryAddress</a>, msg.secondaryAddress);
   }

   <span class="keywordflow">if</span> (password.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> &gt; 0)
   {
      <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;HMAC with password: &quot;</span> &lt;&lt; password.<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a> &lt;&lt; endl;

      <a class="code" href="structStunAtrIntegrity.html">StunAtrIntegrity</a> integrity;
      <a class="code" href="stun_8cc.html#afdae90956a999518a90595e783525734">computeHmac</a>(integrity.<a class="code" href="structStunAtrIntegrity.html#a584fa6b758583be87dfad5c10da9fd44">hash</a>, buf, <span class="keywordtype">int</span>(ptr-buf) , password.<a class="code" href="structStunAtrString.html#a609965b0f07f831423bda6aaa1b852dc">value</a>, password.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a>);
      ptr = <a class="code" href="stun_8cc.html#ad58a0afd3626cc03abb1d92edbf6c4d3">encodeAtrIntegrity</a>(ptr, integrity);
   }
   <span class="keywordflow">if</span> (verbose) clog &lt;&lt; endl;

   <a class="code" href="stun_8cc.html#a495405bc65a0788775febd87866ece36">encode16</a>(lengthp, <a class="code" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>(ptr - buf - <span class="keyword">sizeof</span>(<a class="code" href="structStunMsgHdr.html">StunMsgHdr</a>)));
   <span class="keywordflow">return</span> int(ptr - buf);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3ff67b4ada35e49cece8ffdc87b92300"></a><!-- doxytag: member="stun.h::stunFindLocalInterfaces" ref="a3ff67b4ada35e49cece8ffdc87b92300" args="(UInt32 *addresses, int maxSize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stunFindLocalInterfaces </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> *&nbsp;</td>
          <td class="paramname"> <em>addresses</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxSize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>returns number of address found - take array or addres </p>

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01630">1630</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
<span class="preprocessor">#if defined(WIN32) || defined(__sparc__)</span>
<span class="preprocessor"></span>   <span class="keywordflow">return</span> 0;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>   <span class="keyword">struct </span>ifconf ifc;

   <span class="keywordtype">int</span> s = socket( AF_INET, SOCK_DGRAM, 0 );
   <span class="keywordtype">int</span> len = 100 * <span class="keyword">sizeof</span>(<span class="keyword">struct </span>ifreq);

   <span class="keywordtype">char</span> buf[ len ];

   ifc.ifc_len = len;
   ifc.ifc_buf = buf;

   <span class="keywordtype">int</span> e = ioctl(s,SIOCGIFCONF,&amp;ifc);
   <span class="keywordtype">char</span> *ptr = buf;
   <span class="keywordtype">int</span> tl = ifc.ifc_len;
   <span class="keywordtype">int</span> count=0;

   <span class="keywordflow">while</span> ( (tl &gt; 0) &amp;&amp; ( count &lt; maxRet) )
   {
      <span class="keyword">struct </span>ifreq* ifr = (<span class="keyword">struct </span>ifreq *)ptr;

      <span class="keywordtype">int</span> si = <span class="keyword">sizeof</span>(ifr-&gt;ifr_name) + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr);
      tl -= si;
      ptr += si;
      <span class="comment">//char* name = ifr-&gt;ifr_ifrn.ifrn_name;</span>
      <span class="comment">//cerr &lt;&lt; &quot;name = &quot; &lt;&lt; name &lt;&lt; endl;</span>

      <span class="keyword">struct </span>ifreq ifr2;
      ifr2 = *ifr;

      e = ioctl(s,SIOCGIFADDR,&amp;ifr2);
      <span class="keywordflow">if</span> ( e == -1 )
      {
         <span class="keywordflow">break</span>;
      }

      <span class="comment">//cerr &lt;&lt; &quot;ioctl addr e = &quot; &lt;&lt; e &lt;&lt; endl;</span>

      <span class="keyword">struct </span>sockaddr a = ifr2.ifr_addr;
      <span class="keyword">struct </span>sockaddr_in* addr = (<span class="keyword">struct </span>sockaddr_in*) &amp;a;

      <a class="code" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> ai = ntohl( addr-&gt;sin_addr.s_addr );
      <span class="keywordflow">if</span> (<span class="keywordtype">int</span>((ai&gt;&gt;24)&amp;0xFF) != 127)
      {
         addresses[count++] = ai;
      }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>      cerr &lt;&lt; <span class="stringliteral">&quot;Detected interface &quot;</span>
           &lt;&lt; int((ai&gt;&gt;24)&amp;0xFF) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>
           &lt;&lt; int((ai&gt;&gt;16)&amp;0xFF) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>
           &lt;&lt; int((ai&gt;&gt; 8)&amp;0xFF) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>
           &lt;&lt; int((ai    )&amp;0xFF) &lt;&lt; endl;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>   }

   <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(s);

   <span class="keywordflow">return</span> count;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a43c07bd7f476e16ea3e48a1033e90ba0"></a><!-- doxytag: member="stun.h::stunGetSystemTimeSecs" ref="a43c07bd7f476e16ea3e48a1033e90ba0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a> stunGetSystemTimeSecs </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00817">817</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00764">stunCreateUserName()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <a class="code" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a> time=0;
<span class="preprocessor">#if defined(WIN32)</span>
<span class="preprocessor"></span>   SYSTEMTIME t;
   <span class="comment">// CJ TODO - this probably has bug on wrap around every 24 hours</span>
   GetSystemTime( &amp;t );
   time = (t.wHour*60+t.wMinute)*60+t.wSecond;
#<span class="keywordflow">else</span>
   <span class="keyword">struct</span> timeval now;
   gettimeofday( &amp;now , NULL );
   <span class="comment">//assert( now );</span>
   time = now.tv_sec;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>   <span class="keywordflow">return</span> time;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9317a5a127d1281953d961bcfbd2496"></a><!-- doxytag: member="stun.h::stunGetUserNameAndPassword" ref="ae9317a5a127d1281953d961bcfbd2496" args="(const StunAddress4 &amp;dest, StunAtrString *username, StunAtrString *password)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stunGetUserNameAndPassword </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAtrString.html">StunAtrString</a> *&nbsp;</td>
          <td class="paramname"> <em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAtrString.html">StunAtrString</a> *&nbsp;</td>
          <td class="paramname"> <em>password</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01801">1801</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01876">stunNatType()</a>, <a class="el" href="stun_8cc_source.html#l02247">stunOpenSocket()</a>, <a class="el" href="stun_8cc_source.html#l02314">stunOpenSocketPair()</a>, and <a class="el" href="stun_8cc_source.html#l01813">stunTest()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <span class="comment">// !cj! This is totally bogus - need to make TLS connection to dest and get a</span>
   <span class="comment">// username and password to use</span>
   <a class="code" href="stun_8cc.html#a5f442520a968eaa3f90caa8dcd40bd33">stunCreateUserName</a>(dest, username);
   <a class="code" href="stun_8cc.html#aa8926aedab40d08f5cff31d759415962">stunCreatePassword</a>(*username, password);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a99639b68ee528c79e96973a2642184a4"></a><!-- doxytag: member="stun.h::stunInitServer" ref="a99639b68ee528c79e96973a2642184a4" args="(StunServerInfo &amp;info, const StunAddress4 &amp;myAddr, const StunAddress4 &amp;altAddr, int startMediaPort, bool verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stunInitServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunServerInfo.html">StunServerInfo</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>myAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>altAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>startMediaPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return true if all is OK Create a media relay and do the STERN thing if startMediaPort is non-zero </p>

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01249">1249</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert( myAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 );
   assert( altAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>!= 0 );
   assert( myAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>  != 0 );
   <span class="comment">//assert( altAddr.addr != 0 );</span>

   info.<a class="code" href="structStunServerInfo.html#a9abf6e6b89123dd6d7a71bba5a0b77d6">myAddr</a> = myAddr;
   info.<a class="code" href="structStunServerInfo.html#ac6295f141e0926994747bbc198a19d55">altAddr</a> = altAddr;

   info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a> = <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>;
   info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a> = <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>;
   info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a> = <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>;
   info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a> = <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>;

   memset(info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>, 0, <span class="keyword">sizeof</span>(info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>));
   <span class="keywordflow">if</span> (startMediaPort &gt; 0)
   {
      info.<a class="code" href="structStunServerInfo.html#a5dcc784d754928455caab60d6a34f73e">relay</a> = <span class="keyword">true</span>;

      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_MEDIA_RELAYS; ++i)
      {
         <a class="code" href="structStunMediaRelay.html">StunMediaRelay</a>* relay = &amp;info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>[i];
         relay-&gt;<a class="code" href="structStunMediaRelay.html#a18c86cb9d0058de5ab6b5adf449a275b">relayPort</a> = startMediaPort+i;
         relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a> = 0;
         relay-&gt;<a class="code" href="structStunMediaRelay.html#a16873193e181c40809e3f3f91bfb78ff">expireTime</a> = 0;
      }
   }
   <span class="keywordflow">else</span>
   {
      info.<a class="code" href="structStunServerInfo.html#a5dcc784d754928455caab60d6a34f73e">relay</a> = <span class="keyword">false</span>;
   }

   <span class="keywordflow">if</span> ((info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a> = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(myAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>, myAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>,verbose)) == <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>)
   {
      clog &lt;&lt; <span class="stringliteral">&quot;Can&#39;t open &quot;</span> &lt;&lt; myAddr &lt;&lt; endl;
      <a class="code" href="stun_8cc.html#a9ed82a9b4b17f3f4d9bf1fd4d5b8bfd2">stunStopServer</a>(info);

      <span class="keywordflow">return</span> <span class="keyword">false</span>;
   }
   <span class="comment">//if (verbose) clog &lt;&lt; &quot;Opened &quot; &lt;&lt; myAddr.addr &lt;&lt; &quot;:&quot; &lt;&lt; myAddr.port &lt;&lt; &quot; --&gt; &quot; &lt;&lt; info.myFd &lt;&lt; endl;</span>

   <span class="keywordflow">if</span> ((info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a> = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(altAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>,myAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>,verbose)) == <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>)
   {
      clog &lt;&lt; <span class="stringliteral">&quot;Can&#39;t open &quot;</span> &lt;&lt; myAddr &lt;&lt; endl;
      <a class="code" href="stun_8cc.html#a9ed82a9b4b17f3f4d9bf1fd4d5b8bfd2">stunStopServer</a>(info);
      <span class="keywordflow">return</span> <span class="keyword">false</span>;
   }
   <span class="comment">//if (verbose) clog &lt;&lt; &quot;Opened &quot; &lt;&lt; myAddr.addr &lt;&lt; &quot;:&quot; &lt;&lt; altAddr.port &lt;&lt; &quot; --&gt; &quot; &lt;&lt; info.altPortFd &lt;&lt; endl;</span>


   info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a> = <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>;
   <span class="keywordflow">if</span> (  altAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 )
   {
      <span class="keywordflow">if</span> ((info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a> = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>( myAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>, altAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>,verbose)) == <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>)
      {
         clog &lt;&lt; <span class="stringliteral">&quot;Can&#39;t open &quot;</span> &lt;&lt; altAddr &lt;&lt; endl;
         <a class="code" href="stun_8cc.html#a9ed82a9b4b17f3f4d9bf1fd4d5b8bfd2">stunStopServer</a>(info);
         <span class="keywordflow">return</span> <span class="keyword">false</span>;
      }
      <span class="comment">//if (verbose) clog &lt;&lt; &quot;Opened &quot; &lt;&lt; altAddr.addr &lt;&lt; &quot;:&quot; &lt;&lt; myAddr.port &lt;&lt; &quot; --&gt; &quot; &lt;&lt; info.altIpFd &lt;&lt; endl;;</span>
   }

   info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a> = <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>;
   <span class="keywordflow">if</span> (  altAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 )
   {  <span class="keywordflow">if</span> ((info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a> = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(altAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>, altAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>,verbose)) == <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>)
      {
         clog &lt;&lt; <span class="stringliteral">&quot;Can&#39;t open &quot;</span> &lt;&lt; altAddr &lt;&lt; endl;
         <a class="code" href="stun_8cc.html#a9ed82a9b4b17f3f4d9bf1fd4d5b8bfd2">stunStopServer</a>(info);
         <span class="keywordflow">return</span> <span class="keyword">false</span>;
      }
      <span class="comment">//if (verbose) clog &lt;&lt; &quot;Opened &quot; &lt;&lt; altAddr.addr &lt;&lt; &quot;:&quot; &lt;&lt; altAddr.port &lt;&lt; &quot; --&gt; &quot; &lt;&lt; info.altIpPortFd &lt;&lt; endl;;</span>
   }

   <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69e8446b6e540c25e14538b1760d3e84"></a><!-- doxytag: member="stun.h::stunNatType" ref="a69e8446b6e540c25e14538b1760d3e84" args="(StunAddress4 &amp;dest, bool verbose, bool *preservePort=0, bool *hairpin=0, int port=0, StunAddress4 *sAddr=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stun_8h.html#a73736c0f7526e31ef6a35dcc0ebd34ce">NatType</a> stunNatType </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&nbsp;</td>
          <td class="paramname"> <em>preservePort</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&nbsp;</td>
          <td class="paramname"> <em>hairpin</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> *&nbsp;</td>
          <td class="paramname"> <em>sAddr</em> = <code>0</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01876">1876</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="SingleHostUnderlayConfigurator_8cc_source.html#l00057">SingleHostUnderlayConfigurator::initializeUnderlay()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert( dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 );
   assert( dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 );

   <span class="keywordflow">if</span> ( hairpin )
   {
      *hairpin = <span class="keyword">false</span>;
   }

   <span class="keywordflow">if</span> ( port == 0 )
   {
      port = <a class="code" href="stun_8cc.html#ad4a19c401bea76c471959a32a19b777e" title="return a random number to use as a port">stunRandomPort</a>();
   }
   <a class="code" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> interfaceIp=0;
   <span class="keywordflow">if</span> (sAddr)
   {
      interfaceIp = sAddr-&gt;<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
   }
   <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> myFd1 = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(port,interfaceIp,verbose);
   <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> myFd2 = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(port+1,interfaceIp,verbose);

   <span class="keywordflow">if</span> ( ( myFd1 == <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>) || ( myFd2 == <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>) )
   {
        cerr &lt;&lt; <span class="stringliteral">&quot;Some problem opening port/interface to send on&quot;</span> &lt;&lt; endl;
       <span class="keywordflow">return</span> StunTypeFailure;
   }

   assert( myFd1 != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> );
   assert( myFd2 != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> );

   <span class="keywordtype">bool</span> respTestI=<span class="keyword">false</span>;
   <span class="keywordtype">bool</span> isNat=<span class="keyword">true</span>;
   <a class="code" href="structStunAddress4.html">StunAddress4</a> testIchangedAddr;
   <a class="code" href="structStunAddress4.html">StunAddress4</a> testImappedAddr;
   <span class="keywordtype">bool</span> respTestI2=<span class="keyword">false</span>;
   <span class="keywordtype">bool</span> mappedIpSame = <span class="keyword">true</span>;
   <a class="code" href="structStunAddress4.html">StunAddress4</a> testI2mappedAddr;
   <a class="code" href="structStunAddress4.html">StunAddress4</a> testI2dest=dest;
   <span class="keywordtype">bool</span> respTestII=<span class="keyword">false</span>;
   <span class="keywordtype">bool</span> respTestIII=<span class="keyword">false</span>;

   <span class="keywordtype">bool</span> respTestHairpin=<span class="keyword">false</span>;
   <span class="keywordtype">bool</span> respTestPreservePort=<span class="keyword">false</span>;

   memset(&amp;testImappedAddr,0,<span class="keyword">sizeof</span>(testImappedAddr));

   <a class="code" href="structStunAtrString.html">StunAtrString</a> username;
   <a class="code" href="structStunAtrString.html">StunAtrString</a> password;

   username.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;
   password.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;

<span class="preprocessor">#ifdef USE_TLS</span>
<span class="preprocessor"></span>   <a class="code" href="stun_8cc.html#ae9317a5a127d1281953d961bcfbd2496">stunGetUserNameAndPassword</a>( dest, username, password );
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
   <span class="keywordtype">int</span> count=0;
   <span class="keywordflow">while</span> ( count &lt; 7 )
   {
      <span class="keyword">struct </span>timeval tv;
      fd_set fdSet;
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fdSetSize;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      <span class="keywordtype">int</span> fdSetSize;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      FD_ZERO(&amp;fdSet); fdSetSize=0;
      FD_SET(myFd1,&amp;fdSet); fdSetSize = (myFd1+1&gt;fdSetSize) ? myFd1+1 : fdSetSize;
      FD_SET(myFd2,&amp;fdSet); fdSetSize = (myFd2+1&gt;fdSetSize) ? myFd2+1 : fdSetSize;
      tv.tv_sec=0;
      tv.tv_usec=150*1000; <span class="comment">// 150 ms</span>
      <span class="keywordflow">if</span> ( count == 0 ) tv.tv_usec=0;

      <span class="keywordtype">int</span>  err = select(fdSetSize, &amp;fdSet, NULL, NULL, &amp;tv);
      <span class="keywordtype">int</span> e = <a class="code" href="stun__udp_8h.html#a604d53fe9d66ce3a47ab2354b20f8e62">getErrno</a>();
      <span class="keywordflow">if</span> ( err == <a class="code" href="stun__udp_8h.html#a5196d10051a93efa5a7e25054b48c236">STUN_SOCKET_ERROR</a> )
      {
         <span class="comment">// error occured</span>
         cerr &lt;&lt; <span class="stringliteral">&quot;Error &quot;</span> &lt;&lt; e &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; strerror(e) &lt;&lt; <span class="stringliteral">&quot; in select&quot;</span> &lt;&lt; endl;
        <span class="keywordflow">return</span> StunTypeFailure;
     }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( err == 0 )
      {
         <span class="comment">// timeout occured</span>
         count++;

         <span class="keywordflow">if</span> ( !respTestI )
         {
            <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>( myFd1, dest, username, password, 1 ,verbose );
         }

         <span class="keywordflow">if</span> ( (!respTestI2) &amp;&amp; respTestI )
         {
            <span class="comment">// check the address to send to if valid</span>
            <span class="keywordflow">if</span> (  ( testI2dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 ) &amp;&amp;
                  ( testI2dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 ) )
            {
               <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>( myFd1, testI2dest, username, password, 10  ,verbose);
            }
         }

         <span class="keywordflow">if</span> ( !respTestII )
         {
            <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>( myFd2, dest, username, password, 2 ,verbose );
         }

         <span class="keywordflow">if</span> ( !respTestIII )
         {
            <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>( myFd2, dest, username, password, 3 ,verbose );
         }

         <span class="keywordflow">if</span> ( respTestI &amp;&amp; (!respTestHairpin) )
         {
            <span class="keywordflow">if</span> (  ( testImappedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 ) &amp;&amp;
                  ( testImappedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 ) )
            {
               <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>( myFd1, testImappedAddr, username, password, 11 ,verbose );
            }
         }
      }
      <span class="keywordflow">else</span>
      {
         <span class="comment">//if (verbose) clog &lt;&lt; &quot;-----------------------------------------&quot; &lt;&lt; endl;</span>
         assert( err&gt;0 );
         <span class="comment">// data is avialbe on some fd</span>

         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;2; i++)
         {
            <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> myFd;
            <span class="keywordflow">if</span> ( i==0 )
            {
               myFd=myFd1;
            }
            <span class="keywordflow">else</span>
            {
               myFd=myFd2;
            }

            <span class="keywordflow">if</span> ( myFd!=<a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> )
            {
               <span class="keywordflow">if</span> ( FD_ISSET(myFd,&amp;fdSet) )
               {
                  <span class="keywordtype">char</span> msg[STUN_MAX_MESSAGE_SIZE];
                  <span class="keywordtype">int</span> msgLen = <span class="keyword">sizeof</span>(msg);

                  <a class="code" href="structStunAddress4.html">StunAddress4</a> from;

                  <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( myFd,
                              msg,
                              &amp;msgLen,
                              &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>,
                              &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>,verbose );

                  <a class="code" href="structStunMessage.html">StunMessage</a> resp;
                  memset(&amp;resp, 0, <span class="keyword">sizeof</span>(<a class="code" href="structStunMessage.html">StunMessage</a>));

                  <a class="code" href="stun_8cc.html#af81c30137f26a4cb158b48aa21f4f681">stunParseMessage</a>( msg,msgLen, resp,verbose );

                  <span class="keywordflow">if</span> ( verbose )
                  {
                     clog &lt;&lt; <span class="stringliteral">&quot;Received message of type &quot;</span> &lt;&lt; resp.<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a7cc96e6cbb87582e56f298eb891c43e2">msgType</a>
                          &lt;&lt; <span class="stringliteral">&quot;  id=&quot;</span> &lt;&lt; (int)(resp.<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a>.<a class="code" href="structUInt128.html#ad6062a8c4f066ea23ad6f42608eee6ea">octet</a>[0]) &lt;&lt; endl;
                  }

                  <span class="keywordflow">switch</span>( resp.<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a>.<a class="code" href="structUInt128.html#ad6062a8c4f066ea23ad6f42608eee6ea">octet</a>[0] )
                  {
                     <span class="keywordflow">case</span> 1:
                     {
                        <span class="keywordflow">if</span> ( !respTestI )
                        {

                           testIchangedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = resp.<a class="code" href="structStunMessage.html#ac240bd9424c010b74411679f1813a705">changedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
                           testIchangedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = resp.<a class="code" href="structStunMessage.html#ac240bd9424c010b74411679f1813a705">changedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>;
                           testImappedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
                           testImappedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>;

                           respTestPreservePort = ( testImappedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> == port );
                           <span class="keywordflow">if</span> ( preservePort )
                           {
                              *preservePort = respTestPreservePort;
                           }

                           testI2dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = resp.<a class="code" href="structStunMessage.html#ac240bd9424c010b74411679f1813a705">changedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;

                           <span class="keywordflow">if</span> (sAddr)
                           {
                              sAddr-&gt;<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = testImappedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>;
                              sAddr-&gt;<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = testImappedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
                           }

                           count = 0;
                        }
                        respTestI=<span class="keyword">true</span>;
                     }
                     <span class="keywordflow">break</span>;
                     <span class="keywordflow">case</span> 2:
                     {
                        respTestII=<span class="keyword">true</span>;
                     }
                     <span class="keywordflow">break</span>;
                     <span class="keywordflow">case</span> 3:
                     {
                        respTestIII=<span class="keyword">true</span>;
                     }
                     <span class="keywordflow">break</span>;
                     <span class="keywordflow">case</span> 10:
                     {
                        <span class="keywordflow">if</span> ( !respTestI2 )
                        {
                           testI2mappedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
                           testI2mappedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>;

                           mappedIpSame = <span class="keyword">false</span>;
                           <span class="keywordflow">if</span> ( (testI2mappedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>  == testImappedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> ) &amp;&amp;
                                (testI2mappedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> == testImappedAddr.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> ))
                           {
                              mappedIpSame = <span class="keyword">true</span>;
                           }


                        }
                        respTestI2=<span class="keyword">true</span>;
                     }
                     <span class="keywordflow">break</span>;
                     <span class="keywordflow">case</span> 11:
                     {

                        <span class="keywordflow">if</span> ( hairpin )
                        {
                           *hairpin = <span class="keyword">true</span>;
                        }
                        respTestHairpin = <span class="keyword">true</span>;
                     }
                     <span class="keywordflow">break</span>;
                  }
               }
            }
         }
      }
   }

   <span class="comment">// see if we can bind to this address</span>
   <span class="comment">//cerr &lt;&lt; &quot;try binding to &quot; &lt;&lt; testImappedAddr &lt;&lt; endl;</span>
   <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> s = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>( 0<span class="comment">/*use ephemeral*/</span>, testImappedAddr.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, <span class="keyword">false</span> );
   <span class="keywordflow">if</span> ( s != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> )
   {
      <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(s);
      isNat = <span class="keyword">false</span>;
      <span class="comment">//cerr &lt;&lt; &quot;binding worked&quot; &lt;&lt; endl;</span>
   }
   <span class="keywordflow">else</span>
   {
      isNat = <span class="keyword">true</span>;
      <span class="comment">//cerr &lt;&lt; &quot;binding failed&quot; &lt;&lt; endl;</span>
   }

   <span class="keywordflow">if</span> (verbose)
   {
      clog &lt;&lt; <span class="stringliteral">&quot;test I = &quot;</span> &lt;&lt; respTestI &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;test II = &quot;</span> &lt;&lt; respTestII &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;test III = &quot;</span> &lt;&lt; respTestIII &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;test I(2) = &quot;</span> &lt;&lt; respTestI2 &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;is nat  = &quot;</span> &lt;&lt; isNat &lt;&lt;endl;
      clog &lt;&lt; <span class="stringliteral">&quot;mapped IP same = &quot;</span> &lt;&lt; mappedIpSame &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;hairpin = &quot;</span> &lt;&lt; respTestHairpin &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;preserver port = &quot;</span> &lt;&lt; respTestPreservePort &lt;&lt; endl;
   }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>   <span class="comment">// implement logic flow chart from draft RFC</span>
   <span class="keywordflow">if</span> ( respTestI )
   {
      <span class="keywordflow">if</span> ( isNat )
      {
         <span class="keywordflow">if</span> (respTestII)
         {
            <span class="keywordflow">return</span> StunTypeConeNat;
         }
         <span class="keywordflow">else</span>
         {
            <span class="keywordflow">if</span> ( mappedIpSame )
            {
               <span class="keywordflow">if</span> ( respTestIII )
               {
                  <span class="keywordflow">return</span> StunTypeRestrictedNat;
               }
               <span class="keywordflow">else</span>
               {
                  <span class="keywordflow">return</span> StunTypePortRestrictedNat;
               }
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">return</span> StunTypeSymNat;
            }
         }
      }
      <span class="keywordflow">else</span>
      {
         <span class="keywordflow">if</span> (respTestII)
         {
            <span class="keywordflow">return</span> StunTypeOpen;
         }
         <span class="keywordflow">else</span>
         {
            <span class="keywordflow">return</span> StunTypeSymFirewall;
         }
      }
   }
   <span class="keywordflow">else</span>
   {
      <span class="keywordflow">return</span> StunTypeBlocked;
   }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>   <span class="keywordflow">if</span> ( respTestI ) <span class="comment">// not blocked</span>
   {
      <span class="keywordflow">if</span> ( isNat )
      {
         <span class="keywordflow">if</span> ( mappedIpSame )
         {
            <span class="keywordflow">if</span> (respTestII)
            {
               <span class="keywordflow">return</span> StunTypeIndependentFilter;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> ( respTestIII )
               {
                  <span class="keywordflow">return</span> StunTypeDependentFilter;
               }
               <span class="keywordflow">else</span>
               {
                  <span class="keywordflow">return</span> StunTypePortDependedFilter;
               }
            }
         }
         <span class="keywordflow">else</span> <span class="comment">// mappedIp is not same</span>
         {
            <span class="keywordflow">return</span> StunTypeDependentMapping;
         }
      }
      <span class="keywordflow">else</span>  <span class="comment">// isNat is false</span>
      {
         <span class="keywordflow">if</span> (respTestII)
         {
            <span class="keywordflow">return</span> StunTypeOpen;
         }
         <span class="keywordflow">else</span>
         {
            <span class="keywordflow">return</span> StunTypeFirewall;
         }
      }
   }
   <span class="keywordflow">else</span>
   {
      <span class="keywordflow">return</span> StunTypeBlocked;
   }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
   <span class="keywordflow">return</span> StunTypeUnknown;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5956654577cee7e80cbd7abfb06d3c7e"></a><!-- doxytag: member="stun.h::stunOpenSocket" ref="a5956654577cee7e80cbd7abfb06d3c7e" args="(StunAddress4 &amp;dest, StunAddress4 *mappedAddr, int port=0, StunAddress4 *srcAddr=0, bool verbose=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stunOpenSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> *&nbsp;</td>
          <td class="paramname"> <em>mappedAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> *&nbsp;</td>
          <td class="paramname"> <em>srcAddr</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l02247">2247</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert( dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 );
   assert( dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 );
   assert( mapAddr );

   <span class="keywordflow">if</span> ( port == 0 )
   {
      port = <a class="code" href="stun_8cc.html#ad4a19c401bea76c471959a32a19b777e" title="return a random number to use as a port">stunRandomPort</a>();
   }
   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interfaceIp = 0;
   <span class="keywordflow">if</span> ( srcAddr )
   {
      interfaceIp = srcAddr-&gt;<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
   }

   <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> myFd = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(port,interfaceIp,verbose);
   <span class="keywordflow">if</span> (myFd == <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>)
   {
      <span class="keywordflow">return</span> myFd;
   }

   <span class="keywordtype">char</span> msg[STUN_MAX_MESSAGE_SIZE];
   <span class="keywordtype">int</span> msgLen = <span class="keyword">sizeof</span>(msg);

   <a class="code" href="structStunAtrString.html">StunAtrString</a> username;
   <a class="code" href="structStunAtrString.html">StunAtrString</a> password;

   username.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;
   password.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;

<span class="preprocessor">#ifdef USE_TLS</span>
<span class="preprocessor"></span>   <a class="code" href="stun_8cc.html#ae9317a5a127d1281953d961bcfbd2496">stunGetUserNameAndPassword</a>( dest, username, password );
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
   <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>(myFd, dest, username, password, 1, 0<span class="comment">/*false*/</span> );

   <a class="code" href="structStunAddress4.html">StunAddress4</a> from;

   <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( myFd, msg, &amp;msgLen, &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>,verbose );

   <a class="code" href="structStunMessage.html">StunMessage</a> resp;
   memset(&amp;resp, 0, <span class="keyword">sizeof</span>(<a class="code" href="structStunMessage.html">StunMessage</a>));

   <span class="keywordtype">bool</span> ok = <a class="code" href="stun_8cc.html#af81c30137f26a4cb158b48aa21f4f681">stunParseMessage</a>( msg, msgLen, resp,verbose );
   <span class="keywordflow">if</span> (!ok)
   {
      <span class="keywordflow">return</span> -1;
   }

   <a class="code" href="structStunAddress4.html">StunAddress4</a> mappedAddr = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>;
   <a class="code" href="structStunAddress4.html">StunAddress4</a> changedAddr = resp.<a class="code" href="structStunMessage.html#ac240bd9424c010b74411679f1813a705">changedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>;

   <span class="comment">//clog &lt;&lt; &quot;--- stunOpenSocket --- &quot; &lt;&lt; endl;</span>
   <span class="comment">//clog &lt;&lt; &quot;\treq  id=&quot; &lt;&lt; req.id &lt;&lt; endl;</span>
   <span class="comment">//clog &lt;&lt; &quot;\tresp id=&quot; &lt;&lt; id &lt;&lt; endl;</span>
   <span class="comment">//clog &lt;&lt; &quot;\tmappedAddr=&quot; &lt;&lt; mappedAddr &lt;&lt; endl;</span>

   *mapAddr = mappedAddr;

   <span class="keywordflow">return</span> myFd;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa4e28e0945cd1bdbf6610c6eb87db956"></a><!-- doxytag: member="stun.h::stunOpenSocketPair" ref="aa4e28e0945cd1bdbf6610c6eb87db956" args="(StunAddress4 &amp;dest, StunAddress4 *mappedAddr, int *fd1, int *fd2, int srcPort=0, StunAddress4 *srcAddr=0, bool verbose=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stunOpenSocketPair </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> *&nbsp;</td>
          <td class="paramname"> <em>mappedAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>fd1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>fd2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>srcPort</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> *&nbsp;</td>
          <td class="paramname"> <em>srcAddr</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l02314">2314</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert( dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>!= 0 );
   assert( dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 );
   assert( mapAddr );

   <span class="keyword">const</span> <span class="keywordtype">int</span> NUM=3;

   <span class="keywordflow">if</span> ( port == 0 )
   {
      port = <a class="code" href="stun_8cc.html#ad4a19c401bea76c471959a32a19b777e" title="return a random number to use as a port">stunRandomPort</a>();
   }

   *fd1=-1;
   *fd2=-1;

   <span class="keywordtype">char</span> msg[STUN_MAX_MESSAGE_SIZE];
   <span class="keywordtype">int</span> msgLen =<span class="keyword">sizeof</span>(msg);

   <a class="code" href="structStunAddress4.html">StunAddress4</a> from;
   <span class="keywordtype">int</span> fd[NUM];
   <span class="keywordtype">int</span> i;

   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interfaceIp = 0;
   <span class="keywordflow">if</span> ( srcAddr )
   {
      interfaceIp = srcAddr-&gt;<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
   }

   <span class="keywordflow">for</span>( i=0; i&lt;NUM; i++)
   {
      fd[i] = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>( (port == 0) ? 0 : (port + i),
                        interfaceIp, verbose);
      <span class="keywordflow">if</span> (fd[i] &lt; 0)
      {
         <span class="keywordflow">while</span> (i &gt; 0)
         {
            <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(fd[--i]);
         }
         <span class="keywordflow">return</span> <span class="keyword">false</span>;
      }
   }

   <a class="code" href="structStunAtrString.html">StunAtrString</a> username;
   <a class="code" href="structStunAtrString.html">StunAtrString</a> password;

   username.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;
   password.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;

<span class="preprocessor">#ifdef USE_TLS</span>
<span class="preprocessor"></span>   <a class="code" href="stun_8cc.html#ae9317a5a127d1281953d961bcfbd2496">stunGetUserNameAndPassword</a>( dest, username, password );
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
   <span class="keywordflow">for</span>( i=0; i&lt;NUM; i++)
   {
      <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>(fd[i], dest, username, password, 1<span class="comment">/*testNum*/</span>, verbose );
   }

   <a class="code" href="structStunAddress4.html">StunAddress4</a> mappedAddr[NUM];
   <span class="keywordflow">for</span>( i=0; i&lt;NUM; i++)
   {
      msgLen = <span class="keyword">sizeof</span>(msg)/<span class="keyword">sizeof</span>(*msg);
      <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( fd[i],
                  msg,
                  &amp;msgLen,
                  &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>,
                  &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> ,verbose);

      <a class="code" href="structStunMessage.html">StunMessage</a> resp;
      memset(&amp;resp, 0, <span class="keyword">sizeof</span>(<a class="code" href="structStunMessage.html">StunMessage</a>));

      <span class="keywordtype">bool</span> ok = <a class="code" href="stun_8cc.html#af81c30137f26a4cb158b48aa21f4f681">stunParseMessage</a>( msg, msgLen, resp, verbose );
      <span class="keywordflow">if</span> (!ok)
      {
         <span class="keywordflow">return</span> <span class="keyword">false</span>;
      }

      mappedAddr[i] = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>;
      <a class="code" href="structStunAddress4.html">StunAddress4</a> changedAddr = resp.<a class="code" href="structStunMessage.html#ac240bd9424c010b74411679f1813a705">changedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>;
   }

   <span class="keywordflow">if</span> (verbose)
   {
      clog &lt;&lt; <span class="stringliteral">&quot;--- stunOpenSocketPair --- &quot;</span> &lt;&lt; endl;
      <span class="keywordflow">for</span>( i=0; i&lt;NUM; i++)
      {
         clog &lt;&lt; <span class="stringliteral">&quot;\t mappedAddr=&quot;</span> &lt;&lt; mappedAddr[i] &lt;&lt; endl;
      }
   }

   <span class="keywordflow">if</span> ( mappedAddr[0].port %2 == 0 )
   {
      <span class="keywordflow">if</span> (  mappedAddr[0].port+1 ==  mappedAddr[1].port )
      {
         *mapAddr = mappedAddr[0];
         *fd1 = fd[0];
         *fd2 = fd[1];
         <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>( fd[2] );
         <span class="keywordflow">return</span> <span class="keyword">true</span>;
      }
   }
   <span class="keywordflow">else</span>
   {
      <span class="keywordflow">if</span> (( mappedAddr[1].port %2 == 0 )
          &amp;&amp; (  mappedAddr[1].port+1 ==  mappedAddr[2].port ))
      {
         *mapAddr = mappedAddr[1];
         *fd1 = fd[1];
         *fd2 = fd[2];
         <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>( fd[0] );
         <span class="keywordflow">return</span> <span class="keyword">true</span>;
      }
   }

   <span class="comment">// something failed, close all and return error</span>
   <span class="keywordflow">for</span>( i=0; i&lt;NUM; i++)
   {
      <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>( fd[i] );
   }

   <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="af497f133b72e1dc4595d9d293d706351"></a><!-- doxytag: member="stun.h::stunParseHostName" ref="af497f133b72e1dc4595d9d293d706351" args="(char *peerName, UInt32 &amp;ip, UInt16 &amp;portVal, UInt16 defaultPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stunParseHostName </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>peerName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>ip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>portVal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a>&nbsp;</td>
          <td class="paramname"> <em>defaultPort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00863">863</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00964">stunParseServerName()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   in_addr sin_addr;

   <span class="keywordtype">char</span> host[512];
   strncpy(host,peerName,512);
   host[512-1]=<span class="charliteral">&#39;\0&#39;</span>;
   <span class="keywordtype">char</span>* port = NULL;

   <span class="keywordtype">int</span> portNum = defaultPort;

   <span class="comment">// pull out the port part if present.</span>
   <span class="keywordtype">char</span>* sep = strchr(host,<span class="charliteral">&#39;:&#39;</span>);

   <span class="keywordflow">if</span> ( sep == NULL )
   {
      portNum = defaultPort;
   }
   <span class="keywordflow">else</span>
   {
      *sep = <span class="charliteral">&#39;\0&#39;</span>;
      port = sep + 1;
      <span class="comment">// set port part</span>

      <span class="keywordtype">char</span>* endPtr=NULL;

      portNum = strtol(port,&amp;endPtr,10);

      <span class="keywordflow">if</span> ( endPtr != NULL )
      {
         <span class="keywordflow">if</span> ( *endPtr != <span class="charliteral">&#39;\0&#39;</span> )
         {
            portNum = defaultPort;
         }
      }
   }

   <span class="keywordflow">if</span> ( portNum &lt; 1024 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
   <span class="keywordflow">if</span> ( portNum &gt;= 0xFFFF ) <span class="keywordflow">return</span> <span class="keyword">false</span>;

   <span class="comment">// figure out the host part</span>
   <span class="keyword">struct </span>hostent* h;

<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>   assert( strlen(host) &gt;= 1 );
   <span class="keywordflow">if</span> ( isdigit( host[0] ) )
   {
      <span class="comment">// assume it is a ip address</span>
      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> a = inet_addr(host);
      <span class="comment">//cerr &lt;&lt; &quot;a=0x&quot; &lt;&lt; hex &lt;&lt; a &lt;&lt; dec &lt;&lt; endl;</span>

      ip = ntohl( a );
   }
   <span class="keywordflow">else</span>
   {
      <span class="comment">// assume it is a host name</span>
      h = gethostbyname( host );

      <span class="keywordflow">if</span> ( h == NULL )
      {
         <span class="keywordtype">int</span> err = <a class="code" href="stun__udp_8h.html#a604d53fe9d66ce3a47ab2354b20f8e62">getErrno</a>();
         std::cerr &lt;&lt; <span class="stringliteral">&quot;error was &quot;</span> &lt;&lt; err &lt;&lt; std::endl;
         assert( err != <a class="code" href="stun__udp_8h.html#a25b517a4390903e6fa0f945e80a3394c">WSANOTINITIALISED</a> );

         ip = ntohl( 0x7F000001L );

         <span class="keywordflow">return</span> <span class="keyword">false</span>;
      }
      <span class="keywordflow">else</span>
      {
         sin_addr = *(<span class="keyword">struct </span>in_addr*)h-&gt;h_addr;
         ip = ntohl( sin_addr.s_addr );
      }
   }

<span class="preprocessor">#else</span>
<span class="preprocessor"></span>   h = gethostbyname( host );
   <span class="keywordflow">if</span> ( h == NULL )
   {
      <span class="keywordtype">int</span> err = <a class="code" href="stun__udp_8h.html#a604d53fe9d66ce3a47ab2354b20f8e62">getErrno</a>();
      std::cerr &lt;&lt; <span class="stringliteral">&quot;error was &quot;</span> &lt;&lt; err &lt;&lt; std::endl;
      ip = ntohl( 0x7F000001L );
      <span class="keywordflow">return</span> <span class="keyword">false</span>;
   }
   <span class="keywordflow">else</span>
   {
      sin_addr = *(<span class="keyword">struct </span>in_addr*)h-&gt;h_addr;
      ip = ntohl( sin_addr.s_addr );
   }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
   portVal = portNum;

   <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a44a8d7b644cb0faa4107db47b2e06471"></a><!-- doxytag: member="stun.h::stunParseMessage" ref="a44a8d7b644cb0faa4107db47b2e06471" args="(char *buf, unsigned int bufLen, StunMessage &amp;message, bool verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stunParseMessage </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>bufLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunMessage.html">StunMessage</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00183">183</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01876">stunNatType()</a>, <a class="el" href="stun_8cc_source.html#l02247">stunOpenSocket()</a>, <a class="el" href="stun_8cc_source.html#l02314">stunOpenSocketPair()</a>, <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>, and <a class="el" href="stun_8cc_source.html#l01813">stunTest()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Received stun message: &quot;</span> &lt;&lt; bufLen &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span> &lt;&lt; endl;
   memset(&amp;msg, 0, <span class="keyword">sizeof</span>(msg));

   <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<a class="code" href="structStunMsgHdr.html">StunMsgHdr</a>) &gt; bufLen)
   {
      clog &lt;&lt; <span class="stringliteral">&quot;Bad message&quot;</span> &lt;&lt; endl;
      <span class="keywordflow">return</span> <span class="keyword">false</span>;
   }

   memcpy(&amp;msg.msgHdr, buf, <span class="keyword">sizeof</span>(<a class="code" href="structStunMsgHdr.html">StunMsgHdr</a>));
   msg.msgHdr.msgType = ntohs(msg.msgHdr.msgType);
   msg.msgHdr.msgLength = ntohs(msg.msgHdr.msgLength);

   <span class="keywordflow">if</span> (msg.msgHdr.msgLength + <span class="keyword">sizeof</span>(<a class="code" href="structStunMsgHdr.html">StunMsgHdr</a>) != bufLen)
   {
      clog &lt;&lt; <span class="stringliteral">&quot;Message header length doesn&#39;t match message size: &quot;</span>
           &lt;&lt; msg.msgHdr.msgLength &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; bufLen &lt;&lt; endl;
      <span class="keywordflow">return</span> <span class="keyword">false</span>;
   }

   <span class="keywordtype">char</span>* body = buf + <span class="keyword">sizeof</span>(<a class="code" href="structStunMsgHdr.html">StunMsgHdr</a>);
   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = msg.msgHdr.msgLength;

   <span class="comment">//clog &lt;&lt; &quot;bytes after header = &quot; &lt;&lt; size &lt;&lt; endl;</span>

   <span class="keywordflow">while</span> ( size &gt; 0 )
   {
      <span class="comment">// !jf! should check that there are enough bytes left in the buffer</span>

      <a class="code" href="structStunAtrHdr.html">StunAtrHdr</a>* attr = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structStunAtrHdr.html">StunAtrHdr</a>*<span class="keyword">&gt;</span>(body);

      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> attrLen = ntohs(attr-&gt;<a class="code" href="structStunAtrHdr.html#a979c6bd5a4c93128cc316bef605191f5">length</a>);
      <span class="keywordtype">int</span> atrType = ntohs(attr-&gt;<a class="code" href="structStunAtrHdr.html#a303835ac7916984e097587ad499b568e">type</a>);

      <span class="comment">//if (verbose) clog &lt;&lt; &quot;Found attribute type=&quot; &lt;&lt; AttrNames[atrType] &lt;&lt; &quot; length=&quot; &lt;&lt; attrLen &lt;&lt; endl;</span>
      <span class="keywordflow">if</span> ( attrLen+4 &gt; size )
      {
         clog &lt;&lt; <span class="stringliteral">&quot;claims attribute is larger than size of message &quot;</span>
              &lt;&lt;<span class="stringliteral">&quot;(attribute type=&quot;</span>&lt;&lt;atrType&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>&lt;&lt; endl;
         <span class="keywordflow">return</span> <span class="keyword">false</span>;
      }

      body += 4; <span class="comment">// skip the length and type in attribute header</span>
      size -= 4;

      <span class="keywordflow">switch</span> ( atrType )
      {
         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a2479ede510923cc5e8a0c2da5558acc3">MappedAddress</a>:
            msg.hasMappedAddress = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> ( <a class="code" href="stun_8cc.html#a16624b9ba3d6b2f1c821571fa467c544">stunParseAtrAddress</a>(  body,  attrLen,  msg.mappedAddress )== <span class="keyword">false</span> )
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing MappedAddress&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;MappedAddress = &quot;</span> &lt;&lt; msg.mappedAddress.ipv4 &lt;&lt; endl;
            }

            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a91ab7c5c3d71a86a77679d0d2786fae8">ResponseAddress</a>:
            msg.hasResponseAddress = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> ( <a class="code" href="stun_8cc.html#a16624b9ba3d6b2f1c821571fa467c544">stunParseAtrAddress</a>(  body,  attrLen,  msg.responseAddress )== <span class="keyword">false</span> )
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing ResponseAddress&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;ResponseAddress = &quot;</span> &lt;&lt; msg.responseAddress.ipv4 &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a6183c3f6e20ddc5bf9acd531d37c4b08">ChangeRequest</a>:
            msg.hasChangeRequest = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (<a class="code" href="stun_8cc.html#af2f9f10bd394cb42037f1997266b978a">stunParseAtrChangeRequest</a>( body, attrLen, msg.changeRequest) == <span class="keyword">false</span>)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing ChangeRequest&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;ChangeRequest = &quot;</span> &lt;&lt; msg.changeRequest.value &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#ab2b81c4c09625b39c5a1d57ee2b460a4">SourceAddress</a>:
            msg.hasSourceAddress = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> ( <a class="code" href="stun_8cc.html#a16624b9ba3d6b2f1c821571fa467c544">stunParseAtrAddress</a>(  body,  attrLen,  msg.sourceAddress )== <span class="keyword">false</span> )
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing SourceAddress&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;SourceAddress = &quot;</span> &lt;&lt; msg.sourceAddress.ipv4 &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a930a1eeda1f0620132bfdea315e711f7">ChangedAddress</a>:
            msg.hasChangedAddress = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> ( <a class="code" href="stun_8cc.html#a16624b9ba3d6b2f1c821571fa467c544">stunParseAtrAddress</a>(  body,  attrLen,  msg.changedAddress )== <span class="keyword">false</span> )
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing ChangedAddress&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;ChangedAddress = &quot;</span> &lt;&lt; msg.changedAddress.ipv4 &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a0845232ed07b469d1262348e1618b962">Username</a>:
            msg.hasUsername = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (<a class="code" href="stun_8cc.html#a2c161a60854ecb6fe959dff3fe422310">stunParseAtrString</a>( body, attrLen, msg.username) == <span class="keyword">false</span>)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing Username&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Username = &quot;</span> &lt;&lt; msg.username.value &lt;&lt; endl;
            }

            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a1741d36983135a1f2eefa1b1473956a2">Password</a>:
            msg.hasPassword = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (<a class="code" href="stun_8cc.html#a2c161a60854ecb6fe959dff3fe422310">stunParseAtrString</a>( body, attrLen, msg.password) == <span class="keyword">false</span>)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing Password&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Password = &quot;</span> &lt;&lt; msg.password.value &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a0371caac677f72f19ea073dd152197f0">MessageIntegrity</a>:
            msg.hasMessageIntegrity = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (<a class="code" href="stun_8cc.html#a4e7e4c29e1424831e001c9ffa9b74b53">stunParseAtrIntegrity</a>( body, attrLen, msg.messageIntegrity) == <span class="keyword">false</span>)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing MessageIntegrity&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="comment">//if (verbose) clog &lt;&lt; &quot;MessageIntegrity = &quot; &lt;&lt; msg.messageIntegrity.hash &lt;&lt; endl;</span>
            }

            <span class="comment">// read the current HMAC</span>
            <span class="comment">// look up the password given the user of given the transaction id</span>
            <span class="comment">// compute the HMAC on the buffer</span>
            <span class="comment">// decide if they match or not</span>
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a750ec1534b2aebc05c90b9e6fe9532c7">ErrorCode</a>:
            msg.hasErrorCode = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (<a class="code" href="stun_8cc.html#afdf35a5dc5c3d6b7109c290308e32887">stunParseAtrError</a>(body, attrLen, msg.errorCode) == <span class="keyword">false</span>)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing ErrorCode&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;ErrorCode = &quot;</span> &lt;&lt; int(msg.errorCode.errorClass)
                                 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; int(msg.errorCode.number)
                                 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; msg.errorCode.reason &lt;&lt; endl;
            }

            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#ac5d0f4ecd6bc741747a3ff79b6e5a96c">UnknownAttribute</a>:
            msg.hasUnknownAttributes = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (<a class="code" href="stun_8cc.html#a739d3cc61a2a1609b96d535ae74a6221">stunParseAtrUnknown</a>(body, attrLen, msg.unknownAttributes) == <span class="keyword">false</span>)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing UnknownAttribute&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a11d1c4b717d340b20582ac7dead1cd49">ReflectedFrom</a>:
            msg.hasReflectedFrom = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> ( <a class="code" href="stun_8cc.html#a16624b9ba3d6b2f1c821571fa467c544">stunParseAtrAddress</a>(  body,  attrLen,  msg.reflectedFrom ) == <span class="keyword">false</span> )
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing ReflectedFrom&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#afd742381f8d8131e21dac399b8a26c3a">XorMappedAddress</a>:
            msg.hasXorMappedAddress = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> ( <a class="code" href="stun_8cc.html#a16624b9ba3d6b2f1c821571fa467c544">stunParseAtrAddress</a>(  body,  attrLen,  msg.xorMappedAddress ) == <span class="keyword">false</span> )
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing XorMappedAddress&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;XorMappedAddress = &quot;</span> &lt;&lt; msg.mappedAddress.ipv4 &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a615f23f67cf9c716c91fa445e272da3c">XorOnly</a>:
            msg.xorOnly = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (verbose)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;xorOnly = true&quot;</span> &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a53f47b517798fa3e1b64313d04168ea2">ServerName</a>:
            msg.hasServerName = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (<a class="code" href="stun_8cc.html#a2c161a60854ecb6fe959dff3fe422310">stunParseAtrString</a>( body, attrLen, msg.serverName) == <span class="keyword">false</span>)
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing ServerName&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;ServerName = &quot;</span> &lt;&lt; msg.serverName.value &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="stun_8h.html#a4d77a59e0dc2c3c06deb3730baa78f80">SecondaryAddress</a>:
            msg.hasSecondaryAddress = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> ( <a class="code" href="stun_8cc.html#a16624b9ba3d6b2f1c821571fa467c544">stunParseAtrAddress</a>(  body,  attrLen,  msg.secondaryAddress ) == <span class="keyword">false</span> )
            {
               clog &lt;&lt; <span class="stringliteral">&quot;problem parsing secondaryAddress&quot;</span> &lt;&lt; endl;
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
            {
               <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;SecondaryAddress = &quot;</span> &lt;&lt; msg.secondaryAddress.ipv4 &lt;&lt; endl;
            }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">default</span>:
            <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;Unknown attribute: &quot;</span> &lt;&lt; atrType &lt;&lt; endl;
            <span class="keywordflow">if</span> ( atrType &lt;= 0x7FFF )
            {
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
      }

      body += attrLen;
      size -= attrLen;
   }

   <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac4cabe7b17eb753dedad02cbb755563c"></a><!-- doxytag: member="stun.h::stunParseServerName" ref="ac4cabe7b17eb753dedad02cbb755563c" args="(char *serverName, StunAddress4 &amp;stunServerAddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stunParseServerName </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>serverName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>stunServerAddr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>find the IP address of a the specified stun server - return false is fails parse </p>

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00964">964</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="SingleHostUnderlayConfigurator_8cc_source.html#l00057">SingleHostUnderlayConfigurator::initializeUnderlay()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert(name);

   <span class="comment">// TODO - put in DNS SRV stuff.</span>

   <span class="keywordtype">bool</span> ret = <a class="code" href="stun_8cc.html#af497f133b72e1dc4595d9d293d706351">stunParseHostName</a>( name, addr.addr, addr.port, 3478);
   <span class="keywordflow">if</span> ( ret != <span class="keyword">true</span> )
   {
       addr.port=0xFFFF;
   }
   <span class="keywordflow">return</span> ret;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a67e399c9420f09178de194bee0bde87a"></a><!-- doxytag: member="stun.h::stunRand" ref="a67e399c9420f09178de194bee0bde87a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stunRand </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00651">651</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01697">stunBuildReqSimple()</a>, <a class="el" href="stun_8cc_source.html#l00764">stunCreateUserName()</a>, and <a class="el" href="stun_8cc_source.html#l00708">stunRandomPort()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <span class="comment">// return 32 bits of random stuff</span>
   assert( <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) == 4 );
   <span class="keyword">static</span> <span class="keywordtype">bool</span> init=<span class="keyword">false</span>;
   <span class="keywordflow">if</span> ( !init )
   {
      init = <span class="keyword">true</span>;

      <a class="code" href="stun_8h.html#aa1d7d331b6d522d6d9840fece27108d8">UInt64</a> tick;

<span class="preprocessor">#if defined(MSVC_WIN32)</span>
<span class="preprocessor"></span>      <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lowtick=0,hightick=0;
      __asm
         {
            rdtsc
               mov lowtick, eax
               mov hightick, edx
               }
      tick = hightick;
      tick &lt;&lt;= 32;
      tick |= lowtick;
<span class="preprocessor">#elif (defined(WIN32) || defined(__GNUC__)) &amp;&amp; ( defined(__i686__) || defined(__i386__) || defined(__x86_64__) )</span>
<span class="preprocessor"></span>      <span class="keyword">asm</span>(<span class="stringliteral">&quot;rdtsc&quot;</span> : <span class="stringliteral">&quot;=A&quot;</span> (tick));
<span class="preprocessor">#elif defined (__SUNPRO_CC) || defined( __sparc__ )</span>
<span class="preprocessor"></span>      tick = gethrtime();
<span class="preprocessor">#elif defined(__MACH__)</span>
<span class="preprocessor"></span>      <span class="keywordtype">int</span> fd=open(<span class="stringliteral">&quot;/dev/random&quot;</span>,O_RDONLY);
      read(fd,&amp;tick,<span class="keyword">sizeof</span>(tick));
      <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(fd);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#     error Need some way to seed the random number generator</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordtype">int</span> seed = int(tick);
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>      srand(seed);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      srandom(seed);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>   }

<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>   assert( RAND_MAX == 0x7fff );
   <span class="keywordtype">int</span> r1 = rand();
   <span class="keywordtype">int</span> r2 = rand();

   <span class="keywordtype">int</span> ret = (r1&lt;&lt;16) + r2;

   <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>   <span class="keywordflow">return</span> random();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad4a19c401bea76c471959a32a19b777e"></a><!-- doxytag: member="stun.h::stunRandomPort" ref="ad4a19c401bea76c471959a32a19b777e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stunRandomPort </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return a random number to use as a port </p>

<p>Definition at line <a class="el" href="stun_8cc_source.html#l00708">708</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01876">stunNatType()</a>, <a class="el" href="stun_8cc_source.html#l02247">stunOpenSocket()</a>, <a class="el" href="stun_8cc_source.html#l02314">stunOpenSocketPair()</a>, and <a class="el" href="stun_8cc_source.html#l01813">stunTest()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <span class="keywordtype">int</span> min=0x4000;
   <span class="keywordtype">int</span> max=0x7FFF;

   <span class="keywordtype">int</span> ret = <a class="code" href="stun_8cc.html#a67e399c9420f09178de194bee0bde87a">stunRand</a>();
   ret = ret|min;
   ret = ret&amp;max;

   <span class="keywordflow">return</span> ret;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c0e750bd19cdfcf4b2b36f9ddefc497"></a><!-- doxytag: member="stun.h::stunServerProcess" ref="a9c0e750bd19cdfcf4b2b36f9ddefc497" args="(StunServerInfo &amp;info, bool verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stunServerProcess </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunServerInfo.html">StunServerInfo</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return true if all is OK </p>

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01351">1351</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <span class="keywordtype">char</span> msg[STUN_MAX_MESSAGE_SIZE];
   <span class="keywordtype">int</span> msgLen = <span class="keyword">sizeof</span>(msg);

   <span class="keywordtype">bool</span> ok = <span class="keyword">false</span>;
   <span class="keywordtype">bool</span> recvAltIp =<span class="keyword">false</span>;
   <span class="keywordtype">bool</span> recvAltPort = <span class="keyword">false</span>;

   fd_set fdSet;
   <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> maxFd=0;

   FD_ZERO(&amp;fdSet);
   FD_SET(info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a>,&amp;fdSet);
   <span class="keywordflow">if</span> ( info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a> &gt;= maxFd ) maxFd=info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a>+1;
   FD_SET(info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a>,&amp;fdSet);
   <span class="keywordflow">if</span> ( info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a> &gt;= maxFd ) maxFd=info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a>+1;

   <span class="keywordflow">if</span> ( info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a> != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> )
   {
      FD_SET(info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>,&amp;fdSet);
      <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>&gt;=maxFd) maxFd=info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>+1;
   }
   <span class="keywordflow">if</span> ( info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a> != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> )
   {
      FD_SET(info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>,&amp;fdSet);
      <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>&gt;=maxFd) maxFd=info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>+1;
   }

   <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#a5dcc784d754928455caab60d6a34f73e">relay</a>)
   {
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_MEDIA_RELAYS; ++i)
      {
         <a class="code" href="structStunMediaRelay.html">StunMediaRelay</a>* relay = &amp;info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>[i];
         <span class="keywordflow">if</span> (relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>)
         {
            FD_SET(relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>, &amp;fdSet);
            <span class="keywordflow">if</span> (relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a> &gt;= maxFd)
                        {
                                maxFd=relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>+1;
                        }
         }
      }
   }

   <span class="keywordflow">if</span> ( info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a> != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> )
   {
      FD_SET(info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>,&amp;fdSet);
      <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>&gt;=maxFd) maxFd=info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>+1;
   }
   <span class="keywordflow">if</span> ( info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a> != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> )
   {
      FD_SET(info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>,&amp;fdSet);
      <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>&gt;=maxFd) maxFd=info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>+1;
   }

   <span class="keyword">struct </span>timeval tv;
   tv.tv_sec = 0;
   tv.tv_usec = 1000;

   <span class="keywordtype">int</span> e = select( maxFd, &amp;fdSet, NULL,NULL, &amp;tv );
   <span class="keywordflow">if</span> (e &lt; 0)
   {
      <span class="keywordtype">int</span> err = <a class="code" href="stun__udp_8h.html#a604d53fe9d66ce3a47ab2354b20f8e62">getErrno</a>();
      clog &lt;&lt; <span class="stringliteral">&quot;Error on select: &quot;</span> &lt;&lt; strerror(err) &lt;&lt; endl;
   }
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e &gt;= 0)
   {
      <a class="code" href="structStunAddress4.html">StunAddress4</a> from;

      <span class="comment">// do the media relaying</span>
      <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#a5dcc784d754928455caab60d6a34f73e">relay</a>)
      {
         time_t now = time(0);
         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_MEDIA_RELAYS; ++i)
         {
            <a class="code" href="structStunMediaRelay.html">StunMediaRelay</a>* relay = &amp;info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>[i];
            <span class="keywordflow">if</span> (relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>)
            {
               <span class="keywordflow">if</span> (FD_ISSET(relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>, &amp;fdSet))
               {
                  <span class="keywordtype">char</span> msg[MAX_RTP_MSG_SIZE];
                  <span class="keywordtype">int</span> msgLen = <span class="keyword">sizeof</span>(msg);

                  <a class="code" href="structStunAddress4.html">StunAddress4</a> rtpFrom;
                  ok = <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>, msg, &amp;msgLen, &amp;rtpFrom.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, &amp;rtpFrom.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> ,verbose);
                  <span class="keywordflow">if</span> (ok)
                  {
                     <a class="code" href="stun__udp_8h.html#a784917c5dceb731fee666978078b8bc5" title="send a UDP message">sendMessage</a>(info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a>, msg, msgLen, relay-&gt;<a class="code" href="structStunMediaRelay.html#a3adead8f4ff0c1b71bee2aecfa88f641">destination</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, relay-&gt;<a class="code" href="structStunMediaRelay.html#a3adead8f4ff0c1b71bee2aecfa88f641">destination</a>.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>, verbose);
                     relay-&gt;<a class="code" href="structStunMediaRelay.html#a16873193e181c40809e3f3f91bfb78ff">expireTime</a> = now + MEDIA_RELAY_TIMEOUT;
                     <span class="keywordflow">if</span> ( verbose ) clog &lt;&lt; <span class="stringliteral">&quot;Relay packet on &quot;</span>
                                         &lt;&lt; relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>
                                         &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; rtpFrom
                                         &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; relay-&gt;<a class="code" href="structStunMediaRelay.html#a3adead8f4ff0c1b71bee2aecfa88f641">destination</a>
                                         &lt;&lt; endl;
                  }
               }
               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (now &gt; relay-&gt;<a class="code" href="structStunMediaRelay.html#a16873193e181c40809e3f3f91bfb78ff">expireTime</a>)
               {
                  <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>);
                  relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a> = 0;
               }
            }
         }
      }


      <span class="keywordflow">if</span> (FD_ISSET(info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a>,&amp;fdSet))
      {
         <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;received on A1:P1&quot;</span> &lt;&lt; endl;
         recvAltIp = <span class="keyword">false</span>;
         recvAltPort = <span class="keyword">false</span>;
         ok = <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a>, msg, &amp;msgLen, &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>,verbose );
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FD_ISSET(info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a>, &amp;fdSet))
      {
         <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;received on A1:P2&quot;</span> &lt;&lt; endl;
         recvAltIp = <span class="keyword">false</span>;
         recvAltPort = <span class="keyword">true</span>;
         ok = <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a>, msg, &amp;msgLen, &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>,verbose );
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>!=<a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>) &amp;&amp; FD_ISSET(info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>,&amp;fdSet))
      {
         <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;received on A2:P1&quot;</span> &lt;&lt; endl;
         recvAltIp = <span class="keyword">true</span>;
         recvAltPort = <span class="keyword">false</span>;
         ok = <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>, msg, &amp;msgLen, &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> ,verbose);
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>!=<a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a>) &amp;&amp; FD_ISSET(info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>, &amp;fdSet))
      {
         <span class="keywordflow">if</span> (verbose) clog &lt;&lt; <span class="stringliteral">&quot;received on A2:P2&quot;</span> &lt;&lt; endl;
         recvAltIp = <span class="keyword">true</span>;
         recvAltPort = <span class="keyword">true</span>;
         ok = <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>, msg, &amp;msgLen, &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>,verbose );
      }
      <span class="keywordflow">else</span>
      {
         <span class="keywordflow">return</span> <span class="keyword">true</span>;
      }

      <span class="keywordtype">int</span> relayPort = 0;
      <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#a5dcc784d754928455caab60d6a34f73e">relay</a>)
      {
         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_MEDIA_RELAYS; ++i)
         {
            <a class="code" href="structStunMediaRelay.html">StunMediaRelay</a>* relay = &amp;info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>[i];
            <span class="keywordflow">if</span> (relay-&gt;<a class="code" href="structStunMediaRelay.html#a3adead8f4ff0c1b71bee2aecfa88f641">destination</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> == from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> &amp;&amp;
                relay-&gt;<a class="code" href="structStunMediaRelay.html#a3adead8f4ff0c1b71bee2aecfa88f641">destination</a>.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> == from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>)
            {
               relayPort = relay-&gt;<a class="code" href="structStunMediaRelay.html#a18c86cb9d0058de5ab6b5adf449a275b">relayPort</a>;
               relay-&gt;<a class="code" href="structStunMediaRelay.html#a16873193e181c40809e3f3f91bfb78ff">expireTime</a> = time(0) + MEDIA_RELAY_TIMEOUT;
               <span class="keywordflow">break</span>;
            }
         }

         <span class="keywordflow">if</span> (relayPort == 0)
         {
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_MEDIA_RELAYS; ++i)
            {
               <a class="code" href="structStunMediaRelay.html">StunMediaRelay</a>* relay = &amp;info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>[i];
               <span class="keywordflow">if</span> (relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a> == 0)
               {
                  <span class="keywordflow">if</span> ( verbose ) clog &lt;&lt; <span class="stringliteral">&quot;Open relay port &quot;</span> &lt;&lt; relay-&gt;<a class="code" href="structStunMediaRelay.html#a18c86cb9d0058de5ab6b5adf449a275b">relayPort</a> &lt;&lt; endl;

                  relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a> = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(relay-&gt;<a class="code" href="structStunMediaRelay.html#a18c86cb9d0058de5ab6b5adf449a275b">relayPort</a>, info.<a class="code" href="structStunServerInfo.html#a9abf6e6b89123dd6d7a71bba5a0b77d6">myAddr</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, verbose);
                  relay-&gt;<a class="code" href="structStunMediaRelay.html#a3adead8f4ff0c1b71bee2aecfa88f641">destination</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
                  relay-&gt;<a class="code" href="structStunMediaRelay.html#a3adead8f4ff0c1b71bee2aecfa88f641">destination</a>.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>;
                  relay-&gt;<a class="code" href="structStunMediaRelay.html#a16873193e181c40809e3f3f91bfb78ff">expireTime</a> = time(0) + MEDIA_RELAY_TIMEOUT;
                  relayPort = relay-&gt;<a class="code" href="structStunMediaRelay.html#a18c86cb9d0058de5ab6b5adf449a275b">relayPort</a>;
                  <span class="keywordflow">break</span>;
               }
            }
         }
      }

      <span class="keywordflow">if</span> ( !ok )
      {
         <span class="keywordflow">if</span> ( verbose ) clog &lt;&lt; <span class="stringliteral">&quot;Get message did not return a valid message&quot;</span> &lt;&lt;endl;
         <span class="keywordflow">return</span> <span class="keyword">true</span>;
      }

      <span class="keywordflow">if</span> ( verbose ) clog &lt;&lt; <span class="stringliteral">&quot;Got a request (len=&quot;</span> &lt;&lt; msgLen &lt;&lt; <span class="stringliteral">&quot;) from &quot;</span> &lt;&lt; from &lt;&lt; endl;

      <span class="keywordflow">if</span> ( msgLen &lt;= 0 )
      {
         <span class="keywordflow">return</span> <span class="keyword">true</span>;
      }

      <span class="keywordtype">bool</span> changePort = <span class="keyword">false</span>;
      <span class="keywordtype">bool</span> changeIp = <span class="keyword">false</span>;

      <a class="code" href="structStunMessage.html">StunMessage</a> resp;
      <a class="code" href="structStunAddress4.html">StunAddress4</a> dest;
      <a class="code" href="structStunAtrString.html">StunAtrString</a> hmacPassword;
      hmacPassword.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;

      <a class="code" href="structStunAddress4.html">StunAddress4</a> secondary;
      secondary.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = 0;
      secondary.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = 0;

      <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#a5dcc784d754928455caab60d6a34f73e">relay</a> &amp;&amp; relayPort)
      {
         secondary = from;

         from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> = info.<a class="code" href="structStunServerInfo.html#a9abf6e6b89123dd6d7a71bba5a0b77d6">myAddr</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
         from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = relayPort;
      }

      ok = <a class="code" href="stun_8cc.html#a811b0bd40524a040d7ec6676e9635c22">stunServerProcessMsg</a>( msg, msgLen, from, secondary,
                                 recvAltIp ? info.<a class="code" href="structStunServerInfo.html#ac6295f141e0926994747bbc198a19d55">altAddr</a> : info.<a class="code" href="structStunServerInfo.html#a9abf6e6b89123dd6d7a71bba5a0b77d6">myAddr</a>,
                                 recvAltIp ? info.<a class="code" href="structStunServerInfo.html#a9abf6e6b89123dd6d7a71bba5a0b77d6">myAddr</a> : info.<a class="code" href="structStunServerInfo.html#ac6295f141e0926994747bbc198a19d55">altAddr</a>,
                                 &amp;resp,
                                 &amp;dest,
                                 &amp;hmacPassword,
                                 &amp;changePort,
                                 &amp;changeIp,
                                 verbose );

      <span class="keywordflow">if</span> ( !ok )
      {
         <span class="keywordflow">if</span> ( verbose ) clog &lt;&lt; <span class="stringliteral">&quot;Failed to parse message&quot;</span> &lt;&lt; endl;
         <span class="keywordflow">return</span> <span class="keyword">true</span>;
      }

      <span class="keywordtype">char</span> buf[STUN_MAX_MESSAGE_SIZE];
      <span class="keywordtype">int</span> len = <span class="keyword">sizeof</span>(buf);

      len = <a class="code" href="stun_8cc.html#a4f9e869279d41bbf1785d321b4360f61">stunEncodeMessage</a>( resp, buf, len, hmacPassword,verbose );

      <span class="keywordflow">if</span> ( dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> == 0 )  ok=<span class="keyword">false</span>;
      <span class="keywordflow">if</span> ( dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> == 0 ) ok=<span class="keyword">false</span>;

      <span class="keywordflow">if</span> ( ok )
      {
         assert( dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 );
         assert( dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 );

         <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> sendFd;

         <span class="keywordtype">bool</span> sendAltIp   = recvAltIp;   <span class="comment">// send on the received IP address</span>
         <span class="keywordtype">bool</span> sendAltPort = recvAltPort; <span class="comment">// send on the received port</span>

         <span class="keywordflow">if</span> ( changeIp )   sendAltIp   = !sendAltIp;   <span class="comment">// if need to change IP, then flip logic</span>
         <span class="keywordflow">if</span> ( changePort ) sendAltPort = !sendAltPort; <span class="comment">// if need to change port, then flip logic</span>

         <span class="keywordflow">if</span> ( !sendAltPort )
         {
            <span class="keywordflow">if</span> ( !sendAltIp )
            {
               sendFd = info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a>;
            }
            <span class="keywordflow">else</span>
            {
               sendFd = info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>;
            }
         }
         <span class="keywordflow">else</span>
         {
            <span class="keywordflow">if</span> ( !sendAltIp )
            {
               sendFd = info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a>;
            }
            <span class="keywordflow">else</span>
            {
               sendFd = info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>;
            }
         }

         <span class="keywordflow">if</span> ( sendFd != <a class="code" href="stun__udp_8h.html#ab095a168e3ee3fb25930ad2f03d4242b">STUN_INVALID_SOCKET</a> )
         {
            <a class="code" href="stun__udp_8h.html#a784917c5dceb731fee666978078b8bc5" title="send a UDP message">sendMessage</a>( sendFd, buf, len, dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>, dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>, verbose );
         }
      }
   }

   <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="abca9120a82ff1cdb7e3a12b5c68b57f8"></a><!-- doxytag: member="stun.h::stunServerProcessMsg" ref="abca9120a82ff1cdb7e3a12b5c68b57f8" args="(char *buf, unsigned int bufLen, StunAddress4 &amp;from, StunAddress4 &amp;myAddr, StunAddress4 &amp;altAddr, StunMessage *resp, StunAddress4 *destination, StunAtrString *hmacPassword, bool *changePort, bool *changeIp, bool verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stunServerProcessMsg </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>bufLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>myAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>altAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunMessage.html">StunMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>resp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> *&nbsp;</td>
          <td class="paramname"> <em>destination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAtrString.html">StunAtrString</a> *&nbsp;</td>
          <td class="paramname"> <em>hmacPassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&nbsp;</td>
          <td class="paramname"> <em>changePort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&nbsp;</td>
          <td class="paramname"> <em>changeIp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9ed82a9b4b17f3f4d9bf1fd4d5b8bfd2"></a><!-- doxytag: member="stun.h::stunStopServer" ref="a9ed82a9b4b17f3f4d9bf1fd4d5b8bfd2" args="(StunServerInfo &amp;info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stunStopServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunServerInfo.html">StunServerInfo</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>info</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01328">1328</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01249">stunInitServer()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a> &gt; 0) <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(info.<a class="code" href="structStunServerInfo.html#afa85d638d48bf0598161a7e9158aba3f">myFd</a>);
   <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a> &gt; 0) <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(info.<a class="code" href="structStunServerInfo.html#a2da8a94e9a9867e7c5d3b3e3c317120c">altPortFd</a>);
   <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a> &gt; 0) <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(info.<a class="code" href="structStunServerInfo.html#ac9e3ea9e1322857b20f4d21211d8ca99">altIpFd</a>);
   <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a> &gt; 0) <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(info.<a class="code" href="structStunServerInfo.html#af14364029dec110da68c7ca855d91b2d">altIpPortFd</a>);

   <span class="keywordflow">if</span> (info.<a class="code" href="structStunServerInfo.html#a5dcc784d754928455caab60d6a34f73e">relay</a>)
   {
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_MEDIA_RELAYS; ++i)
      {
         <a class="code" href="structStunMediaRelay.html">StunMediaRelay</a>* relay = &amp;info.<a class="code" href="structStunServerInfo.html#aed8568086c549986f985f02a691da173">relays</a>[i];
         <span class="keywordflow">if</span> (relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>)
         {
            <a class="code" href="stun__udp_8h.html#a79746e37503e1405951088e144510b79">stunclosesocket</a>(relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a>);
            relay-&gt;<a class="code" href="structStunMediaRelay.html#aebc07662e0b3728286c6da02d29806e8">fd</a> = 0;
         }
      }
   }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb5b16792462be8778618f42d2a0d1b0"></a><!-- doxytag: member="stun.h::stunTest" ref="adb5b16792462be8778618f42d2a0d1b0" args="(StunAddress4 &amp;dest, int testNum, bool verbose, StunAddress4 *srcAddr=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stunTest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>testNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structStunAddress4.html">StunAddress4</a> *&nbsp;</td>
          <td class="paramname"> <em>srcAddr</em> = <code>0</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8cc_source.html#l01813">1813</a> of file <a class="el" href="stun_8cc_source.html">stun.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
   assert( dest.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a> != 0 );
   assert( dest.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> != 0 );

   <span class="keywordtype">int</span> port = <a class="code" href="stun_8cc.html#ad4a19c401bea76c471959a32a19b777e" title="return a random number to use as a port">stunRandomPort</a>();
   <a class="code" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> interfaceIp=0;
   <span class="keywordflow">if</span> (sAddr)
   {
      interfaceIp = sAddr-&gt;addr;
      <span class="keywordflow">if</span> ( sAddr-&gt;port != 0 )
      {
        port = sAddr-&gt;port;
      }
   }
   <a class="code" href="stun_8h.html#af9381320a2640ea84038579d8f143c01">Socket</a> myFd = <a class="code" href="stun__udp_8h.html#a44f511e14438aa519a0f367a84de4000" title="Open a UDP socket to receive on the given port - if port is 0, pick a a port, if interfaceIp!=0 then ...">openPort</a>(port,interfaceIp,verbose);

   <a class="code" href="structStunAtrString.html">StunAtrString</a> username;
   <a class="code" href="structStunAtrString.html">StunAtrString</a> password;

   username.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;
   password.<a class="code" href="structStunAtrString.html#aa1e288247a4ae07b170ecf956bdd48c9">sizeValue</a> = 0;

<span class="preprocessor">#ifdef USE_TLS</span>
<span class="preprocessor"></span>   <a class="code" href="stun_8cc.html#ae9317a5a127d1281953d961bcfbd2496">stunGetUserNameAndPassword</a>( dest, username, password );
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
   <a class="code" href="stun_8cc.html#ab17bbe96f9bef6d767fbee081ca123d7">stunSendTest</a>( myFd, dest, username, password, testNum, verbose );

   <span class="keywordtype">char</span> msg[STUN_MAX_MESSAGE_SIZE];
   <span class="keywordtype">int</span> msgLen = STUN_MAX_MESSAGE_SIZE;

   <a class="code" href="structStunAddress4.html">StunAddress4</a> from;
   <a class="code" href="stun__udp_8h.html#a6eef3fdbadd5e5a9de73b7be46ce5aa2" title="recive a UDP message">getMessage</a>( myFd,
               msg,
               &amp;msgLen,
               &amp;from.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>,
               &amp;from.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>,verbose );

   <a class="code" href="structStunMessage.html">StunMessage</a> resp;
   memset(&amp;resp, 0, <span class="keyword">sizeof</span>(<a class="code" href="structStunMessage.html">StunMessage</a>));

   <span class="keywordflow">if</span> ( verbose ) clog &lt;&lt; <span class="stringliteral">&quot;Got a response&quot;</span> &lt;&lt; endl;
   <span class="keywordtype">bool</span> ok = <a class="code" href="stun_8cc.html#af81c30137f26a4cb158b48aa21f4f681">stunParseMessage</a>( msg,msgLen, resp,verbose );

   <span class="keywordflow">if</span> ( verbose )
   {
      clog &lt;&lt; <span class="stringliteral">&quot;\t ok=&quot;</span> &lt;&lt; ok &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;\t id=&quot;</span> &lt;&lt; resp.<a class="code" href="structStunMessage.html#a4928bac8dd595927e7ebab4610f316f6">msgHdr</a>.<a class="code" href="structStunMsgHdr.html#a97a1d0da450500ddc5a6fad924e50c87">id</a> &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;\t mappedAddr=&quot;</span> &lt;&lt; resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a> &lt;&lt; endl;
      clog &lt;&lt; <span class="stringliteral">&quot;\t changedAddr=&quot;</span> &lt;&lt; resp.<a class="code" href="structStunMessage.html#ac240bd9424c010b74411679f1813a705">changedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a> &lt;&lt; endl;
      clog &lt;&lt; endl;
   }

   <span class="keywordflow">if</span> (sAddr)
   {
      sAddr-&gt;<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a> = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a182b25091f39b6f1d9904a02bcbeb43b">port</a>;
      sAddr-&gt;addr = resp.<a class="code" href="structStunMessage.html#a7c354e1ca2aae9d180c98e6b12ba879c">mappedAddress</a>.<a class="code" href="structStunAtrAddress4.html#a80b81fdc81e96531c1fecd5b9b5125c4">ipv4</a>.<a class="code" href="structStunAddress4.html#a870846bf1b2de80c031948f0795e24c6">addr</a>;
   }
}
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ae440f0f666689240a0aa0f450d1783ab"></a><!-- doxytag: member="stun.h::BindErrorResponseMsg" ref="ae440f0f666689240a0aa0f450d1783ab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#ae440f0f666689240a0aa0f450d1783ab">BindErrorResponseMsg</a> = 0x0111</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00055">55</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00980">stunCreateErrorResponse()</a>.</p>

</div>
</div>
<a class="anchor" id="a4dfa49ebae731be7b582f0fc7b57d429"></a><!-- doxytag: member="stun.h::BindRequestMsg" ref="a4dfa49ebae731be7b582f0fc7b57d429" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a4dfa49ebae731be7b582f0fc7b57d429">BindRequestMsg</a> = 0x0001</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00053">53</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01697">stunBuildReqSimple()</a>, and <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>.</p>

</div>
</div>
<a class="anchor" id="af0396ed8e86ae295115e3c2d42a7f1ad"></a><!-- doxytag: member="stun.h::BindResponseMsg" ref="af0396ed8e86ae295115e3c2d42a7f1ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#af0396ed8e86ae295115e3c2d42a7f1ad">BindResponseMsg</a> = 0x0101</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00054">54</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>.</p>

</div>
</div>
<a class="anchor" id="a930a1eeda1f0620132bfdea315e711f7"></a><!-- doxytag: member="stun.h::ChangedAddress" ref="a930a1eeda1f0620132bfdea315e711f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a930a1eeda1f0620132bfdea315e711f7">ChangedAddress</a> = 0x0005</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00040">40</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="ad0235d173b2af6e92be9843aaa585eef"></a><!-- doxytag: member="stun.h::ChangeIpFlag" ref="ad0235d173b2af6e92be9843aaa585eef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> <a class="el" href="stun_8h.html#ad0235d173b2af6e92be9843aaa585eef">ChangeIpFlag</a> = 0x04</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00032">32</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01697">stunBuildReqSimple()</a>, and <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>.</p>

</div>
</div>
<a class="anchor" id="a2f247c137dd06ef8971319b9a6078ef4"></a><!-- doxytag: member="stun.h::ChangePortFlag" ref="a2f247c137dd06ef8971319b9a6078ef4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#a4cd0dc7d33ac7a69204e8429ecea0f86">UInt32</a> <a class="el" href="stun_8h.html#a2f247c137dd06ef8971319b9a6078ef4">ChangePortFlag</a> = 0x02</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00033">33</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01697">stunBuildReqSimple()</a>, and <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>.</p>

</div>
</div>
<a class="anchor" id="a6183c3f6e20ddc5bf9acd531d37c4b08"></a><!-- doxytag: member="stun.h::ChangeRequest" ref="a6183c3f6e20ddc5bf9acd531d37c4b08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a6183c3f6e20ddc5bf9acd531d37c4b08">ChangeRequest</a> = 0x0003</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00038">38</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00479">encodeAtrChangeRequest()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a750ec1534b2aebc05c90b9e6fe9532c7"></a><!-- doxytag: member="stun.h::ErrorCode" ref="a750ec1534b2aebc05c90b9e6fe9532c7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a750ec1534b2aebc05c90b9e6fe9532c7">ErrorCode</a> = 0x0009</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00044">44</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00488">encodeAtrError()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="ac2c7bc41e1b918c98583006fd7025bc5"></a><!-- doxytag: member="stun.h::IPv4Family" ref="ac2c7bc41e1b918c98583006fd7025bc5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#a9b66271558bfa5abc5095791246b540d">UInt8</a> <a class="el" href="stun_8h.html#ac2c7bc41e1b918c98583006fd7025bc5">IPv4Family</a> = 0x01</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>define a structure to hold a stun address </p>

<p>Definition at line <a class="el" href="stun_8h_source.html#l00028">28</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00466">encodeAtrAddress4()</a>, and <a class="el" href="stun_8cc_source.html#l00049">stunParseAtrAddress()</a>.</p>

</div>
</div>
<a class="anchor" id="a5da56f5efebd69e84bf5fdb74a02bf8a"></a><!-- doxytag: member="stun.h::IPv6Family" ref="a5da56f5efebd69e84bf5fdb74a02bf8a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#a9b66271558bfa5abc5095791246b540d">UInt8</a> <a class="el" href="stun_8h.html#a5da56f5efebd69e84bf5fdb74a02bf8a">IPv6Family</a> = 0x02</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00029">29</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00049">stunParseAtrAddress()</a>.</p>

</div>
</div>
<a class="anchor" id="a2479ede510923cc5e8a0c2da5558acc3"></a><!-- doxytag: member="stun.h::MappedAddress" ref="a2479ede510923cc5e8a0c2da5558acc3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a2479ede510923cc5e8a0c2da5558acc3">MappedAddress</a> = 0x0001</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00036">36</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a0371caac677f72f19ea073dd152197f0"></a><!-- doxytag: member="stun.h::MessageIntegrity" ref="a0371caac677f72f19ea073dd152197f0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a0371caac677f72f19ea073dd152197f0">MessageIntegrity</a> = 0x0008</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00043">43</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00534">encodeAtrIntegrity()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a1741d36983135a1f2eefa1b1473956a2"></a><!-- doxytag: member="stun.h::Password" ref="a1741d36983135a1f2eefa1b1473956a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a1741d36983135a1f2eefa1b1473956a2">Password</a> = 0x0007</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00042">42</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a11d1c4b717d340b20582ac7dead1cd49"></a><!-- doxytag: member="stun.h::ReflectedFrom" ref="a11d1c4b717d340b20582ac7dead1cd49" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a11d1c4b717d340b20582ac7dead1cd49">ReflectedFrom</a> = 0x000B</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00046">46</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a91ab7c5c3d71a86a77679d0d2786fae8"></a><!-- doxytag: member="stun.h::ResponseAddress" ref="a91ab7c5c3d71a86a77679d0d2786fae8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a91ab7c5c3d71a86a77679d0d2786fae8">ResponseAddress</a> = 0x0002</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00037">37</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a4d77a59e0dc2c3c06deb3730baa78f80"></a><!-- doxytag: member="stun.h::SecondaryAddress" ref="a4d77a59e0dc2c3c06deb3730baa78f80" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a4d77a59e0dc2c3c06deb3730baa78f80">SecondaryAddress</a> = 0x8050</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00050">50</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a53f47b517798fa3e1b64313d04168ea2"></a><!-- doxytag: member="stun.h::ServerName" ref="a53f47b517798fa3e1b64313d04168ea2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a53f47b517798fa3e1b64313d04168ea2">ServerName</a> = 0x8022</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00049">49</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="aaaa9b37f28fbe5021e650eaccd372d4d"></a><!-- doxytag: member="stun.h::SharedSecretErrorResponseMsg" ref="aaaa9b37f28fbe5021e650eaccd372d4d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#aaaa9b37f28fbe5021e650eaccd372d4d">SharedSecretErrorResponseMsg</a> = 0x0112</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00058">58</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

</div>
</div>
<a class="anchor" id="a03609184bf06df206ab09c4102428a33"></a><!-- doxytag: member="stun.h::SharedSecretRequestMsg" ref="a03609184bf06df206ab09c4102428a33" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a03609184bf06df206ab09c4102428a33">SharedSecretRequestMsg</a> = 0x0002</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00056">56</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01019">stunServerProcessMsg()</a>.</p>

</div>
</div>
<a class="anchor" id="af179b3b160dd9d71db8bcff29500504c"></a><!-- doxytag: member="stun.h::SharedSecretResponseMsg" ref="af179b3b160dd9d71db8bcff29500504c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#af179b3b160dd9d71db8bcff29500504c">SharedSecretResponseMsg</a> = 0x0102</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00057">57</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l01002">stunCreateSharedSecretResponse()</a>.</p>

</div>
</div>
<a class="anchor" id="ab2b81c4c09625b39c5a1d57ee2b460a4"></a><!-- doxytag: member="stun.h::SourceAddress" ref="ab2b81c4c09625b39c5a1d57ee2b460a4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#ab2b81c4c09625b39c5a1d57ee2b460a4">SourceAddress</a> = 0x0004</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00039">39</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="ac5d0f4ecd6bc741747a3ff79b6e5a96c"></a><!-- doxytag: member="stun.h::UnknownAttribute" ref="ac5d0f4ecd6bc741747a3ff79b6e5a96c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#ac5d0f4ecd6bc741747a3ff79b6e5a96c">UnknownAttribute</a> = 0x000A</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00045">45</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00501">encodeAtrUnknown()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a0845232ed07b469d1262348e1618b962"></a><!-- doxytag: member="stun.h::Username" ref="a0845232ed07b469d1262348e1618b962" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a0845232ed07b469d1262348e1618b962">Username</a> = 0x0006</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00041">41</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="afd742381f8d8131e21dac399b8a26c3a"></a><!-- doxytag: member="stun.h::XorMappedAddress" ref="afd742381f8d8131e21dac399b8a26c3a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#afd742381f8d8131e21dac399b8a26c3a">XorMappedAddress</a> = 0x8020</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00047">47</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00544">stunEncodeMessage()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="a615f23f67cf9c716c91fa445e272da3c"></a><!-- doxytag: member="stun.h::XorOnly" ref="a615f23f67cf9c716c91fa445e272da3c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="stun_8h.html#accc14a7c843716dfed734f3a03e8d2b6">UInt16</a> <a class="el" href="stun_8h.html#a615f23f67cf9c716c91fa445e272da3c">XorOnly</a> = 0x0021</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stun_8h_source.html#l00048">48</a> of file <a class="el" href="stun_8h_source.html">stun.h</a>.</p>

<p>Referenced by <a class="el" href="stun_8cc_source.html#l00514">encodeXorOnly()</a>, and <a class="el" href="stun_8cc_source.html#l00183">stunParseMessage()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 3 2010 14:40:46 for OverSim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
