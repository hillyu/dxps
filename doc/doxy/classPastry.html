<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: Pastry Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<h1>Pastry Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Pastry" --><!-- doxytag: inherits="BasePastry" -->
<p><a class="el" href="classPastry.html" title="Pastry overlay module.">Pastry</a> overlay module.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Pastry_8h_source.html">Pastry.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Pastry:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classPastry.png" usemap="#Pastry_map" alt=""/>
  <map id="Pastry_map" name="Pastry_map">
<area href="classBasePastry.html" alt="BasePastry" shape="rect" coords="172,168,277,192"/>
<area href="classBaseOverlay.html" alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classProxListener.html" alt="ProxListener" shape="rect" coords="230,112,335,136"/>
<area href="classBaseRpc.html" alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
</div>

<p><a href="classPastry-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ad850c987f39b8fe66f9d2da8e351ef7a">~Pastry</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#afe58f82e796e3f1ad6cc736fed856e3c">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aabc1a8eaab8eea9ec5e4830ee60499f8">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a47fc606cfbb1977305f97c60c3c21481">handleUDPMessage</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9">handleStateMessage</a> (<a class="el" href="classPastryStateMessage.html">PastryStateMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">processes state messages, merging with own state tables  <a href="#a1dece33e7864cc0f823374daa28da6c9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a5d3a97713d0a9653e64d252297d41c15">pingResponse</a> (<a class="el" href="classPingResponse.html">PingResponse</a> *pingResponse, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a8899e17ebdaf922877b308b6e6408feb">purgeVectors</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete all information/messages caching vectors, used for restarting overlay or <a class="el" href="classBaseOverlay.html#aed7e3f36b2c70cbdb0e6daa32925917c" title="collects statistical data">finish()</a>  <a href="#a8899e17ebdaf922877b308b6e6408feb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a2b363b914b911dcbc411da940efec08f">changeState</a> (int toState)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">changes node state  <a href="#a2b363b914b911dcbc411da940efec08f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ab467d712a7a56dece193bce66bd635d6">recursiveRoutingHook</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, <a class="el" href="classBaseRouteMessage.html">BaseRouteMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ac202a93b3945381918d13b92060ff1da">iterativeJoinHook</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg, bool incrHopCount)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a124da5018df353375c1b1b3af057c646">stReceived</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State messages to process during join.  <a href="#a124da5018df353375c1b1b3af057c646"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector<br class="typebreak"/>
&lt; <a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a> &gt;<br class="typebreak"/>
::iterator&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3">notifyList</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">List of nodes to notify after join.  <a href="#abaf6ee84a60273e509e713fabe4b25e3"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ace3cd9ad6803c901a4de28d17f960d86">clearVectors</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a13e50eccbed545c79aed4d1f2d9ac9ae">doSecondStage</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">do the second stage of initialization as described in the paper  <a href="#a13e50eccbed545c79aed4d1f2d9ac9ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a08e9157d1221cded34f870c3abc934f7">doRoutingTableMaintenance</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">periodic routing table maintenance requests the corresponding routing table row from one node in each row  <a href="#a08e9157d1221cded34f870c3abc934f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ad94a0f122fe78b1b0002735ce19fea84">handleFailedNode</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;failed)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">notifies leafset and routingtable of a failed node and sends out a repair request if possible  <a href="#ad94a0f122fe78b1b0002735ce19fea84"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a851bb0830162f5db79ef515f32c78465">checkProxCache</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">checks whether proxCache is complete, takes appropriate actions depending on the protocol state  <a href="#a851bb0830162f5db79ef515f32c78465"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a4a681c9a40631e27cdb8a174ce8e2618">endProcessingState</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aa8358704c2a16e2723f048c4bcbe2922">doJoinUpdate</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send updated state to all nodes when entering ready state  <a href="#aa8358704c2a16e2723f048c4bcbe2922"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962">joinOverlay</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">partialJoinPath</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">updateCounter</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">useSecondStage</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">overrideOldPastry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">overrideNewPastry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aca67080bf2f219f3c1cd2eca39188aba">ringCheck</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="classPastry.html" title="Pastry overlay module.">Pastry</a> overlay module. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Felix Palmen </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="classBaseOverlay.html" title="Base class for overlays.">BaseOverlay</a> </dd></dl>

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00054">54</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ad850c987f39b8fe66f9d2da8e351ef7a"></a><!-- doxytag: member="Pastry::~Pastry" ref="ad850c987f39b8fe66f9d2da8e351ef7a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Pastry::~Pastry </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00041">41</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// destroy self timer messages</span>
    cancelAndDelete(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
    cancelAndDelete(<a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>);
    cancelAndDelete(<a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>);
    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a>) cancelAndDelete(<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> &gt; 0) cancelAndDelete(<a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);

    <a class="code" href="classPastry.html#ace3cd9ad6803c901a4de28d17f960d86">clearVectors</a>();
}
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a2b363b914b911dcbc411da940efec08f"></a><!-- doxytag: member="Pastry::changeState" ref="a2b363b914b911dcbc411da940efec08f" args="(int toState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::changeState </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>toState</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>changes node state </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>toState</em>&nbsp;</td><td>state to change to </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBasePastry.html#a8f9160fe1cf9e4050a417cfa7fc0711b">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00149">149</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l01071">handleStateMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, and <a class="el" href="Pastry_8cc_source.html#l00134">joinOverlay()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
    <a class="code" href="classBasePastry.html#a1f99c5e7da561015851b206abb4d0f59" title="changes node state, but leaves specific behavour, scheduling tasks in particular, to the inheriting p...">baseChangeState</a>(toState);

    <span class="keywordflow">switch</span> (toState) {
    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>:
        <a class="code" href="classBaseRpc.html#a77fe0a21bb12ab2fb8e27eb719b2d2fe" title="Cancels all RPCs.">cancelAllRpcs</a>();
        <a class="code" href="classPastry.html#a8899e17ebdaf922877b308b6e6408feb" title="delete all information/messages caching vectors, used for restarting overlay or finish()">purgeVectors</a>();
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="BasePastry_8h.html#a368457fbb93f1eed641b33da5a87856a">DISCOVERY</a>:
        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = DISCOVERY;
        <span class="comment">//nearNode = bootstrapNode;</span>
        <a class="code" href="classBasePastry.html#a715b166d2b3b397e047908f52f354be7">nearNodeRtt</a> = MAXTIME;
        <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>, <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, 0,
                 NULL, <span class="stringliteral">&quot;PING bootstrapNode in discovery mode&quot;</span>,
                 NULL, <a class="code" href="classBasePastry.html#acd2b654814d77379002800161cd67981a6232e475e9da2c6b20ef4cacd1246601">PING_DISCOVERY</a>, <a class="code" href="CommonMessages__m_8h.html#aca1e72535e7f260e54ed8bbf984dade9a01580b2e886cd821bd7f3f2bcd7c690c">UDP_TRANSPORT</a>); <span class="comment">//TODO</span>
        <a class="code" href="classBasePastry.html#ade0791a64218af84150f1da407732397" title="send a request to a given node">sendRequest</a>(<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>, <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00aa1e0b92435e08d44a42f799bc904cd4d">PASTRY_REQ_LEAFSET</a>); <span class="comment">//TODO should be an RPC</span>
        <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> = -1;

        <span class="comment">// schedule join timer for discovery algorithm</span>
        cancelEvent(<a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>);
        scheduleAt(simTime() + <a class="code" href="classBasePastry.html#a596fc6a02d7b78a6bf804d08cbf73844">joinTimeoutAmount</a>, <a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>);

        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>: {
        <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> = 0;
        <a class="code" href="classPastryJoinMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classPastryJoinMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinMessage</a>(<span class="stringliteral">&quot;JOIN-Request&quot;</span>);
        <span class="comment">//TODO add timestamp to join msg</span>
        msg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00afe224824cc07fb076471ed2e3328d729">PASTRY_MSG_JOIN</a>);
        msg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
        msg-&gt;<a class="code" href="classPastryJoinMessage.html#a062821da386f97a3b7fe85a8b8f1034e">setSendStateTo</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        msg-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a6829fd380e327ddfbbde0413ffc5cc0f">PASTRYJOIN_L</a>(msg));
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#ae75ddd4630ea3004166c0283436af0e9">joinSent</a>++; <a class="code" href="classBasePastry.html#a8bf579a017df30ccb1cf458a78a78f79">joinBytesSent</a> += msg-&gt;getByteLength());
        std::vector&lt;TransportAddress&gt; sourceRoute;
        sourceRoute.push_back(<a class="code" href="classBasePastry.html#aaa36dc41f21d16f4e7a03e92911c17ab">nearNode</a>);
        <a class="code" href="classBaseOverlay.html#a6f2c598f5d3989a63a8cc7220f1aaf76" title="Sends a message to an overlay node, with the generic routing algorithm.">sendToKey</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), msg, 0<span class="comment">/*1*/</span>, sourceRoute);
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>:
        <span class="comment">// determine list of all known nodes as notifyList</span>
        <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
        <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a529939c1a02749c1b18300404172c6ad" title="appends all leaf set entries to a given vector of TransportAddresses, needed to find all Nodes to be ...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
        <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#aed1ca355690a9e0354a420bf7c96e3a4" title="appends all routing table entries to a given vector of TransportAddresses, needed to find all Nodes t...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
        sort(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());
        <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.erase(unique(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end()),
                         <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());

        <span class="comment">// schedule update</span>
        cancelEvent(<a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>);
        scheduleAt(simTime() + 0.0001, <a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>);

        <span class="comment">// schedule second stage</span>
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a> &gt; 0) {
            cancelEvent(<a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>);
            scheduleAt(simTime() + <a class="code" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a>, <a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>);
        }

        <span class="comment">// schedule routing table maintenance task</span>
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> &gt; 0) {
            cancelEvent(<a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);
            scheduleAt(simTime() + <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a>, <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);
        }

        <span class="keywordflow">break</span>;
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a851bb0830162f5db79ef515f32c78465"></a><!-- doxytag: member="Pastry::checkProxCache" ref="a851bb0830162f5db79ef515f32c78465" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::checkProxCache </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>checks whether proxCache is complete, takes appropriate actions depending on the protocol state </p>

<p>Implements <a class="el" href="classBasePastry.html#a1062cac20a1fd1c5368157fe2da8b8fb">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00765">765</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <span class="comment">// no cached STATE message?</span>
    assert(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> || !<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>);
    <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) <span class="keywordflow">return</span>;

    <span class="comment">// no entries in stateCache.prox?</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.empty() &amp;&amp;
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.empty() &amp;&amp;
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.empty())
        <span class="keywordflow">throw</span> <span class="keyword">new</span> cRuntimeError(<span class="stringliteral">&quot;ERROR in Pastry: stateCache.prox empty!&quot;</span>);

    <span class="comment">/*</span>
<span class="comment">    //debug</span>
<span class="comment">    for (uint i = 0; i &lt; stateCache.prox-&gt;pr_rt.size(); ++i) {</span>
<span class="comment">        if (stateCache.prox-&gt;pr_rt[i] == -3)</span>
<span class="comment">            EV &lt;&lt; stateCache.msg-&gt;getRoutingTable(i).getIp() &lt;&lt; &quot; &quot;;</span>
<span class="comment">    }</span>
<span class="comment">    for (uint i = 0; i &lt; stateCache.prox-&gt;pr_ls.size(); ++i) {</span>
<span class="comment">        if (stateCache.prox-&gt;pr_ls[i] == -3)</span>
<span class="comment">            EV &lt;&lt; stateCache.msg-&gt;getLeafSet(i).getIp() &lt;&lt; &quot; &quot;;</span>
<span class="comment">    }</span>
<span class="comment">    for (uint i = 0; i &lt; stateCache.prox-&gt;pr_ns.size(); ++i) {</span>
<span class="comment">        if (stateCache.prox-&gt;pr_ns[i] == -3)</span>
<span class="comment">            EV &lt;&lt; stateCache.msg-&gt;getNeighborhoodSet(i).getIp() &lt;&lt; &quot; &quot;;</span>
<span class="comment">    }</span>
<span class="comment">    EV &lt;&lt; endl;</span>
<span class="comment">     */</span>

    <span class="comment">// some entries not yet determined?</span>
    <span class="keywordflow">if</span> ((find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.end(),
        PASTRY_PROX_PENDING) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.end()) ||
        (find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.end(),
         PASTRY_PROX_PENDING) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.end()) ||
        (find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.end(),
         PASTRY_PROX_PENDING) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.end())) {
        <span class="comment">//std::cout &lt;&lt; &quot;pending&quot; &lt;&lt; std::endl;</span>
        <span class="keywordflow">return</span>;
    }

    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    all proximities for current STATE message from &quot;</span>
       &lt;&lt; <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; collected!&quot;</span>
       &lt;&lt; endl;
    <span class="comment">/*</span>
<span class="comment">    //debug</span>
<span class="comment">    if (stateCache.prox != NULL) {</span>
<span class="comment">        std::vector&lt;PastryStateMsgHandle&gt;::iterator it;</span>
<span class="comment">        for (it = stReceived.begin(); it != stReceived.end(); ++it) {</span>
<span class="comment">            if (it-&gt;prox == NULL) {</span>
<span class="comment">                EV &lt;&lt; &quot;. &quot; &lt;&lt; endl;</span>
<span class="comment">                continue;</span>
<span class="comment">            }</span>
<span class="comment">            for (uint i = 0; i &lt; it-&gt;prox-&gt;pr_rt.size(); ++i) {</span>
<span class="comment">                EV &lt;&lt; it-&gt;prox-&gt;pr_rt[i] &lt;&lt; &quot; &quot;;</span>
<span class="comment">            }</span>
<span class="comment">            for (uint i = 0; i &lt; it-&gt;prox-&gt;pr_ls.size(); ++i) {</span>
<span class="comment">                EV &lt;&lt; it-&gt;prox-&gt;pr_ls[i] &lt;&lt; &quot; &quot;;</span>
<span class="comment">            }</span>
<span class="comment">            for (uint i = 0; i &lt; it-&gt;prox-&gt;pr_ns.size(); ++i) {</span>
<span class="comment">                EV &lt;&lt; it-&gt;prox-&gt;pr_ns[i] &lt;&lt; &quot; &quot;;</span>
<span class="comment">            }</span>
<span class="comment">            EV &lt;&lt; endl;</span>
<span class="comment">        }</span>
<span class="comment">        EV &lt;&lt; endl;</span>
<span class="comment">    } else EV &lt;&lt; &quot;NULL&quot; &lt;&lt; endl;</span>
<span class="comment">*/</span>

    simtime_t now = simTime();

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) {
        <span class="comment">// save pointer to proximity vectors (it is NULL until now):</span>
        <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>-&gt;prox = <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>;

        <span class="comment">// collected proximities for all STATE messages?</span>
        <span class="keywordflow">if</span> (++<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> == <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end()) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    proximities for all STATE messages collected!&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> = NULL;
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    [JOIN] starting to build own state from &quot;</span>
                   &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; <span class="stringliteral">&quot; received state messages...&quot;</span>
                   &lt;&lt; endl;
            }
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a>()) {
                <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    changeState(READY) called&quot;</span>
                   &lt;&lt; endl;
            } <span class="keywordflow">else</span> {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error initializing while joining! Restarting ...&quot;</span>
                   &lt;&lt; endl;
                <a class="code" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962">joinOverlay</a>();
            }

        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    NOT all proximities for all STATE messages collected!&quot;</span>
               &lt;&lt; endl;
            <span class="comment">/*</span>
<span class="comment">            for (uint32_t i = 0; i &lt; stReceived.size(); ++i) {</span>
<span class="comment">                EV &lt;&lt; ((i == 0) ? &quot;    &quot; : &quot; | &quot;);</span>
<span class="comment">                std::cout &lt;&lt; ((i == 0) ? &quot;    &quot; : &quot; | &quot;);</span>
<span class="comment">                if (stReceived[i].msg == stReceivedPos-&gt;msg) {</span>
<span class="comment">                    EV &lt;&lt; &quot;*&quot;;</span>
<span class="comment">                    std::cout &lt;&lt; &quot;*&quot;;</span>
<span class="comment">                }</span>
<span class="comment">                EV &lt;&lt; stReceived[i].msg &lt;&lt; &quot; &quot; &lt;&lt; stReceived[i].prox;</span>
<span class="comment">                std::cout &lt;&lt; stReceived[i].msg &lt;&lt; &quot; &quot; &lt;&lt; stReceived[i].prox;</span>
<span class="comment">            }</span>
<span class="comment">            EV &lt;&lt; endl;</span>
<span class="comment">            std::cout &lt;&lt; std::endl;</span>
<span class="comment">             */</span>

            <span class="comment">// process next state message in vector:</span>
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>-&gt;msg == NULL)
                <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;stReceivedPos-&gt;msg = NULL&quot;</span>);
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = *<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>;
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> == NULL)
                <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;msg = NULL&quot;</span>);
            <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
        }
    } <span class="keywordflow">else</span> {
        <span class="comment">// state == READY</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == PASTRY_STATE_REPAIR) {
            <span class="comment">// try to repair routingtable based on repair message:</span>
            <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; askRt =
                <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a632d81ee59ded7bc2249b64555b3bb78" title="attempt to repair the routing using a received REPAIR message">repair</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>);
            <span class="keywordflow">if</span> (! askRt.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
                <a class="code" href="classBasePastry.html#ade0791a64218af84150f1da407732397" title="send a request to a given node">sendRequest</a>(askRt, <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a9754cb9213665759246e8d4698f527f4">PASTRY_REQ_REPAIR</a>);
            }

            <span class="comment">// while not really known, it&#39;s safe to assume that a repair</span>
            <span class="comment">// message changed our state:</span>
            <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
        } <span class="keywordflow">else</span> {
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a0907d3b39de28e563bc6bf41c859c00e">outdatedUpdate</a>) {
                <span class="comment">// send another STATE message on outdated state update:</span>
                <a class="code" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">updateCounter</a>++;
                <a class="code" href="classBasePastry.html#a5aab2c66183579ae5d84524caddcdea0" title="send a standard state message with a small delay">sendStateDelayed</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>());
            } <span class="keywordflow">else</span> {
                <span class="comment">// merge info in own state tables</span>
                <span class="comment">// except leafset (was already handled in handleStateMessage)</span>
                <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>))
                    <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Merging nodes into routing table&quot;</span>
                   &lt;&lt; endl;
                <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>)) {
                    <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
                    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    Merged nodes into routing table&quot;</span>
                       &lt;&lt; endl;
                }
            }
        }
        <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();

        <a class="code" href="classPastry.html#a4a681c9a40631e27cdb8a174ce8e2618">endProcessingState</a>();
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace3cd9ad6803c901a4de28d17f960d86"></a><!-- doxytag: member="Pastry::clearVectors" ref="ace3cd9ad6803c901a4de28d17f960d86" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::clearVectors </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00053">53</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00073">purgeVectors()</a>, and <a class="el" href="Pastry_8cc_source.html#l00041">~Pastry()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// purge pending state messages</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.empty()) {
        <span class="keywordflow">for</span> (std::vector&lt;PastryStateMsgHandle&gt;::iterator it =
            <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(); it != <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(); it++) {
            <span class="comment">// check whether one of the pointers is a duplicate of stateCache</span>
            <span class="keywordflow">if</span> (it-&gt;msg == <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
            <span class="keywordflow">if</span> (it-&gt;prox == <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>) <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> = NULL;
            <span class="keyword">delete</span> it-&gt;msg;
            <span class="keyword">delete</span> it-&gt;prox;
        }
        <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.clear();
        <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> = <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end();
    }

    <span class="comment">// purge notify list:</span>
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8358704c2a16e2723f048c4bcbe2922"></a><!-- doxytag: member="Pastry::doJoinUpdate" ref="aa8358704c2a16e2723f048c4bcbe2922" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::doJoinUpdate </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send updated state to all nodes when entering ready state </p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00617">617</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// send &quot;update&quot; state message to all nodes who sent us their state</span>
    <span class="comment">// during INIT, remove these from notifyList so they don&#39;t get our</span>
    <span class="comment">// state twice</span>
    std::vector&lt;TransportAddress&gt;::iterator nListPos;
    <span class="keywordflow">if</span> (!<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.empty()) {
        <span class="keywordflow">for</span> (std::vector&lt;PastryStateMsgHandle&gt;::iterator it =
                 <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(); it != <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(); ++it) {
            simtime_t timestamp = it-&gt;msg-&gt;getTimestamp();
            <a class="code" href="classBasePastry.html#a30a432a8117a6fd6d42f297f7c7113b3" title="send a PastryStateMessage directly to a node">sendStateTables</a>(it-&gt;msg-&gt;getSender(), PASTRY_STATE_UPDATE,
                            &amp;timestamp);
            nListPos = find(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end(),
                            it-&gt;msg-&gt;getSender());
            <span class="keywordflow">if</span> (nListPos != <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end()) {
                <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.erase(nListPos);
            }
            <span class="keyword">delete</span> it-&gt;msg;
            <span class="keyword">delete</span> it-&gt;prox;
        }
        <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.clear();
    }

    <span class="comment">// send a normal STATE message to all remaining known nodes</span>
    <span class="keywordflow">for</span> (std::vector&lt;TransportAddress&gt;::iterator it =
             <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(); it != <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end(); it++) {
        <span class="keywordflow">if</span> (*it != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) <a class="code" href="classBasePastry.html#a30a432a8117a6fd6d42f297f7c7113b3" title="send a PastryStateMessage directly to a node">sendStateTables</a>(*it, <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7aa3cde395106c55f5fb90538d45fdd46c">PASTRY_STATE_JOINUPDATE</a>);
    }
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();

    <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a08e9157d1221cded34f870c3abc934f7"></a><!-- doxytag: member="Pastry::doRoutingTableMaintenance" ref="a08e9157d1221cded34f870c3abc934f7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::doRoutingTableMaintenance </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>periodic routing table maintenance requests the corresponding routing table row from one node in each row </p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00696">696</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a449b7e0abcd2be8a93816669201bfc4c" title="gets the number of rows in the routing table">getLastRow</a>(); i++) {
        <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; ask4row = <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a37d02a2bda67fe9618b382f321a532d3" title="returns a random node from the routing table">getRandomNode</a>(i);

        <span class="keywordflow">if</span> ((!ask4row.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) &amp;&amp; (ask4row != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {
            <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>* msg =
                <span class="keyword">new</span> <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>(<span class="stringliteral">&quot;ROWREQ&quot;</span>);
            msg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a69f787010e934271e5de155a65c22702">PASTRY_MSG_ROWREQ</a>);
            msg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
            msg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#abf43cf8c25c231ae943f78b55dae650a">setSendStateTo</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            msg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#ae6f4edc057a2addcfee9600f042d0df5">setRow</a>(i + 1);
            msg-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#aec1aa9cda971eb29ce1b041b27a5cb96">PASTRYRTREQ_L</a>(msg));

            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a30413da700f177a195a011a1e46f4627">routingTableReqSent</a>++;
                         <a class="code" href="classBasePastry.html#a0fcc70cc77b501a0827ab426305b8675">routingTableReqBytesSent</a> += msg-&gt;getByteLength());

            <a class="code" href="classBaseOverlay.html#a124850e5bc8d81b3eb4f3aec75868449" title="Sends message to underlay.">sendMessageToUDP</a>(ask4row, msg);
        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::doRoutingTableMaintenance() @ &quot;</span>
               &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    could not send Message to Node in Row&quot;</span> &lt;&lt; i
               &lt;&lt; endl;
        }
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a13e50eccbed545c79aed4d1f2d9ac9ae"></a><!-- doxytag: member="Pastry::doSecondStage" ref="a13e50eccbed545c79aed4d1f2d9ac9ae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::doSecondStage </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>do the second stage of initialization as described in the paper </p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00650">650</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    getParentModule()-&gt;getParentModule()-&gt;bubble(<span class="stringliteral">&quot;entering SECOND STAGE&quot;</span>);

    <span class="comment">// probe nodes in local state</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ae13d5a42c50606e3cc0fbcd830429322" title="check if LeafSet knows at least one node to the left and to the right">isValid</a>()) {
        <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>* stateMsg = <span class="keyword">new</span> <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>(<span class="stringliteral">&quot;STATE&quot;</span>);
        stateMsg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a3fc217f62b60d4208e70416527c0bd83">PASTRY_MSG_STATE</a>);
        stateMsg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
        stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#ae975186961523cda3e2a8d4973eb9ee3">setPastryStateMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a47af4c6e9cd3d1165507bcbb572215c1">PASTRY_STATE_STD</a>);
        stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a9778899b911fe623a773b4e17974fa65">setSender</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a1d4e337dda181b732aa96cd5d5007a42" title="dump content of the table to a PastryStateMessage">dumpToStateMessage</a>(stateMsg);
        <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a86d0046df97f4d54384d2a0b3936c53e" title="dump content of the set to a PastryStateMessage">dumpToStateMessage</a>(stateMsg);
        <a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryNeighborhoodSet.html#a401ee530fc0a5b89cfc2ccda3a0a7250" title="dump content of the set to a PastryStateMessage">dumpToStateMessage</a>(stateMsg);
        <span class="comment">//stateMsg-&gt;setBitLength(PASTRYSTATE_L(stateMsg));</span>
        <a class="code" href="structPastryStateMsgHandle.html" title="struct-type containing local info while processing a STATE message">PastryStateMsgHandle</a> handle(stateMsg);

        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) {
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = handle;
            <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
        } <span class="keywordflow">else</span> {
            <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.push(handle);
            <a class="code" href="classBasePastry.html#af6a7090deb645b1f79b33edb0409485c" title="ping all nodes in a given state message.">prePing</a>(stateMsg);
        }
    }

    <span class="comment">// &quot;second stage&quot; for locality:</span>
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
    <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#aed1ca355690a9e0354a420bf7c96e3a4" title="appends all routing table entries to a given vector of TransportAddresses, needed to find all Nodes t...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
    <a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryNeighborhoodSet.html#ac0741c4c45fb5176e207dadc67a20a03" title="appends all neighborhood set entries to a given vector of TransportAddresses, needed to find all Node...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
    sort(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.erase(unique(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end()),
                     <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());
    <span class="keywordflow">for</span> (std::vector&lt;TransportAddress&gt;::iterator it = <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin();
         it != <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end(); it++) {
        <span class="keywordflow">if</span> (*it == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) <span class="keywordflow">continue</span>;
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::doSecondStage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    second stage: requesting state from &quot;</span> &lt;&lt; *it
           &lt;&lt; endl;
        <a class="code" href="classBasePastry.html#ade0791a64218af84150f1da407732397" title="send a request to a given node">sendRequest</a>(*it, <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a4d4daffa9327b1e1c9a57b79e92b7c83">PASTRY_REQ_STATE</a>);
    }
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4a681c9a40631e27cdb8a174ce8e2618"></a><!-- doxytag: member="Pastry::endProcessingState" ref="a4a681c9a40631e27cdb8a174ce8e2618" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::endProcessingState </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00944">944</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, and <a class="el" href="Pastry_8cc_source.html#l01296">processState()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// if state message was not an update, send one back:</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> &amp;&amp;
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() != <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a54b61d3690155bcd38468f1a14de088e">PASTRY_STATE_UPDATE</a> &amp;&amp;
        (<a class="code" href="classBasePastry.html#a26f8166e84753ec35921c7cff3ff10d9">alwaysSendUpdate</a> || <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> == simTime()) &amp;&amp;
        <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>()) {<span class="comment">//hack</span>
        simtime_t timestamp = <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a64e104bf42d6785530fba51af52bc44c">getTimestamp</a>();
        <a class="code" href="classBasePastry.html#a30a432a8117a6fd6d42f297f7c7113b3" title="send a PastryStateMessage directly to a node">sendStateTables</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>(), PASTRY_STATE_UPDATE,
                        &amp;timestamp);
    }

    <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>;
    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
    <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>;
    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> = NULL;

    <span class="comment">// process next queued message:</span>
    <span class="keywordflow">if</span> (! <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.empty()) {
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.front();
        <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.pop();
        <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
    } <span class="comment">//TODO get rid of the delayed update messages...</span>
    <span class="comment">/*else {</span>
<span class="comment">        std::cout &lt;&lt; thisNode.getIp() &lt;&lt; &quot;\t&quot; &lt;&lt; simTime()</span>
<span class="comment">                  &lt;&lt; &quot; all states processed (&quot;</span>
<span class="comment">                  &lt;&lt; updateCounter &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;</span>
<span class="comment">        updateCounter = 0;</span>
<span class="comment">    }*/</span>
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad94a0f122fe78b1b0002735ce19fea84"></a><!-- doxytag: member="Pastry::handleFailedNode" ref="ad94a0f122fe78b1b0002735ce19fea84" args="(const TransportAddress &amp;failed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Pastry::handleFailedNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>failed</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>notifies leafset and routingtable of a failed node and sends out a repair request if possible </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>failed</em>&nbsp;</td><td>the failed node </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true as long as local state is READY (signals lookup to try again) </dd></dl>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00725">725</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00325">handleUDPMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l00562">recursiveRoutingHook()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordtype">bool</span> wasValid = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ae13d5a42c50606e3cc0fbcd830429322" title="check if LeafSet knows at least one node to the left and to the right">isValid</a>();

    <span class="comment">//std::cout &lt;&lt; thisNode.getIp() &lt;&lt; &quot; is handling failed node: &quot;</span>
    <span class="comment">//          &lt;&lt; failed.getIp() &lt;&lt; std::endl;</span>
    <span class="keywordflow">if</span> (failed.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>())
        opp_error(<span class="stringliteral">&quot;Pastry::handleFailedNode(): failed is unspecified!&quot;</span>);

    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; lsAsk = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ad691bdd611ba773d5b7a0a90af491498" title="tells the leafset that a node has failed">failedNode</a>(failed);
    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; rtAsk = <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#ae440c8aa89543afc2147b8784be93c41" title="tells the routing table that a node has failed">failedNode</a>(failed);
    <a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryNeighborhoodSet.html#a86f227b707f881c8897ec334f2bd5a33" title="tell the neighborhood set about a failed node">failedNode</a>(failed);

    <span class="keywordflow">if</span> (! lsAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a>) <a class="code" href="classBasePastry.html#ade0791a64218af84150f1da407732397" title="send a request to a given node">sendRequest</a>(lsAsk, <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a9754cb9213665759246e8d4698f527f4">PASTRY_REQ_REPAIR</a>);
        <span class="keywordflow">else</span> <a class="code" href="classBasePastry.html#ade0791a64218af84150f1da407732397" title="send a request to a given node">sendRequest</a>(lsAsk, <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00aa1e0b92435e08d44a42f799bc904cd4d">PASTRY_REQ_LEAFSET</a>);
    }
    <span class="keywordflow">if</span> (! rtAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp;
        (lsAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() ||
         lsAsk != rtAsk)) <a class="code" href="classBasePastry.html#ade0791a64218af84150f1da407732397" title="send a request to a given node">sendRequest</a>(rtAsk, <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a9754cb9213665759246e8d4698f527f4">PASTRY_REQ_REPAIR</a>);

    <span class="keywordflow">if</span> (wasValid &amp;&amp; lsAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; (! <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ae13d5a42c50606e3cc0fbcd830429322" title="check if LeafSet knows at least one node to the left and to the right">isValid</a>())) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleFailedNode() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    lost connection to the network, trying to re-join.&quot;</span>
           &lt;&lt; endl;
        <span class="comment">//std::cout &lt;&lt; thisNode.getIp()</span>
        <span class="comment">//          &lt;&lt; &quot; Pastry: lost connection to the network, trying to re-join.&quot;</span>
        <span class="comment">//          &lt;&lt; std::endl;</span>
        <a class="code" href="classBaseOverlay.html#acb8855faa86247ae37ab894891d9f4dd" title="Join the overlay with a given nodeID.">join</a>();
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1dece33e7864cc0f823374daa28da6c9"></a><!-- doxytag: member="Pastry::handleStateMessage" ref="a1dece33e7864cc0f823374daa28da6c9" args="(PastryStateMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleStateMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPastryStateMessage.html">PastryStateMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>processes state messages, merging with own state tables </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>the pastry state message </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classBasePastry.html#a1172a453b44856e2fdd7a027f0d03833">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l01071">1071</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00325">handleUDPMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    new STATE message to process &quot;</span>
           &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(msg) &lt;&lt; <span class="stringliteral">&quot; in state &quot;</span> &lt;&lt;
            ((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)?<span class="stringliteral">&quot;READY&quot;</span>:((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == JOINING_2)?<span class="stringliteral">&quot;JOIN&quot;</span>:<span class="stringliteral">&quot;INIT&quot;</span>))
           &lt;&lt; endl;
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    ***   own joinHopCount:  &quot;</span> &lt;&lt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> &lt;&lt; endl
               &lt;&lt; <span class="stringliteral">&quot;    ***   already received:  &quot;</span> &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; endl
               &lt;&lt; <span class="stringliteral">&quot;    ***   last-hop flag:     &quot;</span>
               &lt;&lt; (msg-&gt;<a class="code" href="classPastryStateMessage.html#a3bc2696f0c1e87ea38b8bd7e7e56dbe7">getLastHop</a>() ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>) &lt;&lt; endl
               &lt;&lt; <span class="stringliteral">&quot;    ***   msg joinHopCount:  &quot;</span>
               &lt;&lt; msg-&gt;<a class="code" href="classPastryStateMessage.html#a9f92320d1981aef58c238ce1a83b712b">getJoinHopCount</a>() &lt;&lt; endl;
        }
    }
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a> || <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="BasePastry_8h.html#a368457fbb93f1eed641b33da5a87856a">DISCOVERY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    can&#39;t handle state messages until at least reaching JOIN state.&quot;</span>
           &lt;&lt; endl;
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }

    <a class="code" href="structPastryStateMsgHandle.html" title="struct-type containing local info while processing a STATE message">PastryStateMsgHandle</a> handle(msg);

    <span class="comment">// in JOIN state, store all received state Messages, need them later:</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) {
        <span class="comment">//std::cout &lt;&lt; simTime() &lt;&lt; &quot; &quot; &lt;&lt; thisNode.getIp() &lt;&lt; &quot; &quot;</span>
        <span class="comment">//          &lt;&lt; msg-&gt;getJoinHopCount()</span>
        <span class="comment">//          &lt;&lt; (msg-&gt;getLastHop() ? &quot; *&quot; : &quot;&quot;) &lt;&lt; std::endl;</span>

        <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() != PASTRY_STATE_JOIN) {
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> &amp;&amp; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() == <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Warning: dropping state message received after &quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;all needed state messages were collected in JOIN state.&quot;</span>
               &lt;&lt; endl;
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }

        <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.push_back(handle);
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> &amp;&amp; <a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) <a class="code" href="classBasePastry.html#af6a7090deb645b1f79b33edb0409485c" title="ping all nodes in a given state message.">prePing</a>(msg);

        <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classPastryStateMessage.html#a3bc2696f0c1e87ea38b8bd7e7e56dbe7">getLastHop</a>()) {
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>-&gt;isScheduled()) {
                <span class="comment">//std::cout &lt;&lt; simTime() &lt;&lt; &quot; &quot; &lt;&lt; thisNode.getIp()</span>
                <span class="comment">//&lt;&lt; &quot; cancelEvent(joinTimeout), received:&quot;</span>
                <span class="comment">//&lt;&lt; stReceived.size() &lt;&lt; &quot;, hopcount:&quot; &lt;&lt; joinHopCount &lt;&lt; std::endl;</span>
                cancelEvent(<a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>);
            }
            <span class="comment">/*if (msg-&gt;getSender().getKey() == thisNode.getKey()) {</span>
<span class="comment">                EV &lt;&lt; &quot;[Pastry::handleStateMessage() @ &quot; &lt;&lt; thisNode.getIp()</span>
<span class="comment">                   &lt;&lt; &quot; (&quot; &lt;&lt; thisNode.getKey().toString(16) &lt;&lt; &quot;)]\n&quot;</span>
<span class="comment">                   &lt;&lt; &quot;    Error: OverlayKey already in use, restarting!&quot;</span>
<span class="comment">                   &lt;&lt; endl;</span>
<span class="comment">                //std::cout &lt;&lt; &quot;Pastry: Error: OverlayKey already in use, restarting!&quot;</span>
<span class="comment">                //                   &lt;&lt; std::endl;</span>
<span class="comment">                joinOverlay();</span>
<span class="comment">                return;</span>
<span class="comment">            }*/</span>

            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error: received a second `last&#39; state message! Restarting ...&quot;</span>
                   &lt;&lt; endl;
                <span class="comment">//std::cout &lt;&lt; thisNode.getIp() &lt;&lt; &quot;Pastry: Error: received a second `last&#39; state message! &quot;</span>
                <span class="comment">//                    &quot;Restarting ...&quot; &lt;&lt; std::endl;</span>
                <a class="code" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962">joinOverlay</a>();
                <span class="keywordflow">return</span>;
            }

            <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> = msg-&gt;<a class="code" href="classPastryStateMessage.html#a9f92320d1981aef58c238ce1a83b712b">getJoinHopCount</a>();
            <span class="comment">//std::cout &lt;&lt; stReceived.size() &lt;&lt; &quot; &quot; &lt;&lt; joinHopCount &lt;&lt; std::endl;</span>
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                <span class="comment">// some states still missing:</span>
                cancelEvent(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
                scheduleAt(simTime() + <a class="code" href="classBasePastry.html#a98b0c284102cd5f1fc78558937b9b19f">readyWaitAmount</a>, <a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
                <span class="comment">//std::cout &lt;&lt; simTime() &lt;&lt; &quot; &quot; &lt;&lt; thisNode.getIp() &lt;&lt; &quot; readyWait scheduled!&quot; &lt;&lt; std::endl;</span>
            }
        }

        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &gt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error: too many state messages received in JOIN state! (&quot;</span>
                   &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span> &lt;&lt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> &lt;&lt; <span class="stringliteral">&quot;) Restarting ...&quot;</span>
                   &lt;&lt; endl;
                <span class="comment">//std::cout &lt;&lt; &quot; failed!&quot; &lt;&lt; std::endl;</span>
                <a class="code" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962">joinOverlay</a>();
                <span class="keywordflow">return</span>;
            }
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() == <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                <span class="comment">// all state messages are here, sort by hopcount:</span>
                sort(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(), <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(),
                     stateMsgIsSmaller);

                <span class="comment">// start pinging the nodes found in the first state message:</span>
                <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> = <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin();
                <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = *stReceivedPos;
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    have all STATE messages, now pinging nodes.&quot;</span>
                   &lt;&lt; endl;
                <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> &amp;&amp; <a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) {
                    <a class="code" href="classBasePastry.html#a445a74a2791f810975bf99b4ff7d9865" title="ping all nodes in the pastry state message pointed to by private member stateCache">pingNodes</a>();
                } <span class="keywordflow">else</span> {
                    <a class="code" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a>(); <span class="comment">// JOINING / stateCache</span>
                    <span class="comment">//endProcessingState(); //no way</span>
                    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
                    <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
                    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    changeState(READY) called&quot;</span>
                       &lt;&lt; endl;
                }

                <span class="comment">// cancel timeout:</span>
                <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
            } <span class="keywordflow">else</span> {
                <span class="comment">//TODO occasionally, here we got a wrong hop count in</span>
                <span class="comment">// iterative mode due to more than one it. lookup during join</span>
                <span class="comment">// procedure</span>
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Still need some STATE messages.&quot;</span>
                   &lt;&lt; endl;
            }

        }
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    handling STATE message&quot;</span>
           &lt;&lt; endl;
        EV &lt;&lt; <span class="stringliteral">&quot;        type: &quot;</span> &lt;&lt; ((msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>()
                                    == PASTRY_STATE_UPDATE) ? <span class="stringliteral">&quot;update&quot;</span>
                                                            :<span class="stringliteral">&quot;standard&quot;</span>)
           &lt;&lt; endl;
        <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == PASTRY_STATE_UPDATE) {
            EV &lt;&lt; <span class="stringliteral">&quot;        msg timestamp:      &quot;</span> &lt;&lt;
                msg-&gt;<a class="code" href="classPastryStateMessage.html#a64e104bf42d6785530fba51af52bc44c">getTimestamp</a>() &lt;&lt; endl;
            EV &lt;&lt; <span class="stringliteral">&quot;        last state change:  &quot;</span> &lt;&lt;
                <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> &lt;&lt; endl;
        }
    }

    <span class="keywordflow">if</span> (((msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == PASTRY_STATE_UPDATE))
            &amp;&amp; (msg-&gt;<a class="code" href="classPastryStateMessage.html#a64e104bf42d6785530fba51af52bc44c">getTimestamp</a>() &lt;= <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a>)) {
        <span class="comment">// if we received an update based on our outdated state,</span>
        <span class="comment">// mark handle for retrying later:</span>
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    outdated state from &quot;</span> &lt;&lt; msg-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>()
           &lt;&lt; endl;
        handle.outdatedUpdate = <span class="keyword">true</span>;
    }

    <span class="comment">// determine aliveTable to prevent leafSet from merging nodes that are</span>
    <span class="comment">// known to be dead:</span>
    <a class="code" href="classBasePastry.html#a89aba6ca97abfbe6baff748a19969d1e" title="change the aliveTable to match the given stateMsg.">determineAliveTable</a>(msg);

    <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == PASTRY_STATE_REPAIR) {
        <span class="comment">// try to repair leafset based on repair message right now</span>
        <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; askLs = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#aee63679544eb8ea21dbbf4d5dc7ef330" title="attempt to repair the leafset using a received REPAIR message">repair</a>(msg, &amp;<a class="code" href="classBasePastry.html#a22e76d53e4ba89d63eca403923a46da8" title="Early update of leaf set: helper structure for marking known-dead nodes.">aliveTable</a>);
        <span class="keywordflow">if</span> (! askLs.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
            <a class="code" href="classBasePastry.html#ade0791a64218af84150f1da407732397" title="send a request to a given node">sendRequest</a>(askLs, <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a9754cb9213665759246e8d4698f527f4">PASTRY_REQ_REPAIR</a>);
        }

        <span class="comment">// while not really known, it&#39;s safe to assume that a repair</span>
        <span class="comment">// message changed our state:</span>
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, &amp;<a class="code" href="classBasePastry.html#a22e76d53e4ba89d63eca403923a46da8" title="Early update of leaf set: helper structure for marking known-dead nodes.">aliveTable</a>)) {
        <span class="comment">// merged state into leafset right now</span>
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();
    }
    <span class="comment">// in READY state, only ping nodes to get proximity metric:</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) {
        <span class="comment">// no state message is processed right now, start immediately:</span>
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = handle;
        <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a> &amp;&amp; (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> ||
            msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == PASTRY_STATE_STD)) {
            <span class="comment">// enqueue message for later processing:</span>
            <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.push(handle);
            <a class="code" href="classBasePastry.html#af6a7090deb645b1f79b33edb0409485c" title="ping all nodes in a given state message.">prePing</a>(msg);
        } <span class="keywordflow">else</span> {
            <span class="keywordtype">bool</span> temp = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, NULL)) {
                temp = <span class="keyword">false</span>;
            }
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, NULL)) {
                temp = <span class="keyword">false</span>;
            } <span class="keywordflow">else</span> {
                <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
            }
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, NULL)) {
                temp = <span class="keyword">false</span>;
            }
            <span class="keywordflow">if</span> (temp) <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
            <span class="keyword">delete</span> msg;
        }
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aabc1a8eaab8eea9ec5e4830ee60499f8"></a><!-- doxytag: member="Pastry::handleTimerEvent" ref="aabc1a8eaab8eea9ec5e4830ee60499f8" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00243">243</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (msg == <a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    timeout expired, restarting...&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classBaseOverlay.html#acb8855faa86247ae37ab894891d9f4dd" title="Join the overlay with a given nodeID.">join</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>) {
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">partialJoinPath</a>) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a805e366ae01f6857dcb0e4a78c7e79d6">joinPartial</a>++);
            sort(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(), <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(), stateMsgIsSmaller);

            <span class="comment">// start pinging the nodes found in the first state message:</span>
            <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> = <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin();
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = *stReceivedPos;
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    joining despite some missing STATE messages.&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    timeout waiting for missing state messages&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot; in JOIN state, restarting...&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962">joinOverlay</a>();
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    sending state updates to all nodes.&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#aa8358704c2a16e2723f048c4bcbe2922" title="send updated state to all nodes when entering ready state">doJoinUpdate</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    sending STATE requests to all nodes in&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot; second stage of initialization.&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a13e50eccbed545c79aed4d1f2d9ac9ae" title="do the second stage of initialization as described in the paper">doSecondStage</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isName(<span class="stringliteral">&quot;sendStateWait&quot;</span>)) {
        <a class="code" href="classPastrySendState.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastrySendState</a>* sendStateMsg = check_and_cast&lt;<a class="code" href="classPastrySendState.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastrySendState</a>*&gt;(msg);

        std::vector&lt;PastrySendState*&gt;::iterator pos =
            std::find(<a class="code" href="classBasePastry.html#ada6bd66160f1bf192a2d4422b6f8d7b4">sendStateWait</a>.begin(), <a class="code" href="classBasePastry.html#ada6bd66160f1bf192a2d4422b6f8d7b4">sendStateWait</a>.end(),
                      sendStateMsg);
        <span class="keywordflow">if</span> (pos != <a class="code" href="classBasePastry.html#ada6bd66160f1bf192a2d4422b6f8d7b4">sendStateWait</a>.end()) <a class="code" href="classBasePastry.html#ada6bd66160f1bf192a2d4422b6f8d7b4">sendStateWait</a>.erase(pos);

        <a class="code" href="classBasePastry.html#a30a432a8117a6fd6d42f297f7c7113b3" title="send a PastryStateMessage directly to a node">sendStateTables</a>(sendStateMsg-&gt;<a class="code" href="classPastrySendState.html#a75f7974a4daa6381d9b3670096de5c61">getDest</a>());
        <span class="keyword">delete</span> sendStateMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>) {
        <span class="keywordflow">if</span> ((<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> == 0) &amp;&amp; (<a class="code" href="classBasePastry.html#a4ac33dcce9d9a383a740d1227cff76aa">nearNodeImproved</a>)) {
            <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a>++; <span class="comment">//repeat last step if closer node was found</span>
        }
        <span class="keywordflow">if</span> ((<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> == 0) || (<a class="code" href="classBasePastry.html#a773482c4b45374b82b35a72a4935574a">pingedNodes</a> &lt; 1)) {
            <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>);
        } <span class="keywordflow">else</span> {
            <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>* msg =
                <span class="keyword">new</span> <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>(<span class="stringliteral">&quot;ROWREQ&quot;</span>);
            msg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a69f787010e934271e5de155a65c22702">PASTRY_MSG_ROWREQ</a>);
            msg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
            msg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#abf43cf8c25c231ae943f78b55dae650a">setSendStateTo</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            msg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#ae6f4edc057a2addcfee9600f042d0df5">setRow</a>(<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a>);
            msg-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#aec1aa9cda971eb29ce1b041b27a5cb96">PASTRYRTREQ_L</a>(msg));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a30413da700f177a195a011a1e46f4627">routingTableReqSent</a>++;
                         <a class="code" href="classBasePastry.html#a0fcc70cc77b501a0827ab426305b8675">routingTableReqBytesSent</a> += msg-&gt;getByteLength());
            <a class="code" href="classBaseOverlay.html#a124850e5bc8d81b3eb4f3aec75868449" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classBasePastry.html#aaa36dc41f21d16f4e7a03e92911c17ab">nearNode</a>, msg);
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    starting routing table maintenance&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a08e9157d1221cded34f870c3abc934f7" title="periodic routing table maintenance requests the corresponding routing table row from one node in each...">doRoutingTableMaintenance</a>();
        scheduleAt(simTime() + <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a>,
                   <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47fc606cfbb1977305f97c60c3c21481"></a><!-- doxytag: member="Pastry::handleUDPMessage" ref="a47fc606cfbb1977305f97c60c3c21481" args="(BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleUDPMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00325">325</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastryMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryMessage</a>* pastryMsg = check_and_cast&lt;<a class="code" href="classPastryMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryMessage</a>*&gt;(msg);
    uint32_t type = pastryMsg-&gt;<a class="code" href="classPastryMessage.html#a9e66d5e8500b6ad714cbbe3fa2078d73">getPastryMsgType</a>();

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    incoming message of type &quot;</span>;
        <span class="keywordflow">switch</span>(type) {
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00aab9b15b25e3f7087a561862f304a7105">PASTRY_MSG_STD</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_STD&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00afe224824cc07fb076471ed2e3328d729">PASTRY_MSG_JOIN</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_JOIN&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a3fc217f62b60d4208e70416527c0bd83">PASTRY_MSG_STATE</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_STATE&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00acf999654230db12963475fe7578f84d0">PASTRY_MSG_LEAFSET</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_LEAFSET&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a69f787010e934271e5de155a65c22702">PASTRY_MSG_ROWREQ</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_ROWREQ&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00af6b2263d326f61d280fca5230df2ee82">PASTRY_MSG_RROW</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_RROW&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00ab425e857aeb7247b770716d6038fc527">PASTRY_MSG_REQ</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_REQ&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            EV &lt;&lt; <span class="stringliteral">&quot;UNKNOWN (&quot;</span> &lt;&lt; type &lt;&lt;<span class="stringliteral">&quot;)&quot;</span>;
            <span class="keywordflow">break</span>;
        }
        EV &lt;&lt; endl;
    }

    <span class="keywordflow">switch</span> (type) {
    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00aab9b15b25e3f7087a561862f304a7105">PASTRY_MSG_STD</a>:
        opp_error(<span class="stringliteral">&quot;Pastry received PastryMessage of unknown type!&quot;</span>);
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00afe224824cc07fb076471ed2e3328d729">PASTRY_MSG_JOIN</a>: {
        <a class="code" href="classPastryJoinMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinMessage</a>* jmsg =
            check_and_cast&lt;<a class="code" href="classPastryJoinMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a3d1f5f390900492fb714e0f420ded63a">joinReceived</a>++; <a class="code" href="classBasePastry.html#ab2be7f6fc3c97b1d93f43f083cff6f6a">joinBytesReceived</a> +=
                     jmsg-&gt;getByteLength());
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
            <span class="keywordflow">if</span> (jmsg-&gt;<a class="code" href="classPastryJoinMessage.html#a30282b3d0a1413406fa4520c4df53a3f">getSendStateTo</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    PastryJoinMessage received by originator!&quot;</span>
                   &lt;&lt; endl;
            } <span class="keywordflow">else</span> {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    received join message before reaching &quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;READY state, dropping message!&quot;</span>
                   &lt;&lt; endl;
            }
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (jmsg-&gt;<a class="code" href="classPastryJoinMessage.html#a30282b3d0a1413406fa4520c4df53a3f">getSendStateTo</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    PastryJoinMessage gets dropped because it is &quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;outdated and has been received by originator!&quot;</span>
               &lt;&lt; endl;
        } <span class="keywordflow">else</span> {
            <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* overlayCtrlInfo
                = check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(jmsg-&gt;getControlInfo());

            uint32_t <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> =  overlayCtrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#a76fd4681ebb00eb023e35a88e4ba9042">getHopCount</a>();
            <span class="keywordflow">if</span> ((joinHopCount &gt; 1) &amp;&amp;
                ((<a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ae4bd936cbb47803986c83242cbb51867">ITERATIVE_ROUTING</a>) ||
                 (<a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad60cf756d6bb24af372d7fe7c279f44d">EXHAUSTIVE_ITERATIVE_ROUTING</a>)))
                 joinHopCount--;

            <span class="comment">// remove node from state if it is rejoining</span>
            <a class="code" href="classPastry.html#ad94a0f122fe78b1b0002735ce19fea84" title="notifies leafset and routingtable of a failed node and sends out a repair request if possible...">handleFailedNode</a>(jmsg-&gt;<a class="code" href="classPastryJoinMessage.html#a30282b3d0a1413406fa4520c4df53a3f">getSendStateTo</a>());

            <a class="code" href="classBasePastry.html#a30a432a8117a6fd6d42f297f7c7113b3" title="send a PastryStateMessage directly to a node">sendStateTables</a>(jmsg-&gt;<a class="code" href="classPastryJoinMessage.html#a30282b3d0a1413406fa4520c4df53a3f">getSendStateTo</a>(),
                            (<a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> ?
                              <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7abfbb059d5d48ab5c68f49eb88464171d">PASTRY_STATE_MINJOIN</a> : PASTRY_STATE_JOIN),
                             joinHopCount, <span class="keyword">true</span>);
        }

        <span class="keyword">delete</span> jmsg;
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00acf999654230db12963475fe7578f84d0">PASTRY_MSG_LEAFSET</a>: {
        <a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>* lmsg =
            check_and_cast&lt;<a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a966f88cf985632e3e28ff482c5e5d0a2">leafsetReceived</a>++; <a class="code" href="classBasePastry.html#a9bdc81ede316e30996bbee5c73f6b472">leafsetBytesReceived</a> +=
            lmsg-&gt;getByteLength());

        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="BasePastry_8h.html#a368457fbb93f1eed641b33da5a87856a">DISCOVERY</a>) {
            uint32_t lsSize = lmsg-&gt;<a class="code" href="classPastryLeafsetMessage.html#a135fa5f4053605495e6c96fda2da6207">getLeafSetArraySize</a>();
            <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>* node;
            <a class="code" href="classBasePastry.html#a773482c4b45374b82b35a72a4935574a">pingedNodes</a> = 0;

            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; lsSize; i++) {
                node = &amp;(lmsg-&gt;<a class="code" href="classPastryLeafsetMessage.html#a205f40fcdaa84d30d9b634bd3023a152">getLeafSet</a>(i));
                <span class="comment">// unspecified nodes not considered</span>
                <span class="keywordflow">if</span> ( !(node-&gt;<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>()) ) {
                    <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(*node, <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, 0,
                             NULL, <span class="stringliteral">&quot;PING received leafs for nearest node&quot;</span>,
                             NULL, -1, <a class="code" href="CommonMessages__m_8h.html#aca1e72535e7f260e54ed8bbf984dade9a01580b2e886cd821bd7f3f2bcd7c690c">UDP_TRANSPORT</a>);<span class="comment">//TODO</span>
                    <a class="code" href="classBasePastry.html#a773482c4b45374b82b35a72a4935574a">pingedNodes</a>++;
               }
            }

            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    received leafset, waiting for pings&quot;</span>
              &lt;&lt; endl;

            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
            scheduleAt(simTime() + <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
            <span class="keyword">delete</span> lmsg;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
            <a class="code" href="classBasePastry.html#a1ea1672c0d5c853e4d823a8095c672b5" title="processes leafset messages, merging with own state tables">handleLeafsetMessage</a>(lmsg, <span class="keyword">false</span>);
        } <span class="keywordflow">else</span> {
            <span class="keyword">delete</span> lmsg;
        }
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a69f787010e934271e5de155a65c22702">PASTRY_MSG_ROWREQ</a>: {
        <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>* rtrmsg =
            check_and_cast&lt;<a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a9d8bb5f1b8e375adcf29601b06a26966">routingTableReqReceived</a>++; <a class="code" href="classBasePastry.html#ac130146fa13b0d04a15a25fdb2571ddd">routingTableReqBytesReceived</a> +=
            rtrmsg-&gt;getByteLength());
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)
            <span class="keywordflow">if</span> (rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#acfc899745150aca33c7e5321d54911a0">getRow</a>() == -1)
                <a class="code" href="classBasePastry.html#a61fcc4fef7533577ee94b6c452627c0a" title="send a row of the routing table to a node">sendRoutingRow</a>(rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#a3e36722e08010b81f7aece10a5ececde">getSendStateTo</a>(), <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a449b7e0abcd2be8a93816669201bfc4c" title="gets the number of rows in the routing table">getLastRow</a>());
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#acfc899745150aca33c7e5321d54911a0">getRow</a>() &gt; <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a449b7e0abcd2be8a93816669201bfc4c" title="gets the number of rows in the routing table">getLastRow</a>())
                    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    received request for nonexistent routing&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;table row, dropping message!&quot;</span>
                       &lt;&lt; endl;
                <span class="keywordflow">else</span> <a class="code" href="classBasePastry.html#a61fcc4fef7533577ee94b6c452627c0a" title="send a row of the routing table to a node">sendRoutingRow</a>(rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#a3e36722e08010b81f7aece10a5ececde">getSendStateTo</a>(), rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#acfc899745150aca33c7e5321d54911a0">getRow</a>());
        <span class="keywordflow">else</span>
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    received routing table request before reaching &quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;READY state, dropping message!&quot;</span>
               &lt;&lt; endl;
        <span class="keyword">delete</span> rtrmsg;
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00af6b2263d326f61d280fca5230df2ee82">PASTRY_MSG_RROW</a>: {
        <a class="code" href="classPastryRoutingRowMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowMessage</a>* rtmsg =
            check_and_cast&lt;<a class="code" href="classPastryRoutingRowMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a93981f405e583d046c1609c075971c6c">routingTableReceived</a>++; <a class="code" href="classBasePastry.html#a74edb3cc83cb66d94e2f1dc3dd2c42f0">routingTableBytesReceived</a> +=
            rtmsg-&gt;getByteLength());

        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="BasePastry_8h.html#a368457fbb93f1eed641b33da5a87856a">DISCOVERY</a>) {
            uint32_t nodesPerRow = rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#af92b954e91a51be973c23f77a2aeb96e">getRoutingTableArraySize</a>();
            <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>* node;
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> == -1) {
                <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> = rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#a212ef0c7f8e9746d493e636ac86e8bc6">getRow</a>();
            }
            <a class="code" href="classBasePastry.html#a773482c4b45374b82b35a72a4935574a">pingedNodes</a> = 0;
            <a class="code" href="classBasePastry.html#a4ac33dcce9d9a383a740d1227cff76aa">nearNodeImproved</a> = <span class="keyword">false</span>;

            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> &gt; 0) {
                <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; nodesPerRow; i++) {
                    node = &amp;(rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#a74f561d0fede6f8f03d55af8034ed9ac">getRoutingTable</a>(i));
                    <span class="comment">// unspecified nodes not considered</span>
                    <span class="keywordflow">if</span> ( !(node-&gt;<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>()) ) {
                        <span class="comment">// we look for best connection here, so Timeout is short and there are no retries</span>
                        <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(*node, <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, 0, NULL,
                                 <span class="stringliteral">&quot;PING received routing table for nearest node&quot;</span>,
                                 NULL, -1, <a class="code" href="CommonMessages__m_8h.html#aca1e72535e7f260e54ed8bbf984dade9a01580b2e886cd821bd7f3f2bcd7c690c">UDP_TRANSPORT</a>); <span class="comment">//TODO</span>
                        <a class="code" href="classBasePastry.html#a773482c4b45374b82b35a72a4935574a">pingedNodes</a>++;
                    }
                }
                <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a>--;
            }
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    received routing table, waiting for pings&quot;</span>
               &lt;&lt; endl;
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>-&gt;isScheduled()) {
                cancelEvent(<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
            }
            scheduleAt(simTime() + <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {

            uint32_t nodesPerRow = rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#af92b954e91a51be973c23f77a2aeb96e">getRoutingTableArraySize</a>();
            <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>* stateMsg;

            stateMsg = <span class="keyword">new</span> <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>(<span class="stringliteral">&quot;STATE&quot;</span>);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a25b3219dabfe526aea8c5a1c3a8bed93">setTimestamp</a>(rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#af9884c9961d58688db842f8d614d0ea1">getTimestamp</a>());
            stateMsg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a3fc217f62b60d4208e70416527c0bd83">PASTRY_MSG_STATE</a>);
            stateMsg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a9778899b911fe623a773b4e17974fa65">setSender</a>(rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#a90e0a2d97dbaa39b18705c1f22373723">getSender</a>());
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#ac3f254bf54612f480dde0eef3a1204bf">setLeafSetArraySize</a>(0);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a78bd1834c1a5aa9e80321f55fd3d3cf1">setNeighborhoodSetArraySize</a>(0);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a1432ce9c20f9ef89f14fa3fb1384d3f3">setRoutingTableArraySize</a>(nodesPerRow);

            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; nodesPerRow; i++) {
                stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a39a51998a0a91267bc76978c6d5c65cf">setRoutingTable</a>(i, rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#a74f561d0fede6f8f03d55af8034ed9ac">getRoutingTable</a>(i));
            }

            <a class="code" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9" title="processes state messages, merging with own state tables">handleStateMessage</a>(stateMsg);
        }

        <span class="keyword">delete</span> rtmsg;
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00ab425e857aeb7247b770716d6038fc527">PASTRY_MSG_REQ</a>: {
        <a class="code" href="classPastryRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRequestMessage</a>* lrmsg =
            check_and_cast&lt;<a class="code" href="classPastryRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRequestMessage</a>*&gt;(pastryMsg);
        <a class="code" href="classBasePastry.html#aad40d59a6828e343b9f8b64b702128fb" title="processes state messages, merging with own state tables">handleRequestMessage</a>(lrmsg);
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a3fc217f62b60d4208e70416527c0bd83">PASTRY_MSG_STATE</a>: {
        <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>* stateMsg =
            check_and_cast&lt;<a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>*&gt;(msg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26fa765c1f23635923477bc300637c4f">stateReceived</a>++; <a class="code" href="classBasePastry.html#a8783f5db146cf00be3a347e92c36505e">stateBytesReceived</a> +=
                     stateMsg-&gt;getByteLength());
        <a class="code" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9" title="processes state messages, merging with own state tables">handleStateMessage</a>(stateMsg);
    }
    <span class="keywordflow">break</span>;
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="afe58f82e796e3f1ad6cc736fed856e3c"></a><!-- doxytag: member="Pastry::initializeOverlay" ref="afe58f82e796e3f1ad6cc736fed856e3c" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00080">80</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ( stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a> )
        <span class="keywordflow">return</span>;

    <span class="comment">// Pastry provides KBR services</span>
    <a class="code" href="classBaseOverlay.html#a53389ea3326d2e8ad53f02b388487d0b" title="set this to true, if the overlay provides KBR services">kbr</a> = <span class="keyword">true</span>;

    <a class="code" href="classBasePastry.html#a0bc39902de2d03ea45714bf8506d983f" title="initializes parameters and variables used in both Bamboo and Pastry">baseInit</a>();

    <a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> = par(<span class="stringliteral">&quot;useDiscovery&quot;</span>);
    <a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> = par(<span class="stringliteral">&quot;pingBeforeSecondStage&quot;</span>);
    <a class="code" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a> = par(<span class="stringliteral">&quot;secondStageWait&quot;</span>);
    <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a> = par(<span class="stringliteral">&quot;discoveryTimeoutAmount&quot;</span>);
    <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> = par(<span class="stringliteral">&quot;routingTableMaintenanceInterval&quot;</span>);
    <a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a> = par(<span class="stringliteral">&quot;sendStateAtLeafsetRepair&quot;</span>);
    <a class="code" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">partialJoinPath</a> = par(<span class="stringliteral">&quot;partialJoinPath&quot;</span>);
    <a class="code" href="classBasePastry.html#a98b0c284102cd5f1fc78558937b9b19f">readyWaitAmount</a> = par(<span class="stringliteral">&quot;readyWait&quot;</span>);
    <a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> = par(<span class="stringliteral">&quot;minimalJoinState&quot;</span>);

    <a class="code" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">overrideOldPastry</a> = par(<span class="stringliteral">&quot;overrideOldPastry&quot;</span>);
    <a class="code" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">overrideNewPastry</a> = par(<span class="stringliteral">&quot;overrideNewPastry&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">overrideOldPastry</a>) {
        <span class="comment">//useSecondStage = true;</span>
        <span class="comment">//secondStageInterval = ???;</span>
        <a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> = <span class="keyword">false</span>;
        <a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a> = <span class="keyword">true</span>;
        <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> = 0;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">overrideNewPastry</a>) {
        <span class="comment">//useSecondStage = false;</span>
        <a class="code" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a> = 0;
        <a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> = <span class="keyword">true</span>;
        <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a> = 0.4;
        <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> = 60;
        <a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a> = <span class="keyword">false</span>;
    }

    <a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;joinTimeout&quot;</span>);
    <a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;readyWait&quot;</span>);
    <a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;secondStageWait&quot;</span>);
    <a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;joinUpdateWait&quot;</span>);

    <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a> =
        (<a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> ? <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;discoveryTimeout&quot;</span>) : NULL);
    <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a> =
        ((<a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> &gt; 0) ?
                <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;repairTaskTimeout&quot;</span>) : NULL);

    <a class="code" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">updateCounter</a> = 0;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac202a93b3945381918d13b92060ff1da"></a><!-- doxytag: member="Pastry::iterativeJoinHook" ref="ac202a93b3945381918d13b92060ff1da" args="(BaseOverlayMessage *msg, bool incrHopCount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::iterativeJoinHook </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>incrHopCount</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBasePastry.html#a49e37d403457478acc0d352904bf104d">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00591">591</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastryFindNodeExtData.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryFindNodeExtData</a>* findNodeExt = NULL;
    <span class="keywordflow">if</span> (msg &amp;&amp; msg-&gt;hasObject(<span class="stringliteral">&quot;findNodeExt&quot;</span>)) {
        findNodeExt =
            check_and_cast&lt;<a class="code" href="classPastryFindNodeExtData.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryFindNodeExtData</a>*&gt;(msg-&gt;
                    getObject(<span class="stringliteral">&quot;findNodeExt&quot;</span>));
    }
    <span class="comment">// Send state tables on any JOIN message we see:</span>
    <span class="keywordflow">if</span> (findNodeExt) {
        <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; stateRecipient =
            findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#aaf18e8721a60306f069d795e9ac56f85">getSendStateTo</a>();
        <span class="keywordflow">if</span> (!stateRecipient.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#abfe72c7d75708d9e152375ecb708ce24">joinSeen</a>++);
            <a class="code" href="classBasePastry.html#a30a432a8117a6fd6d42f297f7c7113b3" title="send a PastryStateMessage directly to a node">sendStateTables</a>(stateRecipient,
                            <a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> ?
                            <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7abfbb059d5d48ab5c68f49eb88464171d">PASTRY_STATE_MINJOIN</a> : <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a2ca6c13943a398b19f55c7d53529ab4f">PASTRY_STATE_JOIN</a>,
                            findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#a5b743f86dd249729d371f1a5c5e890a5">getJoinHopCount</a>(), <span class="keyword">false</span>);
        }
        <span class="keywordflow">if</span> (incrHopCount) {
            findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#a1aa6c83e9fcd10444ebe94d798c80a7a">setJoinHopCount</a>(findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#a5b743f86dd249729d371f1a5c5e890a5">getJoinHopCount</a>() + 1);
        }
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a06fbfdc4446ac0cfe149eadbb6e59962"></a><!-- doxytag: member="Pastry::joinOverlay" ref="a06fbfdc4446ac0cfe149eadbb6e59962" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::joinOverlay </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00134">134</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l01071">handleStateMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>);

    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <span class="comment">// no existing pastry network -&gt; first node of a new one</span>
        <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
    } <span class="keywordflow">else</span> {
        <span class="comment">// join existing pastry network</span>
        <a class="code" href="classBasePastry.html#aaa36dc41f21d16f4e7a03e92911c17ab">nearNode</a> = <a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>;
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a>) <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="BasePastry_8h.html#a368457fbb93f1eed641b33da5a87856a">DISCOVERY</a>);
        <span class="keywordflow">else</span> <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a38e3a1a5d04f570e8361b64ea59f1915"></a><!-- doxytag: member="Pastry::mergeState" ref="a38e3a1a5d04f570e8361b64ea59f1915" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Pastry::mergeState </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00975">975</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l01071">handleStateMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l01296">processState()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) {
        <span class="comment">// building initial state</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    [JOIN] starting to build own state from &quot;</span>
               &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; <span class="stringliteral">&quot; received state messages...&quot;</span>
               &lt;&lt; endl;
        }
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> &amp;&amp;
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a88929cf3d5340cda73e6305c25714788">getNeighborhoodSetArraySize</a>() &gt; 0) {
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    [JOIN] initializing NeighborhoodSet from &quot;</span>
                   &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.front().msg-&gt;getJoinHopCount() &lt;&lt; <span class="stringliteral">&quot;. hop&quot;</span>
                   &lt;&lt; endl;
            }
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.front().msg,
                                             <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.front().prox )) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error initializing own neighborhoodSet&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot; while joining! Restarting ...&quot;</span>
                   &lt;&lt; endl;
                ret = <span class="keyword">false</span>;
            }
        }
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    [JOIN] initializing LeafSet from &quot;</span>
               &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.back().msg-&gt;getJoinHopCount() &lt;&lt; <span class="stringliteral">&quot;. hop&quot;</span>
               &lt;&lt; endl;
        }

        <span class="comment">//assert(!stateCache.msg || stateCache.msg-&gt;getLeafSetArraySize() &gt; 0);</span>

        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.back().msg,
                                 <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.back().prox )) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Error initializing own leafSet while joining!&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot; Restarting ...&quot;</span>
               &lt;&lt; endl;
            <span class="comment">//std::cout &lt;&lt; &quot;Pastry: Error initializing own leafSet while &quot;</span>
            <span class="comment">//                    &quot;joining! Restarting ...&quot; &lt;&lt; std::endl;</span>
            ret = <span class="keyword">false</span>;
        } <span class="keywordflow">else</span> {
            <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        }
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    [JOIN] initializing RoutingTable from all hops&quot;</span>
               &lt;&lt; endl;
        }

        assert(!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> ||
               <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a2abf365a56348d30b99e9733c6905065">getRoutingTableArraySize</a>() &gt; 0);

        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#aa5222c6a0ecd848658dd51b8d93b7fc3" title="initialize table from vector of PastryStateMsgHandles with STATE messages received during JOIN phase...">initStateFromHandleVector</a>(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>)) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Error initializing own routingTable while joining!&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot; Restarting ...&quot;</span>
               &lt;&lt; endl;
            <span class="comment">//std::cout &lt;&lt; &quot;Pastry: Error initializing own routingTable &quot;</span>
            <span class="comment">//             &quot;while joining! Restarting ...&quot; &lt;&lt; std::endl;</span>

            ret = <span class="keyword">false</span>;
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <span class="comment">// merging single state (stateCache.msg)</span>
        <span class="keywordflow">if</span> ((<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a88929cf3d5340cda73e6305c25714788">getNeighborhoodSetArraySize</a>() &gt; 0) &amp;&amp;
            (!<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL))) {
            ret = <span class="keyword">false</span>;
        }
        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL)) {
            ret = <span class="keyword">false</span>;
        } <span class="keywordflow">else</span> {
            <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        }
        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL)) {
            ret = <span class="keyword">false</span>;
        }
    }

    <span class="keywordflow">if</span> (ret) <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
    <span class="keywordflow">return</span> ret;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5d3a97713d0a9653e64d252297d41c15"></a><!-- doxytag: member="Pastry::pingResponse" ref="a5d3a97713d0a9653e64d252297d41c15" args="(PingResponse *pingResponse, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::pingResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPingResponse.html">PingResponse</a> *&nbsp;</td>
          <td class="paramname"> <em>pingResponse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&nbsp;</td>
          <td class="paramname"> <em>rtt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBasePastry.html#a21405811849fbb5c83f9ce6227457b11">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00221">221</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="BasePastry_8h.html#a368457fbb93f1eed641b33da5a87856a">DISCOVERY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::pingResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Pong (or Ping-context from NeighborCache) received (from &quot;</span>
           &lt;&lt; pingResponse-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot;) in DISCOVERY mode&quot;</span>
           &lt;&lt; endl;

        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a715b166d2b3b397e047908f52f354be7">nearNodeRtt</a> &gt; rtt) {
            <a class="code" href="classBasePastry.html#aaa36dc41f21d16f4e7a03e92911c17ab">nearNode</a> = pingResponse-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>();
            <a class="code" href="classBasePastry.html#a715b166d2b3b397e047908f52f354be7">nearNodeRtt</a> = rtt;
            <a class="code" href="classBasePastry.html#a4ac33dcce9d9a383a740d1227cff76aa">nearNodeImproved</a> = <span class="keyword">true</span>;
        }
    } <span class="keywordflow">else</span> {
        <a class="code" href="classPastry.html#a5d3a97713d0a9653e64d252297d41c15">BasePastry::pingResponse</a>(pingResponse, context, rpcId, rtt);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4724884f045c31a5a4a25259981cf7ff"></a><!-- doxytag: member="Pastry::processState" ref="a4724884f045c31a5a4a25259981cf7ff" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::processState </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l01296">1296</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l00650">doSecondStage()</a>, <a class="el" href="Pastry_8cc_source.html#l00944">endProcessingState()</a>, <a class="el" href="Pastry_8cc_source.html#l01071">handleStateMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a> &amp;&amp; (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> ||
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == PASTRY_STATE_STD)) {
        <a class="code" href="classBasePastry.html#a445a74a2791f810975bf99b4ff7d9865" title="ping all nodes in the pastry state message pointed to by private member stateCache">pingNodes</a>();
    } <span class="keywordflow">else</span> {
        <a class="code" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a>();
        <a class="code" href="classPastry.html#a4a681c9a40631e27cdb8a174ce8e2618">endProcessingState</a>();
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8899e17ebdaf922877b308b6e6408feb"></a><!-- doxytag: member="Pastry::purgeVectors" ref="a8899e17ebdaf922877b308b6e6408feb" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::purgeVectors </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete all information/messages caching vectors, used for restarting overlay or <a class="el" href="classBaseOverlay.html#aed7e3f36b2c70cbdb0e6daa32925917c" title="collects statistical data">finish()</a> </p>

<p>Reimplemented from <a class="el" href="classBasePastry.html#a72cdd5dde4fe7886068ebc35b4d96cea">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00073">73</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastry.html#ace3cd9ad6803c901a4de28d17f960d86">clearVectors</a>();

    <a class="code" href="classPastry.html#a8899e17ebdaf922877b308b6e6408feb" title="delete all information/messages caching vectors, used for restarting overlay or finish()">BasePastry::purgeVectors</a>();
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab467d712a7a56dece193bce66bd635d6"></a><!-- doxytag: member="Pastry::recursiveRoutingHook" ref="ab467d712a7a56dece193bce66bd635d6" args="(const TransportAddress &amp;dest, BaseRouteMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Pastry::recursiveRoutingHook </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseRouteMessage.html">BaseRouteMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00562">562</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (dest == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <a class="code" href="classPastryMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryMessage</a>* pmsg =
        <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classPastryMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryMessage</a>*<span class="keyword">&gt;</span>(msg-&gt;getEncapsulatedPacket());

    <span class="keywordflow">if</span> (pmsg &amp;&amp; pmsg-&gt;<a class="code" href="classPastryMessage.html#a9e66d5e8500b6ad714cbbe3fa2078d73">getPastryMsgType</a>() == PASTRY_MSG_JOIN) {
        <a class="code" href="classPastryJoinMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinMessage</a>* jmsg = <span class="keyword">static_cast&lt;</span><a class="code" href="classPastryJoinMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinMessage</a>*<span class="keyword">&gt;</span>(pmsg);
        <span class="keywordflow">if</span> (jmsg-&gt;<a class="code" href="classPastryJoinMessage.html#a30282b3d0a1413406fa4520c4df53a3f">getSendStateTo</a>() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#abfe72c7d75708d9e152375ecb708ce24">joinSeen</a>++; <a class="code" href="classBasePastry.html#a8fb058e1e4991c923faf29ae72832c05">joinBytesSeen</a> += jmsg-&gt;getByteLength());
            <span class="comment">// remove node from state if it is rejoining</span>
            <a class="code" href="classPastry.html#ad94a0f122fe78b1b0002735ce19fea84" title="notifies leafset and routingtable of a failed node and sends out a repair request if possible...">handleFailedNode</a>(jmsg-&gt;<a class="code" href="classPastryJoinMessage.html#a30282b3d0a1413406fa4520c4df53a3f">getSendStateTo</a>());

            <a class="code" href="classBasePastry.html#a30a432a8117a6fd6d42f297f7c7113b3" title="send a PastryStateMessage directly to a node">sendStateTables</a>(jmsg-&gt;<a class="code" href="classPastryJoinMessage.html#a30282b3d0a1413406fa4520c4df53a3f">getSendStateTo</a>(),
                            <a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> ?
                            <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7abfbb059d5d48ab5c68f49eb88464171d">PASTRY_STATE_MINJOIN</a> : PASTRY_STATE_JOIN,
                            check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(msg-&gt;getControlInfo())
                            -&gt;getHopCount(), <span class="keyword">false</span>);
        }
    }

    <span class="comment">// forward now:</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aed663ddfc74b4fa5dee232eacd9325fd"></a><!-- doxytag: member="Pastry::depth" ref="aed663ddfc74b4fa5dee232eacd9325fd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">Pastry::depth</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00110">110</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, and <a class="el" href="Pastry_8cc_source.html#l00325">handleUDPMessage()</a>.</p>

</div>
</div>
<a class="anchor" id="af876bfc5832efcc74946fc92f468ebe9"></a><!-- doxytag: member="Pastry::discoveryTimeout" ref="af876bfc5832efcc74946fc92f468ebe9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">Pastry::discoveryTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00125">125</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00325">handleUDPMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00041">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="a533318cca6e80d30c0ef723282331e5a"></a><!-- doxytag: member="Pastry::discoveryTimeoutAmount" ref="a533318cca6e80d30c0ef723282331e5a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">Pastry::discoveryTimeoutAmount</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00107">107</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00325">handleUDPMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="af5d645f87337b64a2ce04e994d3436e7"></a><!-- doxytag: member="Pastry::minimalJoinState" ref="af5d645f87337b64a2ce04e994d3436e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">Pastry::minimalJoinState</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00114">114</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00325">handleUDPMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>, <a class="el" href="Pastry_8cc_source.html#l00591">iterativeJoinHook()</a>, and <a class="el" href="Pastry_8cc_source.html#l00562">recursiveRoutingHook()</a>.</p>

</div>
</div>
<a class="anchor" id="abaf6ee84a60273e509e713fabe4b25e3"></a><!-- doxytag: member="Pastry::notifyList" ref="abaf6ee84a60273e509e713fabe4b25e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classTransportAddress.html">TransportAddress</a>&gt; <a class="el" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3">Pastry::notifyList</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>List of nodes to notify after join. </p>

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00099">99</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00053">clearVectors()</a>, <a class="el" href="Pastry_8cc_source.html#l00617">doJoinUpdate()</a>, and <a class="el" href="Pastry_8cc_source.html#l00650">doSecondStage()</a>.</p>

</div>
</div>
<a class="anchor" id="a5a7acb21ccf23165142efa88bae71e52"></a><!-- doxytag: member="Pastry::overrideNewPastry" ref="a5a7acb21ccf23165142efa88bae71e52" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">Pastry::overrideNewPastry</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00121">121</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="af80b068d6f88b70026caa7e5b2637b62"></a><!-- doxytag: member="Pastry::overrideOldPastry" ref="af80b068d6f88b70026caa7e5b2637b62" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">Pastry::overrideOldPastry</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00120">120</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a6531029cc05c41c94976078bf0abd93a"></a><!-- doxytag: member="Pastry::partialJoinPath" ref="a6531029cc05c41c94976078bf0abd93a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">Pastry::partialJoinPath</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00108">108</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, and <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a5c93eb479cbc43a00cb0886c3eb5b452"></a><!-- doxytag: member="Pastry::pingBeforeSecondStage" ref="a5c93eb479cbc43a00cb0886c3eb5b452" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">Pastry::pingBeforeSecondStage</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00118">118</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l01071">handleStateMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l01296">processState()</a>.</p>

</div>
</div>
<a class="anchor" id="a997e3c2755fb3dee24fe9142a4e5c08c"></a><!-- doxytag: member="Pastry::repairTaskTimeout" ref="a997e3c2755fb3dee24fe9142a4e5c08c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">Pastry::repairTaskTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00126">126</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00041">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="aca67080bf2f219f3c1cd2eca39188aba"></a><!-- doxytag: member="Pastry::ringCheck" ref="aca67080bf2f219f3c1cd2eca39188aba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#aca67080bf2f219f3c1cd2eca39188aba">Pastry::ringCheck</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00124">124</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

</div>
</div>
<a class="anchor" id="a252d835018fef1273f54e1dba733daf5"></a><!-- doxytag: member="Pastry::routingTableMaintenanceInterval" ref="a252d835018fef1273f54e1dba733daf5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">Pastry::routingTableMaintenanceInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00106">106</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00041">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="a8bfec13ef53de9a9e938549f55d31355"></a><!-- doxytag: member="Pastry::secondStageInterval" ref="a8bfec13ef53de9a9e938549f55d31355" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">Pastry::secondStageInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00105">105</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>, and <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a6dfb09590ce5a63c21f6cbf7e2153e3d"></a><!-- doxytag: member="Pastry::secondStageWait" ref="a6dfb09590ce5a63c21f6cbf7e2153e3d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">Pastry::secondStageWait</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00123">123</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00149">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00041">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="a697f91ef2bdef3df33c45755f3973d0e"></a><!-- doxytag: member="Pastry::sendStateAtLeafsetRepair" ref="a697f91ef2bdef3df33c45755f3973d0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">Pastry::sendStateAtLeafsetRepair</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00117">117</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00725">handleFailedNode()</a>, and <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a124da5018df353375c1b1b3af057c646"></a><!-- doxytag: member="Pastry::stReceived" ref="a124da5018df353375c1b1b3af057c646" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a>&gt; <a class="el" href="classPastry.html#a124da5018df353375c1b1b3af057c646">Pastry::stReceived</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State messages to process during join. </p>

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00093">93</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l00053">clearVectors()</a>, <a class="el" href="Pastry_8cc_source.html#l00617">doJoinUpdate()</a>, <a class="el" href="Pastry_8cc_source.html#l01071">handleStateMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>, and <a class="el" href="Pastry_8cc_source.html#l00975">mergeState()</a>.</p>

</div>
</div>
<a class="anchor" id="a39e21bad6ac44591dd04dd5cb69e0d69"></a><!-- doxytag: member="Pastry::stReceivedPos" ref="a39e21bad6ac44591dd04dd5cb69e0d69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a>&gt;::iterator <a class="el" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">Pastry::stReceivedPos</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00094">94</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l00053">clearVectors()</a>, <a class="el" href="Pastry_8cc_source.html#l01071">handleStateMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l00243">handleTimerEvent()</a>.</p>

</div>
</div>
<a class="anchor" id="ab6abf133583dc4f91ae74fcb7ad2d188"></a><!-- doxytag: member="Pastry::updateCounter" ref="ab6abf133583dc4f91ae74fcb7ad2d188" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">Pastry::updateCounter</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00112">112</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00765">checkProxCache()</a>, and <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a51ea6ebb7a60392699bf04a2f0b37309"></a><!-- doxytag: member="Pastry::useDiscovery" ref="a51ea6ebb7a60392699bf04a2f0b37309" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">Pastry::useDiscovery</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00115">115</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00080">initializeOverlay()</a>, <a class="el" href="Pastry_8cc_source.html#l00134">joinOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00041">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="a76def04af940e240a50c48e6040cee2b"></a><!-- doxytag: member="Pastry::useSecondStage" ref="a76def04af940e240a50c48e6040cee2b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">Pastry::useSecondStage</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00116">116</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Pastry_8h_source.html">Pastry.h</a></li>
<li><a class="el" href="Pastry_8cc_source.html">Pastry.cc</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 3 2010 14:40:53 for OverSim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
