<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: CoordBasedRouting Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a>  </div>
  <div class="headertitle">
<h1>CoordBasedRouting Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="CoordBasedRouting" -->
<p><code>#include &lt;<a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>&gt;</code></p>

<p><a href="classCoordBasedRouting-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classOverlayKey.html">OverlayKey</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a9ff382ebaca0bb0ddcdf8ffe72ffb9e3">getNodeId</a> (const std::vector&lt; double &gt; &amp;coords, uint8_t bpd, uint8_t length) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns a NodeID with given length and prefix according to coords' area.  <a href="#a9ff382ebaca0bb0ddcdf8ffe72ffb9e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a1d7363dbdbee2b273a6f9790d28787da">getXmlDimensions</a> () const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns the number of dimensions set in the XML file.  <a href="#a1d7363dbdbee2b273a6f9790d28787da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a115b1a076104e006153c1f4731fb14ae">getEuclidianDistanceByKeyAndCoords</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;destKey, const std::vector&lt; double &gt; &amp;nodeCoords, uint8_t bpd) const </td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#ae310b8a24558c2e9721d537290da5e54">initialize</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CBR is a global module, stuff in <a class="el" href="classCoordBasedRouting.html#ae310b8a24558c2e9721d537290da5e54" title="CBR is a global module, stuff in initialize() is run once Parsing the area source XML is done here...">initialize()</a> is run once Parsing the area source XML is done here.  <a href="#ae310b8a24558c2e9721d537290da5e54"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#ae76313d5ae65847210f94c7d50ea1e64">finish</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a2c9af7d1772146c4178ff2c42acb00d1">parseSource</a> (const char *<a class="el" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">areaCoordinateSource</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parses the area source XML and puts the resulting areas into CBRAreaPool  <a href="#a2c9af7d1772146c4178ff2c42acb00d1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#ae817378864b314e627b2ecca0b3efd2c">getPrefix</a> (const std::vector&lt; double &gt; &amp;coords) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">auxiliary protected function which returns the NodeID prefix of the given coords' area  <a href="#ae817378864b314e627b2ecca0b3efd2c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#ac1e8cf34e365f1420961a07781b4e6a8">checkDimensions</a> (uint8_t dims) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns if given coords' dimensions value (from underlay or overlay calculations) is matching the dimensions value in the area source XML.  <a href="#ac1e8cf34e365f1420961a07781b4e6a8"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">areaCoordinateSource</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a22f2f5908dc2b57f7b9068b3e3dda4cb">cbrStartAtDigit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a63ac320296df233c2e112b0d5e2f6b42">cbrStopAtDigit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#af51af23d320288f9b8b4ca462c4ae888">xmlDimensions</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classCBRArea.html">CBRArea</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classGlobalNodeList.html">GlobalNodeList</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a9d9f09afbb18729640202c4534f40baa">globalNodeList</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoordBasedRouting.html#a2af647718fab79686a441bba1d9145ba">NOPREFIX</a> = &quot;NOPREFIX&quot;</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00050">50</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ac1e8cf34e365f1420961a07781b4e6a8"></a><!-- doxytag: member="CoordBasedRouting::checkDimensions" ref="ac1e8cf34e365f1420961a07781b4e6a8" args="(uint8_t dims) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CoordBasedRouting::checkDimensions </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>dims</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>returns if given coords' dimensions value (from underlay or overlay calculations) is matching the dimensions value in the area source XML. </p>
<p>This is mandatory for correct mapping results! </p>

<p>Definition at line <a class="el" href="CoordBasedRouting_8cc_source.html#l00248">248</a> of file <a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00169">getPrefix()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (dims == <a class="code" href="classCoordBasedRouting.html#af51af23d320288f9b8b4ca462c4ae888">xmlDimensions</a>) {
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    } <span class="keywordflow">else</span> {
        EV &lt;&lt; <span class="stringliteral">&quot;[CoordBasedRouting::checkDimensions()]&quot;</span> &lt;&lt; endl;
        EV &lt;&lt; <span class="stringliteral">&quot;    ERROR: Given coordinate dimensions do not match dimensions &quot;</span>
              <span class="stringliteral">&quot;in the used area source file. Mapping results will be wrong.&quot;</span>
           &lt;&lt; endl;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae76313d5ae65847210f94c7d50ea1e64"></a><!-- doxytag: member="CoordBasedRouting::finish" ref="ae76313d5ae65847210f94c7d50ea1e64" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CoordBasedRouting::finish </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8cc_source.html#l00065">65</a> of file <a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>.size(); i++) {
        <span class="keyword">delete</span> <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>[i];
    }
    <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>.clear();
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a115b1a076104e006153c1f4731fb14ae"></a><!-- doxytag: member="CoordBasedRouting::getEuclidianDistanceByKeyAndCoords" ref="a115b1a076104e006153c1f4731fb14ae" args="(const OverlayKey &amp;destKey, const std::vector&lt; double &gt; &amp;nodeCoords, uint8_t bpd) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double CoordBasedRouting::getEuclidianDistanceByKeyAndCoords </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>destKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>nodeCoords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bpd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8cc_source.html#l00209">209</a> of file <a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    assert(!destKey.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>());
    uint32_t iter = 0;
    <span class="keywordflow">while</span> (iter &lt; <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>.size()) {
        <a class="code" href="classCBRArea.html" title="Auxiliary class for CoordBasedRouting: Holds the min and max border values for each dimension and the...">CBRArea</a>* thisArea = <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>[iter];

        <span class="comment">// Take CBR Start/Stop Digit into account</span>
        uint8_t startbit = bpd * <a class="code" href="classCoordBasedRouting.html#a22f2f5908dc2b57f7b9068b3e3dda4cb">cbrStartAtDigit</a>;
        uint8_t length = (bpd * <a class="code" href="classCoordBasedRouting.html#a63ac320296df233c2e112b0d5e2f6b42">cbrStopAtDigit</a> - bpd * cbrStartAtDigit &lt;
                (uint8_t)thisArea-&gt;<a class="code" href="classCBRArea.html#a5f503d527d8664fecc1d3299be858655">prefix</a>.length() - bpd * cbrStartAtDigit)
                ? (bpd * <a class="code" href="classCoordBasedRouting.html#a63ac320296df233c2e112b0d5e2f6b42">cbrStopAtDigit</a> - bpd * cbrStartAtDigit)
                : (thisArea-&gt;<a class="code" href="classCBRArea.html#a5f503d527d8664fecc1d3299be858655">prefix</a>.length() - bpd * cbrStartAtDigit);
        <span class="keywordflow">if</span> (destKey.<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(2).substr(startbit, length) ==
            thisArea-&gt;<a class="code" href="classCBRArea.html#a5f503d527d8664fecc1d3299be858655">prefix</a>.substr(startbit, length)) {
            <span class="comment">// Get euclidian distance of area center to given coords</span>
            std::vector&lt;double&gt; areaCenterCoords;
            areaCenterCoords.resize(<a class="code" href="classCoordBasedRouting.html#a1d7363dbdbee2b273a6f9790d28787da" title="returns the number of dimensions set in the XML file.">getXmlDimensions</a>());
            <span class="keywordtype">double</span> sumofsquares = 0;
            <span class="keywordflow">for</span> (uint8_t dim = 0; dim &lt; <a class="code" href="classCoordBasedRouting.html#a1d7363dbdbee2b273a6f9790d28787da" title="returns the number of dimensions set in the XML file.">getXmlDimensions</a>(); dim++) {
                areaCenterCoords[dim] =
                    (thisArea-&gt;<a class="code" href="classCBRArea.html#a19b0e67ef2201fe1127397d0c1a93d3b">min</a>[dim] + thisArea-&gt;<a class="code" href="classCBRArea.html#acb892de6a4761563d45e2a8077c20d2a">max</a>[dim]) / 2;
                sumofsquares += pow((coords[dim] - areaCenterCoords[dim]), 2);
            }
            <span class="keywordflow">return</span> sqrt(sumofsquares);
        }
        iter++;
    }
    <span class="comment">// while loop finished -&gt; no area with needed prefix found</span>
    <span class="comment">// (this shouldn&#39;t happen!)</span>
    <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;[CoordBasedRouting::&quot;</span>
                        <span class="stringliteral">&quot;getEuclidianDistanceByKeyAndCoords]: &quot;</span>
                        <span class="stringliteral">&quot;No prefix for search key found!&quot;</span>);
    <span class="keywordflow">return</span> -1;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9ff382ebaca0bb0ddcdf8ffe72ffb9e3"></a><!-- doxytag: member="CoordBasedRouting::getNodeId" ref="a9ff382ebaca0bb0ddcdf8ffe72ffb9e3" args="(const std::vector&lt; double &gt; &amp;coords, uint8_t bpd, uint8_t length) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classOverlayKey.html">OverlayKey</a> CoordBasedRouting::getNodeId </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>coords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bpd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>returns a NodeID with given length and prefix according to coords' area. </p>
<p>Takes the parameters CBRstartAtDigit and CBRstopAtDigit into account. Non-prefix bits are currently randomized. </p>

<p>Definition at line <a class="el" href="CoordBasedRouting_8cc_source.html#l00109">109</a> of file <a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a>.</p>

<p>Referenced by <a class="el" href="Nps_8cc_source.html#l00207">Nps::coordsReqRpcResponse()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    std::string prefix = <a class="code" href="classCoordBasedRouting.html#ae817378864b314e627b2ecca0b3efd2c" title="auxiliary protected function which returns the NodeID prefix of the given coords&amp;#39; area...">getPrefix</a>(coords);

    <span class="comment">// if no prefix is returned, something is seriously wrong with the Area Source XML</span>
    <span class="keywordflow">if</span> (prefix == <a class="code" href="classCoordBasedRouting.html#a2af647718fab79686a441bba1d9145ba">NOPREFIX</a>) {
        opp_error(<span class="stringliteral">&quot;[CoordBasedRouting::getNodeId()]: &quot;</span>
                  <span class="stringliteral">&quot;No prefix for given coords found. &quot;</span>
                  <span class="stringliteral">&quot;Check your area source file!&quot;</span>);
    }
    std::string idString;

    <span class="comment">// ID string:</span>
    <span class="comment">//                          |- endPos</span>
    <span class="comment">// 00000000000000011010101010000000000000</span>
    <span class="comment">// |_startLength_||_prefix_||_endLength_|</span>
    <span class="comment">// |__  .. beforeEnd ..  __|</span>
    <span class="comment">// |___        .... length ....      ___|</span>
    <span class="comment">//</span>
    <span class="comment">// startLength and endLength bits are set to 0 at first, then</span>
    <span class="comment">// randomized</span>
    <span class="comment">// Prefix will be cut off if stop digit is exceeded</span>

    uint8_t startLength = (bpd * <a class="code" href="classCoordBasedRouting.html#a22f2f5908dc2b57f7b9068b3e3dda4cb">cbrStartAtDigit</a> &lt; length) ?
                          (bpd * <a class="code" href="classCoordBasedRouting.html#a22f2f5908dc2b57f7b9068b3e3dda4cb">cbrStartAtDigit</a>) : length;
    uint8_t beforeEnd = (startLength + prefix.length() &lt; length) ?
                        (startLength + prefix.length()) : length;
    uint8_t endPos = (bpd * <a class="code" href="classCoordBasedRouting.html#a63ac320296df233c2e112b0d5e2f6b42">cbrStopAtDigit</a> &lt; beforeEnd) ?
                     (bpd * <a class="code" href="classCoordBasedRouting.html#a63ac320296df233c2e112b0d5e2f6b42">cbrStopAtDigit</a>) : beforeEnd;
    uint8_t endLength = length - endPos;

    <span class="comment">// Fill startLength bits with zeros</span>
    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; startLength; i++)
        idString += <span class="stringliteral">&quot;0&quot;</span>;

    <span class="comment">// Now add prefix and cut it off if stop digit and/or key length is exceeded</span>
    idString += prefix;
    <span class="keywordflow">if</span> (endPos &lt; idString.length())
        idString.erase(endPos);
    <span class="keywordflow">if</span> (length &lt; idString.length())
        idString.erase(length);

    <span class="comment">// fill endLength bits with zeros, thus key length is reached</span>
    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; endLength; i++)
        idString += <span class="stringliteral">&quot;0&quot;</span>;

    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> nodeId(idString, 2);

    <span class="comment">// randomize non-prefix (zero filled) parts</span>
    <span class="keywordflow">if</span> (startLength &gt; 0)
        nodeId = nodeId.randomPrefix(length - startLength);
    <span class="keywordflow">if</span> (endLength &gt; 0)
        nodeId = nodeId.randomSuffix(endLength);

    EV &lt;&lt; <span class="stringliteral">&quot;[CoordBasedRouting::getNodeId()]\n&quot;</span>
       &lt;&lt;<span class="stringliteral">&quot;    calculated id: &quot;</span> &lt;&lt; nodeId &lt;&lt; endl;
    <span class="keywordflow">return</span> nodeId;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae817378864b314e627b2ecca0b3efd2c"></a><!-- doxytag: member="CoordBasedRouting::getPrefix" ref="ae817378864b314e627b2ecca0b3efd2c" args="(const std::vector&lt; double &gt; &amp;coords) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string CoordBasedRouting::getPrefix </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>coords</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>auxiliary protected function which returns the NodeID prefix of the given coords' area </p>

<p>Definition at line <a class="el" href="CoordBasedRouting_8cc_source.html#l00169">169</a> of file <a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00109">getNodeId()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> areaFound = <span class="keyword">false</span>;
    uint32_t iter = 0;

    <span class="comment">// Return no prefix if coords dimensions don&#39;t match area file dimensions</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classCoordBasedRouting.html#ac1e8cf34e365f1420961a07781b4e6a8" title="returns if given coords&amp;#39; dimensions value (from underlay or overlay calculations) is matching the...">checkDimensions</a>(coords.size()))
        <span class="keywordflow">return</span> <a class="code" href="classCoordBasedRouting.html#a2af647718fab79686a441bba1d9145ba">NOPREFIX</a>;

    <span class="keywordflow">while</span> (!areaFound &amp;&amp; iter &lt; <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>.size()) {
        <a class="code" href="classCBRArea.html" title="Auxiliary class for CoordBasedRouting: Holds the min and max border values for each dimension and the...">CBRArea</a>* thisArea = <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>[iter];

        <span class="comment">// assume we&#39;re in the correct area unless any dimension tells us otherwise</span>
        areaFound = <span class="keyword">true</span>;
        <span class="keywordflow">for</span> (uint8_t thisdim = 0; thisdim &lt; coords.size(); thisdim++) {
            <span class="keywordflow">if</span> (coords[thisdim] &lt; thisArea-&gt;<a class="code" href="classCBRArea.html#a19b0e67ef2201fe1127397d0c1a93d3b">min</a>[thisdim] ||
                coords[thisdim] &gt; thisArea-&gt;<a class="code" href="classCBRArea.html#acb892de6a4761563d45e2a8077c20d2a">max</a>[thisdim]) {
                areaFound = <span class="keyword">false</span>;
                <span class="keywordflow">break</span>;
            }
        }

        <span class="comment">// no borders are broken in any dimension -&gt; we&#39;re in the correct area,</span>
        <span class="comment">// return corresponding prefix</span>
        <span class="keywordflow">if</span> (areaFound) {
            EV &lt;&lt; <span class="stringliteral">&quot;[CoordBasedRouting::getPrefix()]\n&quot;</span>
               &lt;&lt;<span class="stringliteral">&quot;    calculated prefix: &quot;</span> &lt;&lt; thisArea-&gt;<a class="code" href="classCBRArea.html#a5f503d527d8664fecc1d3299be858655">prefix</a> &lt;&lt; endl;
            <span class="keywordflow">return</span> thisArea-&gt;<a class="code" href="classCBRArea.html#a5f503d527d8664fecc1d3299be858655">prefix</a>;
        }
        iter++;
    }

    <span class="comment">// no corresponding prefix found, XML file broken?</span>
    EV &lt;&lt; <span class="stringliteral">&quot;[CoordBasedRouting::getPrefix()]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    No corresponding prefix found, check your area source file!&quot;</span>
       &lt;&lt; endl;

    <span class="keywordflow">return</span> <a class="code" href="classCoordBasedRouting.html#a2af647718fab79686a441bba1d9145ba">NOPREFIX</a>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d7363dbdbee2b273a6f9790d28787da"></a><!-- doxytag: member="CoordBasedRouting::getXmlDimensions" ref="a1d7363dbdbee2b273a6f9790d28787da" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t CoordBasedRouting::getXmlDimensions </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>returns the number of dimensions set in the XML file. </p>
<p>Can be strictly regarded as reference whenever it comes to dimensionality </p>

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00094">94</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00209">getEuclidianDistanceByKeyAndCoords()</a>.</p>

<p><div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="classCoordBasedRouting.html#af51af23d320288f9b8b4ca462c4ae888">xmlDimensions</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae310b8a24558c2e9721d537290da5e54"></a><!-- doxytag: member="CoordBasedRouting::initialize" ref="ae310b8a24558c2e9721d537290da5e54" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CoordBasedRouting::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CBR is a global module, stuff in <a class="el" href="classCoordBasedRouting.html#ae310b8a24558c2e9721d537290da5e54" title="CBR is a global module, stuff in initialize() is run once Parsing the area source XML is done here...">initialize()</a> is run once Parsing the area source XML is done here. </p>

<p>Definition at line <a class="el" href="CoordBasedRouting_8cc_source.html#l00041">41</a> of file <a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">areaCoordinateSource</a> = par(<span class="stringliteral">&quot;areaCoordinateSource&quot;</span>);
    <a class="code" href="classCoordBasedRouting.html#a22f2f5908dc2b57f7b9068b3e3dda4cb">cbrStartAtDigit</a> = par(<span class="stringliteral">&quot;CBRstartAtDigit&quot;</span>);
    <a class="code" href="classCoordBasedRouting.html#a63ac320296df233c2e112b0d5e2f6b42">cbrStopAtDigit</a> = par(<span class="stringliteral">&quot;CBRstopAtDigit&quot;</span>);
    <a class="code" href="classCoordBasedRouting.html#a9d9f09afbb18729640202c4534f40baa">globalNodeList</a> = <a class="code" href="classGlobalNodeListAccess.html" title="Gives access to the GlobalNodeList.">GlobalNodeListAccess</a>().get();

    <span class="comment">// XML file found?</span>
    std::ifstream check_for_xml_file(<a class="code" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">areaCoordinateSource</a>);
    <span class="keywordflow">if</span> (!check_for_xml_file) {
        check_for_xml_file.close();
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;CBR area file not found!&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">else</span> {
        EV &lt;&lt; <span class="stringliteral">&quot;[CoordBasedRouting::initialize()]\n    CBR area file &#39;&quot;</span>
           &lt;&lt; <a class="code" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">areaCoordinateSource</a> &lt;&lt; <span class="stringliteral">&quot;&#39; loaded.&quot;</span> &lt;&lt; endl;
        check_for_xml_file.close();
    }

    <span class="comment">// XML file found, let&#39;s parse it</span>
    <a class="code" href="classCoordBasedRouting.html#a2c9af7d1772146c4178ff2c42acb00d1" title="parses the area source XML and puts the resulting areas into CBRAreaPool">parseSource</a>(<a class="code" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">areaCoordinateSource</a>);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2c9af7d1772146c4178ff2c42acb00d1"></a><!-- doxytag: member="CoordBasedRouting::parseSource" ref="a2c9af7d1772146c4178ff2c42acb00d1" args="(const char *areaCoordinateSource)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CoordBasedRouting::parseSource </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>areaCoordinateSource</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parses the area source XML and puts the resulting areas into CBRAreaPool </p>

<p>Definition at line <a class="el" href="CoordBasedRouting_8cc_source.html#l00074">74</a> of file <a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00041">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    cXMLElement* rootElement = ev.getXMLDocument(<a class="code" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">areaCoordinateSource</a>);

    <a class="code" href="classCoordBasedRouting.html#af51af23d320288f9b8b4ca462c4ae888">xmlDimensions</a> = atoi(rootElement-&gt;getAttribute(<span class="stringliteral">&quot;dimensions&quot;</span>));

    <span class="keywordflow">for</span> (cXMLElement *area = rootElement-&gt;getFirstChildWithTag(<span class="stringliteral">&quot;area&quot;</span>); area;
         area = area-&gt;getNextSiblingWithTag(<span class="stringliteral">&quot;area&quot;</span>) ) {
        <a class="code" href="classCBRArea.html" title="Auxiliary class for CoordBasedRouting: Holds the min and max border values for each dimension and the...">CBRArea</a>* tmpArea = <span class="keyword">new</span> <a class="code" href="classCBRArea.html" title="Auxiliary class for CoordBasedRouting: Holds the min and max border values for each dimension and the...">CBRArea</a>(<a class="code" href="classCoordBasedRouting.html#af51af23d320288f9b8b4ca462c4ae888">xmlDimensions</a>);
        <span class="keywordflow">for</span> (cXMLElement *areavals = area-&gt;getFirstChild(); areavals;
             areavals = areavals-&gt;getNextSibling() ) {
            std::string tagname = std::string(areavals-&gt;getTagName());
            <span class="keywordflow">if</span> (tagname == <span class="stringliteral">&quot;min&quot;</span>) {
                uint8_t currentdim = atoi(areavals-&gt;getAttribute(<span class="stringliteral">&quot;dimension&quot;</span>));
                <span class="keywordtype">double</span> value = atof(areavals-&gt;getNodeValue());
                tmpArea-&gt;<a class="code" href="classCBRArea.html#a19b0e67ef2201fe1127397d0c1a93d3b">min</a>[currentdim] = value;
            }

            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tagname == <span class="stringliteral">&quot;max&quot;</span>) {
                uint8_t currentdim = atoi(areavals-&gt;getAttribute(<span class="stringliteral">&quot;dimension&quot;</span>));
                <span class="keywordtype">double</span> value = atof(areavals-&gt;getNodeValue());
                tmpArea-&gt;<a class="code" href="classCBRArea.html#acb892de6a4761563d45e2a8077c20d2a">max</a>[currentdim] = value;
            }

            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tagname == <span class="stringliteral">&quot;prefix&quot;</span>) {
                tmpArea-&gt;<a class="code" href="classCBRArea.html#a5f503d527d8664fecc1d3299be858655">prefix</a> = areavals-&gt;getNodeValue();
            }
        }
        <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>.push_back(tmpArea);
    }

    EV &lt;&lt; <span class="stringliteral">&quot;[CoordBasedRouting::parseSource()]&quot;</span> &lt;&lt; endl;
    EV &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CBRAreaPool</a>.size() &lt;&lt; <span class="stringliteral">&quot; prefix areas detected.&quot;</span> &lt;&lt; endl;
}
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a06d768682c8a5118a973aa8a0bb5b94a"></a><!-- doxytag: member="CoordBasedRouting::areaCoordinateSource" ref="a06d768682c8a5118a973aa8a0bb5b94a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="classCoordBasedRouting.html#a06d768682c8a5118a973aa8a0bb5b94a">CoordBasedRouting::areaCoordinateSource</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00103">103</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00041">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a2f5dcd87db8946cbc23f79c6636216c6"></a><!-- doxytag: member="CoordBasedRouting::CBRAreaPool" ref="a2f5dcd87db8946cbc23f79c6636216c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classCBRArea.html">CBRArea</a>*&gt; <a class="el" href="classCoordBasedRouting.html#a2f5dcd87db8946cbc23f79c6636216c6">CoordBasedRouting::CBRAreaPool</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00108">108</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00065">finish()</a>, <a class="el" href="CoordBasedRouting_8cc_source.html#l00209">getEuclidianDistanceByKeyAndCoords()</a>, <a class="el" href="CoordBasedRouting_8cc_source.html#l00169">getPrefix()</a>, and <a class="el" href="CoordBasedRouting_8cc_source.html#l00074">parseSource()</a>.</p>

</div>
</div>
<a class="anchor" id="a22f2f5908dc2b57f7b9068b3e3dda4cb"></a><!-- doxytag: member="CoordBasedRouting::cbrStartAtDigit" ref="a22f2f5908dc2b57f7b9068b3e3dda4cb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="classCoordBasedRouting.html#a22f2f5908dc2b57f7b9068b3e3dda4cb">CoordBasedRouting::cbrStartAtDigit</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00104">104</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00209">getEuclidianDistanceByKeyAndCoords()</a>, <a class="el" href="CoordBasedRouting_8cc_source.html#l00109">getNodeId()</a>, and <a class="el" href="CoordBasedRouting_8cc_source.html#l00041">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a63ac320296df233c2e112b0d5e2f6b42"></a><!-- doxytag: member="CoordBasedRouting::cbrStopAtDigit" ref="a63ac320296df233c2e112b0d5e2f6b42" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="classCoordBasedRouting.html#a63ac320296df233c2e112b0d5e2f6b42">CoordBasedRouting::cbrStopAtDigit</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00105">105</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00209">getEuclidianDistanceByKeyAndCoords()</a>, <a class="el" href="CoordBasedRouting_8cc_source.html#l00109">getNodeId()</a>, and <a class="el" href="CoordBasedRouting_8cc_source.html#l00041">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a9d9f09afbb18729640202c4534f40baa"></a><!-- doxytag: member="CoordBasedRouting::globalNodeList" ref="a9d9f09afbb18729640202c4534f40baa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classGlobalNodeList.html">GlobalNodeList</a>* <a class="el" href="classCoordBasedRouting.html#a9d9f09afbb18729640202c4534f40baa">CoordBasedRouting::globalNodeList</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00109">109</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00041">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a2af647718fab79686a441bba1d9145ba"></a><!-- doxytag: member="CoordBasedRouting::NOPREFIX" ref="a2af647718fab79686a441bba1d9145ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string <a class="el" href="classCoordBasedRouting.html#a2af647718fab79686a441bba1d9145ba">CoordBasedRouting::NOPREFIX</a> = &quot;NOPREFIX&quot;<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00101">101</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00109">getNodeId()</a>, and <a class="el" href="CoordBasedRouting_8cc_source.html#l00169">getPrefix()</a>.</p>

</div>
</div>
<a class="anchor" id="af51af23d320288f9b8b4ca462c4ae888"></a><!-- doxytag: member="CoordBasedRouting::xmlDimensions" ref="af51af23d320288f9b8b4ca462c4ae888" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="classCoordBasedRouting.html#af51af23d320288f9b8b4ca462c4ae888">CoordBasedRouting::xmlDimensions</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CoordBasedRouting_8h_source.html#l00106">106</a> of file <a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a>.</p>

<p>Referenced by <a class="el" href="CoordBasedRouting_8cc_source.html#l00248">checkDimensions()</a>, <a class="el" href="CoordBasedRouting_8h_source.html#l00094">getXmlDimensions()</a>, and <a class="el" href="CoordBasedRouting_8cc_source.html#l00074">parseSource()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="CoordBasedRouting_8h_source.html">CoordBasedRouting.h</a></li>
<li><a class="el" href="CoordBasedRouting_8cc_source.html">CoordBasedRouting.cc</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 3 2010 14:40:49 for OverSim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
