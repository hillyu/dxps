<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: Bamboo Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<h1>Bamboo Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Bamboo" --><!-- doxytag: inherits="BasePastry,LookupListener" -->
<p><a class="el" href="classBamboo.html" title="Bamboo overlay module.">Bamboo</a> overlay module.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Bamboo:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classBamboo.png" usemap="#Bamboo_map" alt=""/>
  <map id="Bamboo_map" name="Bamboo_map">
<area href="classBasePastry.html" alt="BasePastry" shape="rect" coords="172,168,277,192"/>
<area href="classLookupListener.html" alt="LookupListener" shape="rect" coords="287,168,392,192"/>
<area href="classBaseOverlay.html" alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classProxListener.html" alt="ProxListener" shape="rect" coords="230,112,335,136"/>
<area href="classBaseRpc.html" alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
</div>

<p><a href="classBamboo-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a8e2d71e2abf9ca5e7a1ddbbad5381757">~Bamboo</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a52bd33a4d9a8418e9027284cc74f72d1">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a6d3f0705b1495c225432238094a38cea">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a5448a722d860af66a2cb6479033f3d33">handleUDPMessage</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#af7e2ea2c6f6d654980310005a230f6a3">handleStateMessage</a> (<a class="el" href="classPastryStateMessage.html">PastryStateMessage</a> *msg)</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a37816e3b77076881120a13606d836489">lookupFinished</a> (<a class="el" href="classAbstractLookup.html">AbstractLookup</a> *lookup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#ae987647d2b516c6bcaa1c93257b6be3f">changeState</a> (int toState)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">changes node state  <a href="#ae987647d2b516c6bcaa1c93257b6be3f"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#ab28c657a75980f968defb032f4aa9002">doLeafsetMaintenance</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">periodically repairs the leafset by pushing it to and pulling it from from a random live leafset node  <a href="#ab28c657a75980f968defb032f4aa9002"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a7d9390f517830e44e35e3cd475730724">getNextRowToMaintain</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#acde8e02f731fe1a26a5c21d47ee84188">doLocalTuning</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#acc2e50c06119f74386cc083431f86675">doGlobalTuning</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">periodically repairs the routing table by performing random lookups  <a href="#acc2e50c06119f74386cc083431f86675"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#ac33bbf6ffd5a95bb730ce046f921a335">handleFailedNode</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;failed)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">notifies leafset and routingtable of a failed node and sends out a repair request if possible  <a href="#ac33bbf6ffd5a95bb730ce046f921a335"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a4efad1712615507ca730b86006513d9e">checkProxCache</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">checks whether proxCache is complete, takes appropriate actions depending on the protocol state  <a href="#a4efad1712615507ca730b86006513d9e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a1b8dba4c0d42b0dbf6b6b2a693c6dc29">joinOverlay</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a05f92ae31d195ee37d78f45ab7f5f5bb">leafsetMaintenanceInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a703829a0001a2396b500aff8eb823242">localTuningInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a8a4593a1108a8d18b11799bbbe1c63dc">globalTuningInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">leafsetMaintenanceTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">globalTuningTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">localTuningTimer</a></td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBamboo.html#aefc36fb7b441daba48500acc1fec62d4">BambooLookupListener</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="classBamboo.html" title="Bamboo overlay module.">Bamboo</a> overlay module. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Gerhard Petruschat </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="classBaseOverlay.html" title="Base class for overlays.">BaseOverlay</a> </dd></dl>

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00053">53</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a8e2d71e2abf9ca5e7a1ddbbad5381757"></a><!-- doxytag: member="Bamboo::~Bamboo" ref="a8e2d71e2abf9ca5e7a1ddbbad5381757" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bamboo::~Bamboo </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00040">40</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// destroy self timer messages</span>
    cancelAndDelete(<a class="code" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">localTuningTimer</a>);
    cancelAndDelete(<a class="code" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">leafsetMaintenanceTimer</a>);
    cancelAndDelete(<a class="code" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">globalTuningTimer</a>);
}
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ae987647d2b516c6bcaa1c93257b6be3f"></a><!-- doxytag: member="Bamboo::changeState" ref="ae987647d2b516c6bcaa1c93257b6be3f" args="(int toState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::changeState </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>toState</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>changes node state </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>toState</em>&nbsp;</td><td>state to change to </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00082">82</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00432">checkProxCache()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00069">joinOverlay()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classBasePastry.html#a1f99c5e7da561015851b206abb4d0f59" title="changes node state, but leaves specific behavour, scheduling tasks in particular, to the inheriting p...">baseChangeState</a>(toState);

    <span class="keywordflow">switch</span> (toState) {
    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>:

        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="BasePastry_8h.html#a368457fbb93f1eed641b33da5a87856a">DISCOVERY</a>:

        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>: {
        <a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>(<span class="stringliteral">&quot;Leafset&quot;</span>);
        msg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a5092b38982db1db0e073681b5bea653b">PASTRY_MSG_LEAFSET_PULL</a>);
        msg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
        msg-&gt;<a class="code" href="classPastryLeafsetMessage.html#ae414a8510aec8202bef114582450e2fb">setSender</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        msg-&gt;<a class="code" href="classPastryLeafsetMessage.html#a245c7f5793280b6739362423b5e0355b">setSendStateTo</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a86d0046df97f4d54384d2a0b3936c53e" title="dump content of the set to a PastryStateMessage">dumpToStateMessage</a>(msg);
        msg-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#af773c8f0dc1681c295ea9195dbdc7177">PASTRYLEAFSET_L</a>(msg));
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a4c18e956472b6109d8b7f6951af550b5">leafsetSent</a>++; <a class="code" href="classBasePastry.html#a4ac5815eec47ea1ec62a25e19dbaf806">leafsetBytesSent</a> += msg-&gt;getByteLength());
        std::vector&lt;TransportAddress&gt; sourceRoute;
        sourceRoute.push_back(<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>);
        <a class="code" href="classBaseOverlay.html#a6f2c598f5d3989a63a8cc7220f1aaf76" title="Sends a message to an overlay node, with the generic routing algorithm.">sendToKey</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), msg, 0<span class="comment">/*1*/</span>, sourceRoute);

        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>);
        scheduleAt(simTime() + <a class="code" href="classBasePastry.html#a596fc6a02d7b78a6bf804d08cbf73844">joinTimeoutAmount</a>, <a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>);
    }

    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>:

        <span class="comment">// schedule routing table maintenance task</span>
        cancelEvent(<a class="code" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">localTuningTimer</a>);
        scheduleAt(simTime() + <a class="code" href="classBamboo.html#a703829a0001a2396b500aff8eb823242">localTuningInterval</a>, <a class="code" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">localTuningTimer</a>);

        cancelEvent(<a class="code" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">leafsetMaintenanceTimer</a>);
        <span class="comment">//scheduleAt(simTime() + leafsetMaintenanceInterval, leafsetMaintenanceTimer);</span>
        scheduleAt(simTime() + 0.2 <span class="comment">/* 200ms */</span>, <a class="code" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">leafsetMaintenanceTimer</a>);

        cancelEvent(<a class="code" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">globalTuningTimer</a>);
        scheduleAt(simTime() + <a class="code" href="classBamboo.html#a8a4593a1108a8d18b11799bbbe1c63dc">globalTuningInterval</a>, <a class="code" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">globalTuningTimer</a>);

        <span class="keywordflow">break</span>;
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4efad1712615507ca730b86006513d9e"></a><!-- doxytag: member="Bamboo::checkProxCache" ref="a4efad1712615507ca730b86006513d9e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::checkProxCache </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>checks whether proxCache is complete, takes appropriate actions depending on the protocol state </p>

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00432">432</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) {
        <a class="code" href="classBamboo.html#ae987647d2b516c6bcaa1c93257b6be3f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// state == READY</span>
    simtime_t now = simTime();

    <span class="comment">// no cached STATE message?</span>
    <span class="keywordflow">if</span> (!(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> &amp;&amp; <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>)) <span class="keywordflow">return</span>;

    <span class="comment">// some entries not yet determined?</span>
    <span class="keywordflow">if</span> (find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.end(),
             PASTRY_PROX_PENDING) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.end()) <span class="keywordflow">return</span>;
    <span class="keywordflow">if</span> (find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.end(),
             PASTRY_PROX_PENDING) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.end()) <span class="keywordflow">return</span>;
    <span class="keywordflow">if</span> (find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.end(),
             PASTRY_PROX_PENDING) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.end()) <span class="keywordflow">return</span>;

    <span class="comment">// merge info in own state tables</span>
    <span class="comment">// except leafset (was already handled in handleStateMessage)</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>)) {
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>)) {
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::checkProxCache()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Merged nodes into routing table.&quot;</span>
           &lt;&lt; endl;
    }

    <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();

    <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>;
    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
    <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>;
    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> = NULL;

    <span class="comment">// process next queued message:</span>
    <span class="keywordflow">if</span> (! <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.empty()) {
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.front();
              <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.pop();
        <a class="code" href="classBasePastry.html#a445a74a2791f810975bf99b4ff7d9865" title="ping all nodes in the pastry state message pointed to by private member stateCache">pingNodes</a>();
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="acc2e50c06119f74386cc083431f86675"></a><!-- doxytag: member="Bamboo::doGlobalTuning" ref="acc2e50c06119f74386cc083431f86675" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::doGlobalTuning </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>periodically repairs the routing table by performing random lookups </p>

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00384">384</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> digit = <a class="code" href="classBamboo.html#a7d9390f517830e44e35e3cd475730724">getNextRowToMaintain</a>();

    <span class="comment">// would be a better alternative</span>
    <span class="comment">//OverlayKey OverlayKey::randomSuffix(uint pos) const;</span>

    uint32_t maxDigitIndex = <a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - <a class="code" href="classBasePastry.html#a80645aaa29443c4b7dc919d67fb7af81">bitsPerDigit</a>;
    uint32_t maxKeyIndex = <a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - 1;
    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> newKey = <a class="code" href="classOverlayKey.html#a1983e1b47e32783f8ccd5e59fe725290" title="Returns a random key.">OverlayKey::random</a>();
    <span class="keywordflow">while</span> (newKey.<a class="code" href="classOverlayKey.html#a25b2a67642f29fe2035a0abf74de3dd1" title="Returns a sub integer at position p with n-bits.">getBitRange</a>(maxDigitIndex - digit * <a class="code" href="classBasePastry.html#a80645aaa29443c4b7dc919d67fb7af81">bitsPerDigit</a>, bitsPerDigit) ==
           <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#a25b2a67642f29fe2035a0abf74de3dd1" title="Returns a sub integer at position p with n-bits.">getBitRange</a>(maxDigitIndex - digit * bitsPerDigit, bitsPerDigit)) {
        newKey = <a class="code" href="classOverlayKey.html#a1983e1b47e32783f8ccd5e59fe725290" title="Returns a random key.">OverlayKey::random</a>();
    }

    assert(digit * bitsPerDigit &lt; <a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>());
    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; digit * bitsPerDigit; ++i) {
        newKey[maxKeyIndex - i] = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#abf5c47662357fb4f01de9a7a93523308">getBit</a>(maxKeyIndex - i);
    }

    <a class="code" href="classBasePastry.html#a08fd91b569919795fe56f523ccef846b">createLookup</a>()-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(newKey, 1, 0, 0, <span class="keyword">new</span> <a class="code" href="classBamboo.html#aefc36fb7b441daba48500acc1fec62d4">BambooLookupListener</a>(<span class="keyword">this</span>));
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab28c657a75980f968defb032f4aa9002"></a><!-- doxytag: member="Bamboo::doLeafsetMaintenance" ref="ab28c657a75980f968defb032f4aa9002" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::doLeafsetMaintenance </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>periodically repairs the leafset by pushing it to and pulling it from from a random live leafset node </p>

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00318">318</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; ask = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a76dca71b4a758f9aec046e1626b5a42e" title="returns a random node from the leafset">getRandomNode</a>();
    <span class="keywordflow">if</span> (!ask.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <a class="code" href="classBasePastry.html#a5bc3c9909b2b24250bc6697d2d15c48a" title="send the leafset to a node">sendLeafset</a>(ask, <span class="keyword">true</span>);
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::doLeafsetMaintenance()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    leafset maintenance: pulling leafset from &quot;</span>
           &lt;&lt; ask &lt;&lt; endl;
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="acde8e02f731fe1a26a5c21d47ee84188"></a><!-- doxytag: member="Bamboo::doLocalTuning" ref="acde8e02f731fe1a26a5c21d47ee84188" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::doLocalTuning </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00356">356</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classBasePastry.html#ad649a2131c80eceecb309cb386b806a6">rowToAsk</a> = <a class="code" href="classBamboo.html#a7d9390f517830e44e35e3cd475730724">getNextRowToMaintain</a>();

    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; ask4row = <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a37d02a2bda67fe9618b382f321a532d3" title="returns a random node from the routing table">getRandomNode</a>(<a class="code" href="classBasePastry.html#ad649a2131c80eceecb309cb386b806a6">rowToAsk</a>);

    <span class="keywordflow">if</span> ((!ask4row.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) &amp;&amp; (ask4row != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {
        <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>* msg =
            <span class="keyword">new</span> <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>(<span class="stringliteral">&quot;ROWREQ&quot;</span>);
        msg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a69f787010e934271e5de155a65c22702">PASTRY_MSG_ROWREQ</a>);
        msg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
        msg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#abf43cf8c25c231ae943f78b55dae650a">setSendStateTo</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        msg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#ae6f4edc057a2addcfee9600f042d0df5">setRow</a>(<a class="code" href="classBasePastry.html#ad649a2131c80eceecb309cb386b806a6">rowToAsk</a> + 1);
        msg-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#aec1aa9cda971eb29ce1b041b27a5cb96">PASTRYRTREQ_L</a>(msg));

        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a30413da700f177a195a011a1e46f4627">routingTableReqSent</a>++;
                     <a class="code" href="classBasePastry.html#a0fcc70cc77b501a0827ab426305b8675">routingTableReqBytesSent</a> += msg-&gt;getByteLength());

        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::doLocalTuning() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Sending  Message to Node in Row&quot;</span> &lt;&lt; <a class="code" href="classBasePastry.html#ad649a2131c80eceecb309cb386b806a6">rowToAsk</a>
           &lt;&lt; endl;

        <a class="code" href="classBaseOverlay.html#a124850e5bc8d81b3eb4f3aec75868449" title="Sends message to underlay.">sendMessageToUDP</a>(ask4row, msg);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7d9390f517830e44e35e3cd475730724"></a><!-- doxytag: member="Bamboo::getNextRowToMaintain" ref="a7d9390f517830e44e35e3cd475730724" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Bamboo::getNextRowToMaintain </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00330">330</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00384">doGlobalTuning()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00356">doLocalTuning()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> digit = 0;
    <span class="keywordtype">int</span> lastRow = <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a449b7e0abcd2be8a93816669201bfc4c" title="gets the number of rows in the routing table">getLastRow</a>();

    <span class="keywordtype">int</span>* choices = <span class="keyword">new</span> <span class="keywordtype">int</span>[lastRow + 1];
    <span class="keywordtype">int</span> sum = 0;

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lastRow; ++i) {
        sum += (choices[i] = lastRow - i);
    }

    <span class="keywordtype">int</span> rval = intuniform(0, sum);

    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
        rval -= choices [digit];
        <span class="keywordflow">if</span> (rval &lt;= 0)
            <span class="keywordflow">break</span>;
        ++digit;
    }
    <span class="keyword">delete</span>[] choices;

    <span class="keywordflow">return</span> digit;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac33bbf6ffd5a95bb730ce046f921a335"></a><!-- doxytag: member="Bamboo::handleFailedNode" ref="ac33bbf6ffd5a95bb730ce046f921a335" args="(const TransportAddress &amp;failed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Bamboo::handleFailedNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>failed</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>notifies leafset and routingtable of a failed node and sends out a repair request if possible </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>failed</em>&nbsp;</td><td>the failed node </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true as long as local state is READY (signals lookup to try again) </dd></dl>

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00407">407</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (failed.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;Bamboo::handleFailedNode(): failed is unspecified!&quot;</span>);
    }

    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; lsAsk = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ad691bdd611ba773d5b7a0a90af491498" title="tells the leafset that a node has failed">failedNode</a>(failed);
    <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#ae440c8aa89543afc2147b8784be93c41" title="tells the routing table that a node has failed">failedNode</a>(failed);
    <a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryNeighborhoodSet.html#a86f227b707f881c8897ec334f2bd5a33" title="tell the neighborhood set about a failed node">failedNode</a>(failed);

    <span class="keywordflow">if</span> (lsAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; (! <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ae13d5a42c50606e3cc0fbcd830429322" title="check if LeafSet knows at least one node to the left and to the right">isValid</a>())) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleFailedNode()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    lost connection to the network, trying to re-join.&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classBaseOverlay.html#acb8855faa86247ae37ab894891d9f4dd" title="Join the overlay with a given nodeID.">join</a>();
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="af7e2ea2c6f6d654980310005a230f6a3"></a><!-- doxytag: member="Bamboo::handleStateMessage" ref="af7e2ea2c6f6d654980310005a230f6a3" args="(PastryStateMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::handleStateMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPastryStateMessage.html">PastryStateMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00481">481</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00165">handleUDPMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    new STATE message to process &quot;</span>
           &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(msg) &lt;&lt; <span class="stringliteral">&quot; in state &quot;</span>
           &lt;&lt; ((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)?<span class="stringliteral">&quot;READY&quot;</span>:((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == JOINING_2)?<span class="stringliteral">&quot;JOIN&quot;</span>:<span class="stringliteral">&quot;INIT&quot;</span>))
           &lt;&lt; endl;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    can&#39;t handle state messages until at least reaching JOIN state.&quot;</span>
           &lt;&lt; endl;
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }

    <a class="code" href="structPastryStateMsgHandle.html" title="struct-type containing local info while processing a STATE message">PastryStateMsgHandle</a> handle(msg);

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) {
        <a class="code" href="classBasePastry.html#a89aba6ca97abfbe6baff748a19969d1e" title="change the aliveTable to match the given stateMsg.">determineAliveTable</a>(msg);
        <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, &amp;<a class="code" href="classBasePastry.html#a22e76d53e4ba89d63eca403923a46da8" title="Early update of leaf set: helper structure for marking known-dead nodes.">aliveTable</a>);
        <span class="comment">// merged state into leafset right now</span>
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();

        <span class="comment">// no state message is processed right now, start immediately:</span>
       <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = handle;
       <a class="code" href="classBasePastry.html#a445a74a2791f810975bf99b4ff7d9865" title="ping all nodes in the pastry state message pointed to by private member stateCache">pingNodes</a>();

        <span class="keywordflow">return</span>;
    }

    <span class="comment">// determine aliveTable to prevent leafSet from merging nodes that are</span>
    <span class="comment">// known to be dead:</span>
    <a class="code" href="classBasePastry.html#a89aba6ca97abfbe6baff748a19969d1e" title="change the aliveTable to match the given stateMsg.">determineAliveTable</a>(msg);
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, &amp;<a class="code" href="classBasePastry.html#a22e76d53e4ba89d63eca403923a46da8" title="Early update of leaf set: helper structure for marking known-dead nodes.">aliveTable</a>)) {
        <span class="comment">// merged state into leafset right now</span>
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();
    }
    <span class="comment">// in READY state, only ping nodes to get proximity metric:</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) {
        <span class="comment">// no state message is processed right now, start immediately:</span>
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = handle;
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) {
            <a class="code" href="classBasePastry.html#a445a74a2791f810975bf99b4ff7d9865" title="ping all nodes in the pastry state message pointed to by private member stateCache">pingNodes</a>();
        } <span class="keywordflow">else</span> {
            simtime_t now = simTime();
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL)) {
                <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
            }
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL)) {
                <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
                EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::checkProxCache()]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Merged nodes into routing table.&quot;</span>
                   &lt;&lt; endl;
            }
        }
    } <span class="keywordflow">else</span> {
        <span class="comment">// enqueue message for later processing:</span>
        <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.push(handle);
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) <a class="code" href="classBasePastry.html#af6a7090deb645b1f79b33edb0409485c" title="ping all nodes in a given state message.">prePing</a>(msg);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d3f0705b1495c225432238094a38cea"></a><!-- doxytag: member="Bamboo::handleTimerEvent" ref="a6d3f0705b1495c225432238094a38cea" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00131">131</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg == <a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    join timeout expired, restarting...&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classBamboo.html#a1b8dba4c0d42b0dbf6b6b2a693c6dc29">joinOverlay</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">localTuningTimer</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    starting local tuning &quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;(aka neighbor&#39;s neighbors / routing table maintenance)&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classBamboo.html#acde8e02f731fe1a26a5c21d47ee84188">doLocalTuning</a>();
        scheduleAt(simTime() + <a class="code" href="classBamboo.html#a703829a0001a2396b500aff8eb823242">localTuningInterval</a>, <a class="code" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">localTuningTimer</a>);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">leafsetMaintenanceTimer</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    starting leafset maintenance&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classBamboo.html#ab28c657a75980f968defb032f4aa9002" title="periodically repairs the leafset by pushing it to and pulling it from from a random live leafset node...">doLeafsetMaintenance</a>();
        scheduleAt(simTime() + <a class="code" href="classBamboo.html#a05f92ae31d195ee37d78f45ab7f5f5bb">leafsetMaintenanceInterval</a>,
                   <a class="code" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">leafsetMaintenanceTimer</a>);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">globalTuningTimer</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    starting global tuning&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classBamboo.html#acc2e50c06119f74386cc083431f86675" title="periodically repairs the routing table by performing random lookups">doGlobalTuning</a>();
        scheduleAt(simTime() + <a class="code" href="classBamboo.html#a8a4593a1108a8d18b11799bbbe1c63dc">globalTuningInterval</a>, <a class="code" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">globalTuningTimer</a>);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5448a722d860af66a2cb6479033f3d33"></a><!-- doxytag: member="Bamboo::handleUDPMessage" ref="a5448a722d860af66a2cb6479033f3d33" args="(BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::handleUDPMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00165">165</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastryMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryMessage</a>* pastryMsg = check_and_cast&lt;<a class="code" href="classPastryMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryMessage</a>*&gt;(msg);
    uint32_t type = pastryMsg-&gt;<a class="code" href="classPastryMessage.html#a9e66d5e8500b6ad714cbbe3fa2078d73">getPastryMsgType</a>();

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    incoming message of type &quot;</span>;
        <span class="keywordflow">switch</span>(type) {
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00aab9b15b25e3f7087a561862f304a7105">PASTRY_MSG_STD</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_STD&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00afe224824cc07fb076471ed2e3328d729">PASTRY_MSG_JOIN</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_JOIN&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a3fc217f62b60d4208e70416527c0bd83">PASTRY_MSG_STATE</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_STATE&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00acf999654230db12963475fe7578f84d0">PASTRY_MSG_LEAFSET</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_LEAFSET&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a5092b38982db1db0e073681b5bea653b">PASTRY_MSG_LEAFSET_PULL</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_LEAFSET_PULL&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a69f787010e934271e5de155a65c22702">PASTRY_MSG_ROWREQ</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_ROWREQ&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00af6b2263d326f61d280fca5230df2ee82">PASTRY_MSG_RROW</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_RROW&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00ab425e857aeb7247b770716d6038fc527">PASTRY_MSG_REQ</a>:
            EV &lt;&lt; <span class="stringliteral">&quot;PASTRY_MSG_REQ&quot;</span>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            EV &lt;&lt; <span class="stringliteral">&quot;UNKNOWN (&quot;</span> &lt;&lt; type &lt;&lt;<span class="stringliteral">&quot;)&quot;</span>;
            <span class="keywordflow">break</span>;
        }
        EV &lt;&lt; endl;
    }

    <span class="keywordflow">switch</span> (type) {
    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00aab9b15b25e3f7087a561862f304a7105">PASTRY_MSG_STD</a>:
        opp_error(<span class="stringliteral">&quot;Pastry received PastryMessage of unknown type!&quot;</span>);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00afe224824cc07fb076471ed2e3328d729">PASTRY_MSG_JOIN</a>:

        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00acf999654230db12963475fe7578f84d0">PASTRY_MSG_LEAFSET</a>: {
        <a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>* lmsg =
            check_and_cast&lt;<a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a966f88cf985632e3e28ff482c5e5d0a2">leafsetReceived</a>++; <a class="code" href="classBasePastry.html#a9bdc81ede316e30996bbee5c73f6b472">leafsetBytesReceived</a> +=
            lmsg-&gt;getByteLength());

        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) {
            cancelEvent(<a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a>);
        }

        <span class="keywordflow">if</span> ((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>) || (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)) {
            <a class="code" href="classBasePastry.html#a1ea1672c0d5c853e4d823a8095c672b5" title="processes leafset messages, merging with own state tables">handleLeafsetMessage</a>(lmsg, <span class="keyword">true</span>);
        } <span class="keywordflow">else</span> {
            <span class="keyword">delete</span> lmsg;
        }
    }
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a5092b38982db1db0e073681b5bea653b">PASTRY_MSG_LEAFSET_PULL</a>: {
        <a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>* lmsg =
            check_and_cast&lt;<a class="code" href="classPastryLeafsetMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryLeafsetMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a966f88cf985632e3e28ff482c5e5d0a2">leafsetReceived</a>++; leafsetBytesReceived +=
            lmsg-&gt;getByteLength());

        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
            <a class="code" href="classBasePastry.html#a5bc3c9909b2b24250bc6697d2d15c48a" title="send the leafset to a node">sendLeafset</a>(lmsg-&gt;<a class="code" href="classPastryLeafsetMessage.html#a251d614f3baabba26a86f2715eec984c">getSendStateTo</a>());
            <a class="code" href="classBasePastry.html#a1ea1672c0d5c853e4d823a8095c672b5" title="processes leafset messages, merging with own state tables">handleLeafsetMessage</a>(lmsg, <span class="keyword">true</span>);

        } <span class="keywordflow">else</span> {
            <span class="keyword">delete</span> lmsg;
        }
    }
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a69f787010e934271e5de155a65c22702">PASTRY_MSG_ROWREQ</a>: {

        <a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>* rtrmsg =
            check_and_cast&lt;<a class="code" href="classPastryRoutingRowRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowRequestMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a9d8bb5f1b8e375adcf29601b06a26966">routingTableReqReceived</a>++; <a class="code" href="classBasePastry.html#ac130146fa13b0d04a15a25fdb2571ddd">routingTableReqBytesReceived</a> +=
            rtrmsg-&gt;getByteLength());
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)
            <span class="keywordflow">if</span> (rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#acfc899745150aca33c7e5321d54911a0">getRow</a>() == -1)
                <a class="code" href="classBasePastry.html#a61fcc4fef7533577ee94b6c452627c0a" title="send a row of the routing table to a node">sendRoutingRow</a>(rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#a3e36722e08010b81f7aece10a5ececde">getSendStateTo</a>(), <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a449b7e0abcd2be8a93816669201bfc4c" title="gets the number of rows in the routing table">getLastRow</a>());
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#acfc899745150aca33c7e5321d54911a0">getRow</a>() &gt; <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a449b7e0abcd2be8a93816669201bfc4c" title="gets the number of rows in the routing table">getLastRow</a>())
                    EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    received request for nonexistent routing&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;table row, dropping message!&quot;</span> &lt;&lt; endl;
                <span class="keywordflow">else</span> <a class="code" href="classBasePastry.html#a61fcc4fef7533577ee94b6c452627c0a" title="send a row of the routing table to a node">sendRoutingRow</a>(rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#a3e36722e08010b81f7aece10a5ececde">getSendStateTo</a>(), rtrmsg-&gt;<a class="code" href="classPastryRoutingRowRequestMessage.html#acfc899745150aca33c7e5321d54911a0">getRow</a>());
        <span class="keywordflow">else</span>
            EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    received routing table request before reaching &quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;READY state, dropping message!&quot;</span> &lt;&lt; endl;
       <span class="keyword">delete</span> rtrmsg;
    }
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00af6b2263d326f61d280fca5230df2ee82">PASTRY_MSG_RROW</a>: {
        <a class="code" href="classPastryRoutingRowMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowMessage</a>* rtmsg =
            check_and_cast&lt;<a class="code" href="classPastryRoutingRowMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRoutingRowMessage</a>*&gt;(pastryMsg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a93981f405e583d046c1609c075971c6c">routingTableReceived</a>++; <a class="code" href="classBasePastry.html#a74edb3cc83cb66d94e2f1dc3dd2c42f0">routingTableBytesReceived</a> +=
            rtmsg-&gt;getByteLength());

        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
            <span class="comment">// create state message to probe all nodes from row message</span>
            <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>* stateMsg = <span class="keyword">new</span> <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>(<span class="stringliteral">&quot;STATE&quot;</span>);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a25b3219dabfe526aea8c5a1c3a8bed93">setTimestamp</a>(rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#af9884c9961d58688db842f8d614d0ea1">getTimestamp</a>());
            stateMsg-&gt;<a class="code" href="classPastryMessage.html#a35ce0a801eb70c11600258bb2dabf5be">setPastryMsgType</a>(<a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a3fc217f62b60d4208e70416527c0bd83">PASTRY_MSG_STATE</a>);
            stateMsg-&gt;<a class="code" href="classBaseOverlayMessage.html#a46fd21016c6fad4f167d5510f0481f49">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a9778899b911fe623a773b4e17974fa65">setSender</a>(rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#a90e0a2d97dbaa39b18705c1f22373723">getSender</a>());
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#ac3f254bf54612f480dde0eef3a1204bf">setLeafSetArraySize</a>(0);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a78bd1834c1a5aa9e80321f55fd3d3cf1">setNeighborhoodSetArraySize</a>(0);
            stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a1432ce9c20f9ef89f14fa3fb1384d3f3">setRoutingTableArraySize</a>(rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#af92b954e91a51be973c23f77a2aeb96e">getRoutingTableArraySize</a>());

            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#af92b954e91a51be973c23f77a2aeb96e">getRoutingTableArraySize</a>(); i++) {
                stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a39a51998a0a91267bc76978c6d5c65cf">setRoutingTable</a>(i, rtmsg-&gt;<a class="code" href="classPastryRoutingRowMessage.html#a74f561d0fede6f8f03d55af8034ed9ac">getRoutingTable</a>(i));
            }

            <a class="code" href="classBamboo.html#af7e2ea2c6f6d654980310005a230f6a3">handleStateMessage</a>(stateMsg);
        }

        <span class="keyword">delete</span> rtmsg;
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00ab425e857aeb7247b770716d6038fc527">PASTRY_MSG_REQ</a>: {
        <a class="code" href="classPastryRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRequestMessage</a>* lrmsg =
            check_and_cast&lt;<a class="code" href="classPastryRequestMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryRequestMessage</a>*&gt;(pastryMsg);
        <a class="code" href="classBasePastry.html#aad40d59a6828e343b9f8b64b702128fb" title="processes state messages, merging with own state tables">handleRequestMessage</a>(lrmsg);
    }
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="PastryMessage__m_8h.html#aa40c6a04c877642da910442b18529d00a3fc217f62b60d4208e70416527c0bd83">PASTRY_MSG_STATE</a>: {
        <a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>* stateMsg =
            check_and_cast&lt;<a class="code" href="classPastryStateMessage.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryStateMessage</a>*&gt;(msg);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26fa765c1f23635923477bc300637c4f">stateReceived</a>++; <a class="code" href="classBasePastry.html#a8783f5db146cf00be3a347e92c36505e">stateBytesReceived</a> +=
                     stateMsg-&gt;getByteLength());
        <a class="code" href="classBamboo.html#af7e2ea2c6f6d654980310005a230f6a3">handleStateMessage</a>(stateMsg);
    }
        <span class="keywordflow">break</span>;
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52bd33a4d9a8418e9027284cc74f72d1"></a><!-- doxytag: member="Bamboo::initializeOverlay" ref="a52bd33a4d9a8418e9027284cc74f72d1" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00048">48</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ( stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a> )
        <span class="keywordflow">return</span>;

    <span class="comment">// Bamboo provides KBR services</span>
    <a class="code" href="classBaseOverlay.html#a53389ea3326d2e8ad53f02b388487d0b" title="set this to true, if the overlay provides KBR services">kbr</a> = <span class="keyword">true</span>;

    <a class="code" href="classBasePastry.html#a0bc39902de2d03ea45714bf8506d983f" title="initializes parameters and variables used in both Bamboo and Pastry">baseInit</a>();

    <a class="code" href="classBamboo.html#a703829a0001a2396b500aff8eb823242">localTuningInterval</a> = par(<span class="stringliteral">&quot;localTuningInterval&quot;</span>);
    <a class="code" href="classBamboo.html#a05f92ae31d195ee37d78f45ab7f5f5bb">leafsetMaintenanceInterval</a> = par(<span class="stringliteral">&quot;leafsetMaintenanceInterval&quot;</span>);
    <a class="code" href="classBamboo.html#a8a4593a1108a8d18b11799bbbe1c63dc">globalTuningInterval</a> = par(<span class="stringliteral">&quot;globalTuningInterval&quot;</span>);

    <a class="code" href="classBasePastry.html#a62c17b080a85d27ccdd85809c8f14503">joinTimeout</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;joinTimeout&quot;</span>);

    <a class="code" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">localTuningTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;repairTaskTimer&quot;</span>);
    <a class="code" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">leafsetMaintenanceTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;leafsetMaintenanceTimer&quot;</span>);
    <a class="code" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">globalTuningTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;globalTuningTimer&quot;</span>);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1b8dba4c0d42b0dbf6b6b2a693c6dc29"></a><!-- doxytag: member="Bamboo::joinOverlay" ref="a1b8dba4c0d42b0dbf6b6b2a693c6dc29" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::joinOverlay </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00069">69</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classBamboo.html#ae987647d2b516c6bcaa1c93257b6be3f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>);

    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <span class="comment">// no existing pastry network -&gt; first node of a new one</span>
        <a class="code" href="classBamboo.html#ae987647d2b516c6bcaa1c93257b6be3f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
    } <span class="keywordflow">else</span> {
        <span class="comment">// join existing pastry network</span>
        <a class="code" href="classBamboo.html#ae987647d2b516c6bcaa1c93257b6be3f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fae0807b50dbde92e1fcedaa4a9357fec8">JOINING_2</a>);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a37816e3b77076881120a13606d836489"></a><!-- doxytag: member="Bamboo::lookupFinished" ref="a37816e3b77076881120a13606d836489" args="(AbstractLookup *lookup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Bamboo::lookupFinished </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classAbstractLookup.html">AbstractLookup</a> *&nbsp;</td>
          <td class="paramname"> <em>lookup</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="classLookupListener.html#acf45d13c80a956edd062b0915ac5facd">LookupListener</a>.</p>

<p>Definition at line <a class="el" href="Bamboo_8cc_source.html#l00552">552</a> of file <a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8h_source.html#l00140">BambooLookupListener::lookupFinished()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Bamboo::lookupFinished()]\n&quot;</span>;
    <span class="keywordflow">if</span> (lookup-&gt;<a class="code" href="classAbstractLookup.html#a698d5d467c714e4d114359d1078b505d" title="Returns true, if the lookup was successful.">isValid</a>()) {
        EV  &lt;&lt; <span class="stringliteral">&quot;    Lookup successful&quot;</span> &lt;&lt; endl;
        <span class="keyword">const</span> <a class="code" href="classBaseKeySortedVector.html">NodeVector</a>&amp; result = lookup-&gt;<a class="code" href="classAbstractLookup.html#a0ad852a71fdafed808e0ebb8dcd3723e" title="Returns the result of the lookup.">getResult</a>();
        <span class="keywordflow">if</span> (result[0] != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) {
                <span class="comment">// Global Tuning PING</span>
                <a class="code" href="structProx.html">Prox</a> prox = <a class="code" href="classBaseRpc.html#ad80237130dc2316d0d76ac6757c50f4f" title="pointer to the neighbor cache">neighborCache</a>-&gt;<a class="code" href="classNeighborCache.html#ab934be8fb503f9629cf6eb83e7d1b576" title="Gets the proximity of a node.">getProx</a>(result[0],
                                                   <a class="code" href="NeighborCache_8h.html#ada3b7deab861ead8c817d583da336ccba751bede7ee708c74811f4bd49ee74cea">NEIGHBORCACHE_DEFAULT</a>,
                                                   <a class="code" href="classBasePastry.html#acd2b654814d77379002800161cd67981aaab166e746fb925df8707610d92af824">PING_SINGLE_NODE</a>,
                                                   <span class="keyword">this</span>, NULL);
                <span class="keywordflow">if</span> (prox != <a class="code" href="structProx.html#aa7ac832a04fe61863222d8631526647b">Prox::PROX_UNKNOWN</a>) {
                    <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a92eb6e9176f873cb0a7106ce6e97a53e" title="merge a node in the IRoutingTable">mergeNode</a>(result[0], prox.<a class="code" href="structProx.html#aeb8eca3cac2c681c5e7f1060fcbd7b6f">proximity</a>);
                }
            } <span class="keywordflow">else</span> {
                <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a92eb6e9176f873cb0a7106ce6e97a53e" title="merge a node in the IRoutingTable">mergeNode</a>(result[0], -1.0);
            }
        }
    } <span class="keywordflow">else</span> {
        EV &lt;&lt; <span class="stringliteral">&quot;    Lookup failed&quot;</span> &lt;&lt; endl;
    }
}
</pre></div></p>

</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="aefc36fb7b441daba48500acc1fec62d4"></a><!-- doxytag: member="Bamboo::BambooLookupListener" ref="aefc36fb7b441daba48500acc1fec62d4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classBambooLookupListener.html">BambooLookupListener</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00055">55</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00384">doGlobalTuning()</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a8a4593a1108a8d18b11799bbbe1c63dc"></a><!-- doxytag: member="Bamboo::globalTuningInterval" ref="a8a4593a1108a8d18b11799bbbe1c63dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classBamboo.html#a8a4593a1108a8d18b11799bbbe1c63dc">Bamboo::globalTuningInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00087">87</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00082">changeState()</a>, <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00048">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a18101007aa88fae455a40c512b964a33"></a><!-- doxytag: member="Bamboo::globalTuningTimer" ref="a18101007aa88fae455a40c512b964a33" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classBamboo.html#a18101007aa88fae455a40c512b964a33">Bamboo::globalTuningTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00090">90</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00082">changeState()</a>, <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>, <a class="el" href="Bamboo_8cc_source.html#l00048">initializeOverlay()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00040">~Bamboo()</a>.</p>

</div>
</div>
<a class="anchor" id="a05f92ae31d195ee37d78f45ab7f5f5bb"></a><!-- doxytag: member="Bamboo::leafsetMaintenanceInterval" ref="a05f92ae31d195ee37d78f45ab7f5f5bb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classBamboo.html#a05f92ae31d195ee37d78f45ab7f5f5bb">Bamboo::leafsetMaintenanceInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00085">85</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00048">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a27b7c5753ca505d9405088db5b992abb"></a><!-- doxytag: member="Bamboo::leafsetMaintenanceTimer" ref="a27b7c5753ca505d9405088db5b992abb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classBamboo.html#a27b7c5753ca505d9405088db5b992abb">Bamboo::leafsetMaintenanceTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00089">89</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00082">changeState()</a>, <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>, <a class="el" href="Bamboo_8cc_source.html#l00048">initializeOverlay()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00040">~Bamboo()</a>.</p>

</div>
</div>
<a class="anchor" id="a703829a0001a2396b500aff8eb823242"></a><!-- doxytag: member="Bamboo::localTuningInterval" ref="a703829a0001a2396b500aff8eb823242" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classBamboo.html#a703829a0001a2396b500aff8eb823242">Bamboo::localTuningInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00086">86</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00082">changeState()</a>, <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00048">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="aab00eaa43352d0f3d1529d2f03ebc6c2"></a><!-- doxytag: member="Bamboo::localTuningTimer" ref="aab00eaa43352d0f3d1529d2f03ebc6c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classBamboo.html#aab00eaa43352d0f3d1529d2f03ebc6c2">Bamboo::localTuningTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Bamboo_8h_source.html#l00091">91</a> of file <a class="el" href="Bamboo_8h_source.html">Bamboo.h</a>.</p>

<p>Referenced by <a class="el" href="Bamboo_8cc_source.html#l00082">changeState()</a>, <a class="el" href="Bamboo_8cc_source.html#l00131">handleTimerEvent()</a>, <a class="el" href="Bamboo_8cc_source.html#l00048">initializeOverlay()</a>, and <a class="el" href="Bamboo_8cc_source.html#l00040">~Bamboo()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Bamboo_8h_source.html">Bamboo.h</a></li>
<li><a class="el" href="Bamboo_8cc_source.html">Bamboo.cc</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 3 2010 14:40:46 for OverSim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
